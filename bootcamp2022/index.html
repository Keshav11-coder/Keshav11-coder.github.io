<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=fND5XPYKrF2tQDwwfWZJI3Br7nJQwv2dbxP3J1RFOgHvzWUO0rQXKh_711aqDzF9');ul.lst-kix_mrbf3etw55go-0{list-style-type:none}ul.lst-kix_mrbf3etw55go-1{list-style-type:none}ul.lst-kix_mrbf3etw55go-2{list-style-type:none}ul.lst-kix_mrbf3etw55go-7{list-style-type:none}ul.lst-kix_xt5lbbahzf58-7{list-style-type:none}ul.lst-kix_mrbf3etw55go-8{list-style-type:none}ul.lst-kix_xt5lbbahzf58-6{list-style-type:none}.lst-kix_9loaant0yasb-8>li:before{content:"-  "}ul.lst-kix_xt5lbbahzf58-5{list-style-type:none}ul.lst-kix_xt5lbbahzf58-4{list-style-type:none}ul.lst-kix_mrbf3etw55go-3{list-style-type:none}ul.lst-kix_xt5lbbahzf58-3{list-style-type:none}ul.lst-kix_mrbf3etw55go-4{list-style-type:none}ul.lst-kix_xt5lbbahzf58-2{list-style-type:none}.lst-kix_9loaant0yasb-7>li:before{content:"-  "}ul.lst-kix_mrbf3etw55go-5{list-style-type:none}ul.lst-kix_xt5lbbahzf58-1{list-style-type:none}ul.lst-kix_mrbf3etw55go-6{list-style-type:none}ul.lst-kix_xt5lbbahzf58-0{list-style-type:none}ol.lst-kix_pebqbp50lxbn-0.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-0 0}.lst-kix_9loaant0yasb-4>li:before{content:"-  "}.lst-kix_9loaant0yasb-5>li:before{content:"-  "}.lst-kix_9loaant0yasb-2>li:before{content:"-  "}.lst-kix_9loaant0yasb-6>li:before{content:"-  "}ul.lst-kix_xt5lbbahzf58-8{list-style-type:none}.lst-kix_9loaant0yasb-3>li:before{content:"-  "}.lst-kix_pebqbp50lxbn-8>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-8}.lst-kix_lr2po1pqbijq-5>li:before{content:"-  "}.lst-kix_lr2po1pqbijq-7>li:before{content:"-  "}.lst-kix_lr2po1pqbijq-2>li:before{content:"-  "}.lst-kix_lr2po1pqbijq-6>li:before{content:"-  "}.lst-kix_lr2po1pqbijq-3>li:before{content:"-  "}.lst-kix_lr2po1pqbijq-4>li:before{content:"-  "}ol.lst-kix_pebqbp50lxbn-8.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-8 0}.lst-kix_nhgktuvbl2kx-3>li:before{content:"-  "}.lst-kix_nhgktuvbl2kx-4>li:before{content:"-  "}.lst-kix_djasomgyryj4-0>li:before{content:"-  "}.lst-kix_pebqbp50lxbn-0>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-0}.lst-kix_nhgktuvbl2kx-5>li:before{content:"-  "}.lst-kix_djasomgyryj4-1>li:before{content:"-  "}.lst-kix_nhgktuvbl2kx-7>li:before{content:"-  "}.lst-kix_nhgktuvbl2kx-8>li:before{content:"-  "}.lst-kix_nhgktuvbl2kx-6>li:before{content:"-  "}.lst-kix_lr2po1pqbijq-8>li:before{content:"-  "}.lst-kix_xt5lbbahzf58-6>li:before{content:"-  "}ul.lst-kix_9loaant0yasb-8{list-style-type:none}.lst-kix_xt5lbbahzf58-7>li:before{content:"-  "}ul.lst-kix_9loaant0yasb-5{list-style-type:none}.lst-kix_wk0pa07ne8j0-0>li:before{content:"-  "}ul.lst-kix_9loaant0yasb-4{list-style-type:none}ul.lst-kix_9loaant0yasb-7{list-style-type:none}.lst-kix_xt5lbbahzf58-8>li:before{content:"-  "}ul.lst-kix_9loaant0yasb-6{list-style-type:none}ul.lst-kix_dyhr6kbe6pzy-6{list-style-type:none}ul.lst-kix_9loaant0yasb-1{list-style-type:none}ul.lst-kix_dyhr6kbe6pzy-5{list-style-type:none}.lst-kix_wk0pa07ne8j0-2>li:before{content:"-  "}.lst-kix_wk0pa07ne8j0-3>li:before{content:"-  "}ul.lst-kix_9loaant0yasb-0{list-style-type:none}ul.lst-kix_dyhr6kbe6pzy-8{list-style-type:none}ul.lst-kix_9loaant0yasb-3{list-style-type:none}ul.lst-kix_dyhr6kbe6pzy-7{list-style-type:none}.lst-kix_pebqbp50lxbn-6>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-6}ul.lst-kix_9loaant0yasb-2{list-style-type:none}ul.lst-kix_dyhr6kbe6pzy-2{list-style-type:none}ul.lst-kix_dyhr6kbe6pzy-1{list-style-type:none}.lst-kix_mrbf3etw55go-7>li:before{content:"-  "}.lst-kix_mrbf3etw55go-8>li:before{content:"-  "}.lst-kix_wk0pa07ne8j0-1>li:before{content:"-  "}ul.lst-kix_dyhr6kbe6pzy-4{list-style-type:none}ul.lst-kix_dyhr6kbe6pzy-3{list-style-type:none}.lst-kix_mrbf3etw55go-5>li:before{content:"-  "}.lst-kix_mrbf3etw55go-6>li:before{content:"-  "}.lst-kix_wk0pa07ne8j0-6>li:before{content:"-  "}.lst-kix_wk0pa07ne8j0-7>li:before{content:"-  "}ul.lst-kix_dyhr6kbe6pzy-0{list-style-type:none}.lst-kix_wk0pa07ne8j0-4>li:before{content:"-  "}.lst-kix_wk0pa07ne8j0-8>li:before{content:"-  "}ol.lst-kix_pebqbp50lxbn-5.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-5 0}.lst-kix_mrbf3etw55go-2>li:before{content:"-  "}.lst-kix_mrbf3etw55go-3>li:before{content:"-  "}.lst-kix_mrbf3etw55go-4>li:before{content:"-  "}.lst-kix_wk0pa07ne8j0-5>li:before{content:"-  "}.lst-kix_pebqbp50lxbn-5>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-5}ul.lst-kix_wk0pa07ne8j0-0{list-style-type:none}ul.lst-kix_wk0pa07ne8j0-1{list-style-type:none}.lst-kix_pebqbp50lxbn-2>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-2}ul.lst-kix_wk0pa07ne8j0-2{list-style-type:none}ul.lst-kix_wk0pa07ne8j0-3{list-style-type:none}ul.lst-kix_wk0pa07ne8j0-4{list-style-type:none}ul.lst-kix_wk0pa07ne8j0-5{list-style-type:none}ul.lst-kix_wk0pa07ne8j0-6{list-style-type:none}.lst-kix_mrbf3etw55go-1>li:before{content:"-  "}ul.lst-kix_wk0pa07ne8j0-7{list-style-type:none}ul.lst-kix_wk0pa07ne8j0-8{list-style-type:none}.lst-kix_mrbf3etw55go-0>li:before{content:"-  "}ol.lst-kix_pebqbp50lxbn-6.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-6 0}ul.lst-kix_pebqbp50lxbn-1{list-style-type:none}ul.lst-kix_djasomgyryj4-0{list-style-type:none}ul.lst-kix_djasomgyryj4-1{list-style-type:none}ul.lst-kix_djasomgyryj4-2{list-style-type:none}ul.lst-kix_djasomgyryj4-3{list-style-type:none}ul.lst-kix_djasomgyryj4-4{list-style-type:none}ul.lst-kix_djasomgyryj4-5{list-style-type:none}ul.lst-kix_djasomgyryj4-6{list-style-type:none}ul.lst-kix_djasomgyryj4-7{list-style-type:none}ol.lst-kix_pebqbp50lxbn-4.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-4 0}.lst-kix_pebqbp50lxbn-4>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-4}ol.lst-kix_pebqbp50lxbn-7.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-7 0}ol.lst-kix_pebqbp50lxbn-2{list-style-type:none}ol.lst-kix_pebqbp50lxbn-3{list-style-type:none}ol.lst-kix_pebqbp50lxbn-4{list-style-type:none}ol.lst-kix_pebqbp50lxbn-5{list-style-type:none}ol.lst-kix_pebqbp50lxbn-6{list-style-type:none}ol.lst-kix_pebqbp50lxbn-7{list-style-type:none}ol.lst-kix_pebqbp50lxbn-8{list-style-type:none}ol.lst-kix_pebqbp50lxbn-0{list-style-type:none}.lst-kix_pebqbp50lxbn-8>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-8,lower-roman) ". "}.lst-kix_pebqbp50lxbn-6>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-6,decimal) ". "}.lst-kix_pebqbp50lxbn-7>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-7,lower-latin) ". "}.lst-kix_pebqbp50lxbn-3>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-3}.lst-kix_pebqbp50lxbn-3>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-3,decimal) ". "}.lst-kix_pebqbp50lxbn-4>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-4,lower-latin) ". "}.lst-kix_pebqbp50lxbn-5>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-5,lower-roman) ". "}.lst-kix_djasomgyryj4-7>li:before{content:"-  "}.lst-kix_djasomgyryj4-6>li:before{content:"-  "}.lst-kix_djasomgyryj4-8>li:before{content:"-  "}.lst-kix_xt5lbbahzf58-5>li:before{content:"-  "}.lst-kix_djasomgyryj4-5>li:before{content:"-  "}ol.lst-kix_pebqbp50lxbn-2.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-2 0}.lst-kix_xt5lbbahzf58-4>li:before{content:"-  "}.lst-kix_pebqbp50lxbn-2>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-2,lower-roman) ". "}.lst-kix_djasomgyryj4-4>li:before{content:"-  "}.lst-kix_djasomgyryj4-2>li:before{content:"-  "}.lst-kix_xt5lbbahzf58-1>li:before{content:"-  "}.lst-kix_xt5lbbahzf58-3>li:before{content:"-  "}ul.lst-kix_nhgktuvbl2kx-0{list-style-type:none}.lst-kix_nhgktuvbl2kx-2>li:before{content:"-  "}.lst-kix_pebqbp50lxbn-0>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-0,decimal) ". "}.lst-kix_pebqbp50lxbn-1>li:before{content:"\0025cb  "}ul.lst-kix_nhgktuvbl2kx-2{list-style-type:none}ul.lst-kix_nhgktuvbl2kx-1{list-style-type:none}.lst-kix_djasomgyryj4-3>li:before{content:"-  "}.lst-kix_dyhr6kbe6pzy-0>li:before{content:"\0025cf  "}.lst-kix_xt5lbbahzf58-2>li:before{content:"-  "}.lst-kix_dyhr6kbe6pzy-1>li:before{content:"\0025cb  "}.lst-kix_nhgktuvbl2kx-1>li:before{content:"-  "}.lst-kix_dyhr6kbe6pzy-2>li:before{content:"\0025a0  "}.lst-kix_xt5lbbahzf58-0>li:before{content:"-  "}.lst-kix_nhgktuvbl2kx-0>li:before{content:"-  "}.lst-kix_dyhr6kbe6pzy-3>li:before{content:"\0025cf  "}.lst-kix_dyhr6kbe6pzy-5>li:before{content:"\0025a0  "}.lst-kix_lr2po1pqbijq-1>li:before{content:"-  "}.lst-kix_dyhr6kbe6pzy-4>li:before{content:"\0025cb  "}.lst-kix_lr2po1pqbijq-0>li:before{content:"-  "}ul.lst-kix_lr2po1pqbijq-0{list-style-type:none}ul.lst-kix_lr2po1pqbijq-1{list-style-type:none}ul.lst-kix_lr2po1pqbijq-2{list-style-type:none}.lst-kix_dyhr6kbe6pzy-7>li:before{content:"\0025cb  "}ul.lst-kix_lr2po1pqbijq-3{list-style-type:none}ol.lst-kix_pebqbp50lxbn-3.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-3 0}.lst-kix_dyhr6kbe6pzy-6>li:before{content:"\0025cf  "}ul.lst-kix_lr2po1pqbijq-8{list-style-type:none}.lst-kix_9loaant0yasb-0>li:before{content:"-  "}.lst-kix_9loaant0yasb-1>li:before{content:"-  "}ul.lst-kix_lr2po1pqbijq-4{list-style-type:none}ul.lst-kix_lr2po1pqbijq-5{list-style-type:none}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}ul.lst-kix_lr2po1pqbijq-6{list-style-type:none}.lst-kix_dyhr6kbe6pzy-8>li:before{content:"\0025a0  "}ul.lst-kix_lr2po1pqbijq-7{list-style-type:none}ul.lst-kix_nhgktuvbl2kx-4{list-style-type:none}ul.lst-kix_nhgktuvbl2kx-3{list-style-type:none}ul.lst-kix_nhgktuvbl2kx-6{list-style-type:none}ul.lst-kix_nhgktuvbl2kx-5{list-style-type:none}ul.lst-kix_nhgktuvbl2kx-8{list-style-type:none}.lst-kix_pebqbp50lxbn-7>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-7}ul.lst-kix_nhgktuvbl2kx-7{list-style-type:none}ul.lst-kix_djasomgyryj4-8{list-style-type:none}ol{margin:0;padding:0}table td,table th{padding:0}.c10{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#333333;border-left-style:solid;border-bottom-width:0pt;width:468pt;border-top-color:#000000;border-bottom-style:solid}.c12{margin-left:36pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left}.c28{background-color:#2b2b2b;color:#a9b7c6;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:8pt;font-family:"Courier New";font-style:normal}.c20{margin-left:36pt;padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c22{padding-top:16pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:center}.c21{color:#6aa84f;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c2{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center;height:11pt}.c31{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:left;height:11pt}.c24{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:13pt;font-family:"Arial";font-style:normal}.c32{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:16pt;font-family:"Arial";font-style:normal}.c3{color:#000000;font-weight:700;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Arial";font-style:normal}.c53{background-color:#2b2b2b;color:#a9b7c6;font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Courier New";font-style:normal}.c23{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c34{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Comic Sans MS";font-style:italic}.c49{color:#f8f8f2;font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Consolas";font-style:normal}.c59{color:#d4d4d4;font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Consolas";font-style:normal}.c47{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;text-align:center}.c66{font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial"}.c25{background-color:#333333;font-size:10.5pt;font-family:"Consolas";color:#fcc28c;font-weight:400}.c17{background-color:#333333;font-size:10pt;font-family:"Consolas";color:#fcc28c;font-weight:400}.c16{background-color:#333333;font-size:10pt;font-family:"Consolas";color:#ffffaa;font-weight:400}.c35{background-color:#333333;font-size:10.5pt;font-family:"Consolas";color:#d36363;font-weight:400}.c4{background-color:#333333;font-size:10pt;font-family:"Consolas";color:#a2fca2;font-weight:400}.c52{padding-top:12pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;text-align:center}.c8{background-color:#333333;font-size:10.5pt;font-family:"Consolas";color:#ffffaa;font-weight:400}.c74{padding-top:20pt;padding-bottom:20pt;line-height:1.15;page-break-after:avoid;text-align:center}.c19{background-color:#333333;font-size:10pt;font-family:"Consolas";color:#62c8f3;font-weight:400}.c51{color:#000000;text-decoration:none;vertical-align:baseline;font-family:"Arial";font-style:normal}.c5{background-color:#333333;font-size:10pt;font-family:"Consolas";color:#ffffff;font-weight:400}.c41{padding-top:14pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;text-align:center}.c1{background-color:#333333;font-size:10pt;font-family:"Consolas";color:#888888;font-weight:400}.c9{background-color:#333333;font-size:10.5pt;font-family:"Consolas";color:#ffffff;font-weight:400}.c29{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:center;height:11pt}.c6{background-color:#333333;font-size:10.5pt;font-family:"Consolas";color:#a2fca2;font-weight:400}.c13{background-color:#333333;font-size:7pt;font-family:"Consolas";color:#62c8f3;font-weight:700}.c11{background-color:#333333;font-family:"Consolas";color:#ffffff;font-weight:400}.c55{background-color:#333333;font-family:"Consolas";color:#d36363;font-weight:400}.c30{background-color:#333333;font-family:"Consolas";color:#fcc28c;font-weight:400}.c14{border-spacing:0;border-collapse:collapse;margin-right:auto}.c56{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:center}.c7{background-color:#333333;font-family:"Consolas";color:#a2fca2;font-weight:400}.c50{padding-top:38pt;padding-bottom:26pt;line-height:1.15;text-align:center}.c44{background-color:#333333;font-size:10pt;font-family:"Consolas";color:#62c8f3}.c27{background-color:#333333;font-family:"Consolas";color:#888888;font-weight:400}.c37{background-color:#333333;font-family:"Consolas";color:#ffffaa;font-weight:400}.c33{background-color:#333333;font-family:"Consolas";color:#62c8f3;font-weight:400}.c38{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:left}.c72{background-color:#2b2b2b;color:#e8bf6a;font-weight:400;font-family:"Courier New"}.c79{background-color:#333333;font-family:"Consolas";color:#c6b4f0}.c70{text-decoration:none;vertical-align:baseline;font-family:"Arial"}.c63{text-decoration:none;vertical-align:baseline;font-style:normal}.c58{background-color:#333333;font-family:"Consolas";color:#62c8f3}.c60{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c76{text-decoration:none;vertical-align:baseline;font-family:"Comfortaa"}.c78{color:#666666;font-size:12pt;font-style:normal}.c54{font-weight:400;font-size:20pt}.c80{color:#88846f;font-family:"Consolas"}.c69{color:#333333;font-family:"Arial"}.c77{color:#333333;font-style:normal}.c64{color:inherit;text-decoration:inherit}.c36{padding:0;margin:0}.c71{font-weight:400;font-size:16pt}.c42{orphans:2;widows:2}.c46{height:11pt}.c48{font-size:10.5pt}.c26{font-size:9pt}.c75{height:40.5pt}.c65{font-size:14pt}.c73{font-weight:400}.c62{font-style:italic}.c68{font-size:11pt}.c57{margin-left:36pt}.c40{color:#6aa84f}.c61{color:#000000}.c18{font-size:7pt}.c39{font-size:8pt}.c45{font-size:10pt}.c15{height:0pt}.c67{padding-left:0pt}.c43{font-weight:700}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c60 doc-content"><h1 class="c42 c74" id="h.7dhf43c1414o"><span class="c51 c54">Interface &amp; Application Programming</span></h1><h2 class="c42 c50" id="h.xbj12sz5m84r"><span class="c51 c68 c43">Objectives</span></h2><p class="c38 c42 c57"><span class="c51 c45 c43">Wk 1</span></p><ul class="c36 lst-kix_mrbf3etw55go-0 start"><li class="c12 li-bullet-0"><span class="c51 c45 c43">[x] Setup Dev Environment for ESP32 S2</span></li><li class="c12 li-bullet-0"><span class="c51 c45 c43">[x] Setup NodeJS Dev Environment on your PC</span></li><li class="c12 li-bullet-0"><span class="c51 c45 c43">[x] Add Screenshots and description of the process of creation. </span></li><li class="c12 li-bullet-0"><span class="c51 c45 c43">[x] Describe the design &amp; programming steps</span></li><li class="c12 li-bullet-0"><span class="c51 c45 c43">[x] Screenshots or video of your Prototype/app working</span></li><li class="c12 li-bullet-0"><span class="c51 c45 c43">[x] Describe any errors or problems with the process and how you fixed them. </span></li><li class="c12 li-bullet-0"><span class="c43 c45">[x] Include all the files you created for download.</span><span class="c43">&nbsp;</span></li></ul><p class="c38 c42 c57"><span class="c51 c45 c43">Wk 2</span></p><ul class="c36 lst-kix_djasomgyryj4-0 start"><li class="c12 li-bullet-0"><span class="c45 c43">[x] Build HTML5 Chat app<br></span><span class="c45">* Draw mockup / layout</span><span class="c45 c43"><br>* </span><span class="c45">frame and add </span><span class="c45">id&rsquo;s</span><span class="c45">&nbsp;to &lt;div&gt;&rsquo;s</span><span class="c43"><br>* </span><span class="c51 c73 c45">Style the page and <br>* wire up the JS code and understand</span></li></ul><p class="c38 c42 c57"><span class="c51 c45 c43">Wk 3</span></p><ul class="c36 lst-kix_djasomgyryj4-0"><li class="c12 li-bullet-0"><span class="c45 c43">[x] Build Chat app back-end NodeJS<br></span><span class="c51 c73 c45">* Build NodeJS server side to: <br>* host your ChatApp (Express static HTML)<br>* Build / test API endpoints (for: users &amp; messages)</span></li></ul><p class="c38 c42 c57"><span class="c51 c45 c43">Wk 4</span></p><ul class="c36 lst-kix_djasomgyryj4-0"><li class="c12 li-bullet-0"><span class="c45 c43">[x] Setup MongoDB datastore &amp; connect via NodeJS</span><span class="c45"><br>* Setup MongoDB datastore + mongoose ODM (Object-Document-Manager)<br>* Store and recall message data using an API (ex. request top 100 msg)<br>* Wire up MongoDB to API endpoints</span><span class="c43"><br>* </span><span class="c51 c73 c45">Update app-flow to use back-end for Users and &ldquo;old&rdquo; messages</span></li></ul><p class="c38 c42 c57"><span class="c51 c45 c43">Wk 5</span></p><ul class="c36 lst-kix_djasomgyryj4-0"><li class="c12 li-bullet-0"><span class="c45 c43">[x] Create data-bound widgets to display sensor data<br></span><span class="c45">&nbsp;* On ESP32 add MQTT client + ArduinoJSON<br> * Send Sensor data to MQTT server (as a JSON object)<br> * Create a DataCard, a Gauge and a time Chart widget on Dashboard (use chat app)<br> * Strategy on DataBinding and Widget updating (Last updated)<br> * User Login/Pw (state persistence)</span></li></ul><ul class="c36 lst-kix_xt5lbbahzf58-0 start"><li class="c12 li-bullet-0"><span class="c45 c43 c51">[] Explain the HackOmation quadrant in relation to your final project.</span></li><li class="c12 li-bullet-0"><span class="c45 c43">[] Build UI mockups for your FInal Project and HTML Layout</span></li></ul><h2 class="c47 c42" id="h.m3vg3k82ngju"><span class="c51 c71">Setup Development Environment for ESP32S2</span></h2><h4 class="c41 c42" id="h.u9bpq9ak0g62"><span class="c61 c43">Installing ESP32</span></h4><p class="c23"><span class="c0">The first thing I did when setting up, was actually installing the esp32s2 board in the Arduino IDE.</span></p><p class="c23"><span class="c0">I&rsquo;m documenting this way later, so I already have it installed:</span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 488.50px; height: 278.70px;"><img alt="" src="images/image4.png" style="width: 488.50px; height: 278.70px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c31"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">You can see I have to update. But I don&#39;t always do that. Since later versions limit some important stuff.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Then I just select the board I&rsquo;m using and we&rsquo;re good for setting up esp boards.</span><span style="overflow: hidden; display: inline-block; margin: -0.00px -0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 495.50px; height: 326.38px;"><img alt="" src="images/image10.png" style="width: 495.50px; height: 326.38px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><h4 class="c41 c42" id="h.f27w2152a33d"><span class="c3">Setting up SPIFFS (Serial Peripheral Interface Flash File System)</span></h4><p class="c23"><span class="c0">You can host your web server with an esp32s2. But to upload the webpage content to display on your webpage, you need to upload data to the esp32 from a data folder using SPIFFS.</span></p><p class="c2"><span class="c0"></span></p><h5 class="c52 c42" id="h.yoxhuc5elhyh"><span class="c51 c68 c43">Spiffs installation</span></h5><p class="c23"><span class="c0">If I go into my arduino folder, where all my projects are, I created a new folder called &ldquo;tools&rdquo;. In that folder I created another folder called &ldquo;ESP32FS&rdquo;. In the ESP32FS folder I created another folder called &ldquo;tool&rdquo;, and put the &ldquo;esp32s2.jar&rdquo; in that folder. The total structure should look like this:</span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 512.50px; height: 86.24px;"><img alt="" src="images/image7.png" style="width: 512.50px; height: 86.24px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">I stored the whole structure on github in a zip, so when something goes wrong, I don&#39;t have to go searching for the original one.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c40"><a class="c64" href="https://www.google.com/url?q=https://github.com/Keshav11-coder/CB2022_Keshav&amp;sa=D&amp;source=editors&amp;ust=1674418971129024&amp;usg=AOvVaw25tzzrkshG6EToHQ8pqTn4">https://github.com/Keshav11-coder/CB2022_Keshav</a></span></p><p class="c2"><span class="c21"></span></p><h5 class="c42 c52" id="h.afnf9x594yv8"><span class="c51 c68 c43">Checking if it works</span></h5><p class="c23"><span class="c0">When that has already been done, I restarted my arduino IDE and searched for an option called &ldquo;esp32 sketch data upload&rdquo;</span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: -0.00px -0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 360.60px; height: 349.50px;"><img alt="" src="images/image23.png" style="width: 360.60px; height: 349.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><h2 class="c47 c42" id="h.hfmg6ni8dhuv"><span class="c51 c71">Setup NodeJS Dev Environment on your PC</span></h2><p class="c31"><span class="c0"></span></p><p class="c23"><span class="c51 c43 c68">Lil&rsquo; story</span></p><p class="c23"><span class="c0">I already had nodeJS installed from 2021, when we were flying an AR drone with it. That was fun! I can tell you all about it! But there were a few things I had to install with it .. like NVM.</span></p><p class="c2"><span class="c0"></span></p><h4 class="c41 c42" id="h.brl4xhke8si9"><span class="c3">Upgrading my NodeJS</span></h4><p class="c23"><span class="c0">As I already said, I already had nodeJS for some time and it was a pretty old version. So I downloaded the latest version 18: </span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 469.07px; height: 263.50px;"><img alt="" src="images/image6.png" style="width: 469.07px; height: 263.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><p class="c23"><span class="c0">Installed it, and it was good to go.</span></p><p class="c2"><span class="c0"></span></p><p class="c38 c42"><span style="overflow: hidden; display: inline-block; margin: 0.00px -0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 288.50px; height: 224.03px;"><img alt="" src="images/image17.png" style="width: 288.50px; height: 224.03px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><h4 class="c41 c42" id="h.jjrs80opz2q3"><span class="c3">Installing NVM (Node Version Manager)</span></h4><p class="c31"><span class="c0"></span></p><p class="c23"><span class="c0">I didn&rsquo;t have much experience with installing this so I followed some instructions here:</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c40"><a class="c64" href="https://www.google.com/url?q=https://dev.to/skaytech/how-to-install-node-version-manager-nvm-for-windows-10-4nbi&amp;sa=D&amp;source=editors&amp;ust=1674418971135883&amp;usg=AOvVaw0GFFUoor8_cwcoGXl7iQIl">https://dev.to/skaytech/how-to-install-node-version-manager-nvm-for-windows-10-4nbi</a></span></p><p class="c2"><span class="c21"></span></p><p class="c23"><span class="c0">Basically .. </span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">I downloaded the nvm-setup zip from github: </span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c40"><a class="c64" href="https://www.google.com/url?q=https://github.com/coreybutler/nvm-windows/releases&amp;sa=D&amp;source=editors&amp;ust=1674418971136810&amp;usg=AOvVaw3Gq8bJfhT2YGwxNBsgPKv_">Releases &middot; coreybutler/nvm-windows &middot; GitHub</a></span></p><p class="c2"><span class="c21"></span></p><p class="c23"><span class="c0">&hellip; unzipped it, took the nvm-setup folder somewhere safe and double-clicked the nvm-setop.exe file inside of it.</span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 93.33px;"><img alt="" src="images/image5.png" style="width: 624.00px; height: 93.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: -0.00px -0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 446.86px; height: 363.50px;"><img alt="" src="images/image12.png" style="width: 446.86px; height: 363.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><h5 class="c52 c42" id="h.ao22hvmnvq7s"><span class="c51 c68 c43">Checking if it works</span></h5><p class="c23"><span class="c0">Now that all of that is finished, I opened the NodeJS command prompt.</span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 319.00px; height: 321.00px;"><img alt="" src="images/image16.png" style="width: 624.00px; height: 351.00px; margin-left: -19.00px; margin-top: -15.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><p class="c23"><span class="c0">And typed in: &ldquo;Node&rdquo;, &ldquo;nvm&rdquo;, &ldquo;npm&rdquo;; to check if everything works. If it doesn&rsquo;t give an error, it&rsquo;s good. If it does, I did something wrong.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 357.33px;"><img alt="" src="images/image9.png" style="width: 624.00px; height: 357.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><h2 class="c42 c47" id="h.xngok832s36t"><span class="c43">Chatapp</span></h2><p class="c23"><span class="c0">Next we had to build a chat app with MQTT and html, css and javascript.</span></p><p class="c23"><span class="c0">Lucky me, because I knew those languages very well.</span></p><p class="c2"><span class="c0"></span></p><h4 class="c41 c42" id="h.7z8ddmfrrq2f"><span class="c3">MQTT debugging setup</span></h4><p class="c23"><span class="c0">In the session, Mr Theo showed us how to use mqtt. Here&rsquo;s how we did it.</span></p><p class="c2"><span class="c0"></span></p><h5 class="c52 c42" id="h.hw7gm9jcd37k"><span class="c63 c68 c43 c69">MQTTLens</span></h5><p class="c23"><span class="c0">Mqttlens is a chrome extension, or wep app, that you can add to chrome. I added it already:</span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: -0.00px -0.00px; border: 2.67px solid #333333; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 498.50px; height: 280.41px;"><img alt="" src="images/image11.png" style="width: 498.50px; height: 280.41px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Now that we added it, let&#39;s launch the app:</span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: -0.00px -0.00px; border: 2.67px solid #333333; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 505.00px; height: 284.06px;"><img alt="" src="images/image14.png" style="width: 505.00px; height: 284.06px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><h5 class="c52 c42" id="h.baoq07b09kko"><span class="c51 c68 c43">Setup connection to HIVEMQ</span></h5><p class="c23"><span class="c0">As you can see, I already have a connection named &ldquo;bootcamp2022&rdquo;, here are the settings.</span><span style="overflow: hidden; display: inline-block; margin: -0.00px -0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 470.50px; height: 410.93px;"><img alt="" src="images/image1.png" style="width: 470.50px; height: 410.93px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><p class="c23"><span class="c66 c62 c61">As you also can see in the heading title, I said HIVEMQ instead of MQTT, because while coding we had some problems with MQTT, so we switched to HIVEMQ. HIVEMQ is built on top of MQTT, so basically MQTT but better.</span></p><p class="c2"><span class="c62 c61 c66"></span></p><p class="c23"><span class="c0">Next we set the topic, which is currently set to &ldquo;codettes2022&rdquo;, to .. well .. &ldquo;codettes2022&rdquo; at both places. Then we type a message. And then click on &ldquo;subscribe&rdquo; and then publish to publish the message:</span><span style="overflow: hidden; display: inline-block; margin: 0.00px -0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 381.00px; height: 214.05px;"><img alt="" src="images/image3.png" style="width: 381.00px; height: 214.05px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&nbsp;</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><p class="c23"><span class="c0">Now you see the message popup down there.</span></p><h4 class="c41 c42" id="h.mq8nbi9usk35"><span class="c3">Creating a sketch of my chat app</span></h4><p class="c23"><span class="c0">After explaining how MQTT works, we had to make a sketch. My sketch looks like this:</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: -13.26px 13.26px; border: 0.00px solid #000000; transform: rotate(4.71rad) translateZ(0px); -webkit-transform: rotate(4.71rad) translateZ(0px); width: 385.47px; height: 411.98px;"><img alt="" src="images/image21.png" style="width: 385.47px; height: 411.98px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Now we had to make that into html tags. (transforming it into a web page/chat app)</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">I first started looking through some html tags that might be useful. Such as</span></p><p class="c23"><span class="c0">&nbsp;</span></p><ul class="c36 lst-kix_lr2po1pqbijq-0 start"><li class="c20 c67 li-bullet-0"><span class="c0">&lt;aside&gt;</span></li><li class="c20 c67 li-bullet-0"><span class="c0">&lt;div&gt;</span></li><li class="c20 c67 li-bullet-0"><span class="c0">&lt;input&gt;</span></li><li class="c20 c67 li-bullet-0"><span class="c0">&lt;button&gt;</span></li><li class="c20 c67 li-bullet-0"><span class="c0">&lt;h4&gt;</span></li></ul><p class="c20 c46"><span class="c0"></span></p><p class="c20"><span class="c0">Etc .. </span></p><p class="c20 c46"><span class="c0"></span></p><p class="c20 c46"><span class="c0"></span></p><p class="c20 c46"><span class="c0"></span></p><p class="c20 c46"><span class="c0"></span></p><p class="c20 c46"><span class="c0"></span></p><p class="c20 c46"><span class="c0"></span></p><h5 class="c52 c42" id="h.mhrywkjcd5b3"><span class="c51 c68 c43">Coding</span></h5><p class="c23"><span class="c0">The first thing I started doing is making a basic userlist with the &lt;aside&gt; element:</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 122.37px; height: 242.50px;"><img alt="" src="images/image18.png" style="width: 122.37px; height: 242.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c20 c46"><span class="c0"></span></p><p class="c20 c46"><span class="c0"></span></p><p class="c20 c46"><span class="c0"></span></p><p class="c20 c46"><span class="c0"></span></p><p class="c20 c46"><span class="c0"></span></p><p class="c20 c46"><span class="c0"></span></p><p class="c20 c46"><span class="c0"></span></p><p class="c20 c46"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">It doesn&rsquo;t update itself yet, but that will be fixed later. The basic code structure for this is:</span></p><p class="c2"><span class="c0"></span></p><a id="t.8c3db0ccc5ec65c65460eefe0e01b7118abd80d2"></a><a id="t.0"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c19">&lt;</span><span class="c44 c43">aside</span><span class="c19">&gt;</span><span class="c5"><br></span><span class="c19">&lt;</span><span class="c44 c43">div</span><span class="c19">&nbsp;class=</span><span class="c4">&quot;chat-bg&quot;</span><span class="c19">&gt;</span><span class="c5"><br> &nbsp; </span><span class="c19">&lt;</span><span class="c44 c43">div</span><span class="c19">&nbsp;class=</span><span class="c4">&quot;status&quot;</span><span class="c19">&gt;</span><span class="c5"><br> &nbsp; </span><span class="c19">&lt;/</span><span class="c44 c43">div</span><span class="c19">&gt;</span><span class="c5"><br> &nbsp; </span><span class="c19">&lt;</span><span class="c44 c43">h4</span><span class="c19">&nbsp;style=</span><span class="c4">&quot;font-family: arial; text-align: center;&quot;</span><span class="c19">&gt;</span><span class="c5">chats</span><span class="c19">&lt;/</span><span class="c44 c43">h4</span><span class="c19">&gt;</span><span class="c5"><br> &nbsp; </span><span class="c19">&lt;</span><span class="c44 c43">div</span><span class="c19">&nbsp;class=</span><span class="c4">&quot;codettesBootcamp2022&quot;</span><span class="c19">&gt;</span><span class="c5"><br> &nbsp; &nbsp; &nbsp; </span><span class="c19">&lt;</span><span class="c44 c43">img</span><span class="c19">&nbsp;class=</span><span class="c4">&quot;bootcamp2022LOGO&quot;</span><span class="c19">&nbsp;src=</span><span class="c4">&quot;bootcamplogo.jpg&quot;</span><span class="c19">&gt;</span><span class="c5"><br> &nbsp; &nbsp; &nbsp; </span><span class="c19">&lt;</span><span class="c44 c43">h4</span><span class="c19">&nbsp;class=</span><span class="c4">&quot;</span><span class="c4">bootcamp2022name</span><span class="c4">&quot;</span><span class="c19">&gt;</span><span class="c5">Bootcamp2022</span><span class="c19">&lt;/</span><span class="c43 c44">h4</span><span class="c19">&gt;</span><span class="c5"><br> &nbsp; </span><span class="c19">&lt;/</span><span class="c44 c43">div</span><span class="c19">&gt;</span><span class="c5"><br> &nbsp; </span><span class="c19">&lt;</span><span class="c44 c43">div</span><span class="c19">&nbsp;id=</span><span class="c4">&quot;userlist&quot;</span><span class="c19">&gt;&lt;/</span><span class="c44 c43">div</span><span class="c19">&gt;</span><span class="c5"><br></span><span class="c19">&lt;/</span><span class="c44 c43">div</span><span class="c19">&gt;</span><span class="c5"><br></span><span class="c19">&lt;/</span><span class="c44 c43">aside</span><span class="c19">&gt;</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">As you can see, it&#39;s all inside an &lt;aside&gt; element.</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Then we have my chat app code:</span></p><p class="c2"><span class="c0"></span></p><a id="t.a9754409e2a330ef22b5b4e0164df3ef238c3f2a"></a><a id="t.1"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c33 c18">&lt;</span><span class="c13">aside</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br> &nbsp; </span><span class="c33 c18">&lt;</span><span class="c13">div</span><span class="c33 c18">&nbsp;class=</span><span class="c7 c18">&quot;chat-LOG&quot;</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br> &nbsp; &nbsp; &nbsp; </span><span class="c33 c18">&lt;</span><span class="c13">div</span><span class="c33 c18">&nbsp;class=</span><span class="c7 c18">&quot;person&quot;</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c33 c18">&lt;</span><span class="c13">h3</span><span class="c33 c18">&nbsp;class=</span><span class="c7 c18">&quot;person-name&quot;</span><span class="c33 c18">&gt;</span><span class="c11 c18">Bootcamp2022</span><span class="c33 c18">&lt;/</span><span class="c13">h3</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br> &nbsp; &nbsp; &nbsp; </span><span class="c33 c18">&lt;/</span><span class="c13">div</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br> &nbsp; &nbsp; &nbsp; </span><span class="c33 c18">&lt;</span><span class="c13">div</span><span class="c33 c18">&nbsp;class=</span><span class="c7 c18">&quot;text-inpt&quot;</span><span class="c33 c18">&nbsp;style=</span><span class="c7 c18">&quot;width: 100%;&quot;</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c33 c18">&lt;</span><span class="c13">div</span><span class="c33 c18">&nbsp;id=</span><span class="c7 c18">&quot;chatlog&quot;</span><span class="c33 c18">&nbsp;style=</span><span class="c7 c18">&quot;width: 100%; height: 650px; text-align: center;&quot;</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c33 c18">&lt;</span><span class="c13">h6</span><span class="c33 c18">&nbsp;style=</span><span class="c7 c18">&quot;margin: 0; padding-top: 10px;&quot;</span><span class="c33 c18">&gt;</span><span class="c11 c18">this chat isn&#39;t safe, so chances of message leaks are<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; high. be<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; careful.</span><span class="c18 c33">&lt;/</span><span class="c13">h6</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c33 c18">&lt;</span><span class="c13">div</span><span class="c33 c18">&nbsp;id=</span><span class="c7 c18">&quot;name&quot;</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c33 c18">&lt;/</span><span class="c13">div</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c33 c18">&lt;/</span><span class="c13">div</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c33 c18">&lt;</span><span class="c13">input</span><span class="c33 c18">&nbsp;class=</span><span class="c7 c18">&quot;</span><span class="c7 c18">inpt</span><span class="c7 c18">&quot;</span><span class="c33 c18">&nbsp;type=</span><span class="c7 c18">&quot;text&quot;</span><span class="c33 c18">&nbsp;id=</span><span class="c7 c18">&quot;chatInput&quot;</span><span class="c33 c18">&nbsp;onkeydown=</span><span class="c7 c18">&quot;sendMsg(this)&quot;</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c33 c18">&lt;</span><span class="c13">button</span><span class="c33 c18">&nbsp;class=</span><span class="c7 c18">&quot;sendButton&quot;</span><span class="c33 c18"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onclick=</span><span class="c7 c18">&quot;sendMessageButton(getElementById(&#39;chatInput&#39;).value); getElementById(&#39;chatInput&#39;).value=&#39;&#39;;&quot;</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c18 c27">&lt;!--digital art--&gt;</span><span class="c11 c18"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c33 c18">&lt;</span><span class="c13">img</span><span class="c33 c18">&nbsp;class=</span><span class="c7 c18">&quot;send-img&quot;</span><span class="c33 c18">&nbsp;src=</span><span class="c7 c18">&quot;sendmessage-orig.png&quot;</span><span class="c33 c18">&gt;&lt;/</span><span class="c13">button</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br> &nbsp; &nbsp; &nbsp; </span><span class="c33 c18">&lt;/</span><span class="c13">div</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br> &nbsp; </span><span class="c33 c18">&lt;/</span><span class="c13">div</span><span class="c33 c18">&gt;</span><span class="c11 c18"><br></span><span class="c33 c18">&lt;/</span><span class="c13">aside</span><span class="c33 c63 c18">&gt;</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Here it&rsquo;s also in an &lt;aside&gt; element, but then we have a bunch of div&rsquo;s. First the chat log div, where you chat. In there is another div, where the person you are talking to is displayed. Then we come to the text-input element. In there the chat log element. Then we have a little warning, and then we add some spacing because we cannot give the inputs paddings or margins, else we cannot display our messages. And then we add the input and the button, and finally we close it.</span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 481.50px; height: 338.22px;"><img alt="" src="images/image22.png" style="width: 481.50px; height: 338.22px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><h6 class="c52 c42" id="h.36lrfsxx5iia"><span class="c43 c61">L</span><span class="c70 c62 c68 c61 c43">ibraries</span></h6><p class="c23"><span class="c0">A key thing to note is that we need the mqtt library in order to use it in our javascript. Actually this had to be first but here it is, all in the &lt;head&gt; element:</span></p><p class="c2"><span class="c0"></span></p><a id="t.9ed72fda0cd38c3480e3b8be9b4d1589bef128b8"></a><a id="t.2"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c19">&lt;</span><span class="c44 c43">head</span><span class="c19">&gt;</span><span class="c5"><br> &nbsp; </span><span class="c19">&lt;</span><span class="c44 c43">meta</span><span class="c19">&nbsp;charset=</span><span class="c4">&quot;UTF-8&quot;</span><span class="c19">&gt;</span><span class="c5"><br> &nbsp; </span><span class="c19">&lt;</span><span class="c44 c43">title</span><span class="c19">&gt;</span><span class="c5">bootcamp2022GANG</span><span class="c19">&lt;/</span><span class="c44 c43">title</span><span class="c19">&gt;</span><span class="c5"><br> &nbsp; </span><span class="c19">&lt;</span><span class="c44 c43">link</span><span class="c19">&nbsp;rel=</span><span class="c4">&quot;stylesheet&quot;</span><span class="c19">&nbsp;type=</span><span class="c4">&quot;text/css&quot;</span><span class="c19">&nbsp;href=</span><span class="c4">&quot;style.css&quot;</span><span class="c19">&gt;</span><span class="c5"><br> &nbsp; </span><span class="c19">&lt;</span><span class="c44 c43">script</span><span class="c19">&nbsp;src=</span><span class="c4">&quot;https://cdnjs.cloudflare.com/ajax/libs/mqtt/4.3.7/mqtt.min.js&quot;</span><span class="c19">&nbsp;type=</span><span class="c4">&quot;text/javascript&quot;</span><span class="c19">&gt;&lt;/</span><span class="c44 c43">script</span><span class="c19">&gt;</span><span class="c5"><br></span><span class="c19">&lt;/</span><span class="c44 c43">head</span><span class="c19">&gt;</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Now that we have that done, I can show you the complete thing:</span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 539.50px; height: 303.47px;"><img alt="" src="images/image8.png" style="width: 539.50px; height: 303.47px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Now let&#39;s code some javascript.</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&gt;&gt;</span></p><p class="c2"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><h6 class="c52 c42" id="h.64ol3aal5mx"><span class="c61 c43">J</span><span class="c62 c68 c61 c43 c70">avascript - introduction</span></h6><p class="c23"><span class="c62 c68 c61 c43 c76">&ldquo;Javascript is a hot language, it was originally created to move things around and to make things jump from one place to another on the page, but now it is a very popular language and almost all websites use javascript. Javascript can do anything, apply cookies secretly, hide stuff, completely change the html and css, redirect you to a hack site, spoof your data, etc .. that&rsquo;s why some browsers have an option to block javascript. Or sometimes when a site has suspicious javascript, your browser advises you not to enter. An example of this is just a basic javascript loop of displaying stuff and console logging forever on the website. This will crash your computer, resulting in data loss, and the website will be blocked by your browser. Even with your own javascript. So that&#39;s why you gotta be careful with websites using javascript. But in general javascript can do a lot of awesome stuff, for more, check codepen, there are a lot of examples there.&rdquo;</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Well .. that was a long description of javascript. Let&rsquo;s start!</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">The javascript code is here, if you hate me explaining:</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c40"><a class="c64" href="https://www.google.com/url?q=https://github.com/Keshav11-coder/CB2022_Keshav&amp;sa=D&amp;source=editors&amp;ust=1674418971176605&amp;usg=AOvVaw3fLprwtFg-uFbgi4OxsrjH">https://github.com/Keshav11-coder/CB2022_Keshav</a></span></p><p class="c2"><span class="c21"></span></p><p class="c23"><span class="c0">chatappV5.0, is currently the latest;</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&gt;&gt;</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><h6 class="c52 c42" id="h.416yq3l5gf05"><span class="c70 c62 c68 c61 c43">Javascript</span></h6><p class="c23"><span class="c0">In this heading, I&#39;ll be explaining how my javascript works. </span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c24">&sect;1. Structure</span></p><p class="c23"><span class="c0">Keep your coffee ready, put on your headphones, open Spotify .. let&#39;s dive in .. </span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">For our code, we need the whole code to run in order to &ldquo;connect&rdquo;. But when you try to send a message, it wont work. That is if you put it in a function. And the sendMessage is also a function. You cannot call functions in functions in javascript. So we&rsquo;re gonna work with class objects. But not the regular class .. objects .. </span></p><p class="c2"><span class="c0"></span></p><a id="t.6b4c857a8096e386f80507090aa457f0c09d2714"></a><a id="t.3"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c11">app = {<br>connection:</span><span class="c30">function</span><span class="c11">(){<br>}</span></p></td></tr></table><p class="c2"><span class="c51 c68 c43"></span></p><p class="c23"><span class="c0">And in the connect function we put everything .. the settings, the client.on&rsquo;s, and the settings (opts).</span></p><p class="c23"><span class="c0">And anything that does something physical on the page, goes out of the object.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c24">&sect;2. settings/variables</span></p><p class="c23"><span class="c0">Everything needs settings or variables, else it just can&rsquo;t work. Our app too.</span></p><p class="c23"><span class="c0">It&rsquo;s a lot, but it&rsquo;s worth it.</span></p><p class="c2"><span class="c0"></span></p><a id="t.ebd1c85f120b9d3b182bf216fc0da0be15666b87"></a><a id="t.4"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c30 c18">var</span><span class="c11 c18">&nbsp;USER = </span><span class="c37 c18">document</span><span class="c11 c18">.getElementById(</span><span class="c7 c18">&#39;logon-as&#39;</span><span class="c11 c18">).value;<br></span><span class="c30 c18">var</span><span class="c11 c18">&nbsp;ID = </span><span class="c37 c18">document</span><span class="c11 c18">.getElementById(</span><span class="c7 c18">&#39;admin&#39;</span><span class="c11 c18">).value;<br></span><span class="c30 c18">var</span><span class="c11 c18">&nbsp;mqttServer = </span><span class="c7 c18">&quot;ws://broker.hivemq.com:8000/mqtt&quot;</span><span class="c11 c18">;<br></span><span class="c30 c18">var</span><span class="c11 c18">&nbsp;mqttTopic= </span><span class="c7 c18">&quot;</span><span class="c7 c18">codettes2022</span><span class="c7 c18">&quot;</span><span class="c11 c18">;3<br></span><span class="c30 c18">var</span><span class="c11 c18">&nbsp;userName = USER;<br></span><span class="c30 c18">const</span><span class="c11 c18">&nbsp;clientId = </span><span class="c7 c18">&#39;cb22_&#39;</span><span class="c11 c18">&nbsp;+ </span><span class="c37 c18">Math</span><span class="c11 c18">.random().toString(</span><span class="c55 c18">16</span><span class="c11 c18">).substr(</span><span class="c55 c18">2</span><span class="c11 c18">, </span><span class="c55 c18">8</span><span class="c11 c18">)<br></span><span class="c30 c18">var</span><span class="c11 c18">&nbsp;userList = [];<br></span><span class="c30 c18">const</span><span class="c11 c18">&nbsp;opts = {<br> keepalive: </span><span class="c55 c18">30</span><span class="c11 c18">,<br> clientId: clientId,<br> protocolId: </span><span class="c7 c18">&#39;MQTT&#39;</span><span class="c11 c18">,<br> protocolVersion: </span><span class="c55 c18">4</span><span class="c11 c18">,<br> clean: </span><span class="c30 c18">true</span><span class="c11 c18">,<br> reconnectPeriod: </span><span class="c55 c18">1000</span><span class="c11 c18">,<br> connectTimeout: </span><span class="c55 c18">30</span><span class="c11 c18">&nbsp;* </span><span class="c55 c18">1000</span><span class="c11 c18">,<br> will: {<br> &nbsp; topic: </span><span class="c7 c18">&#39;WillMsg&#39;</span><span class="c11 c18">,<br> &nbsp; payload: </span><span class="c7 c18">&#39;Connection Closed abnormally..!&#39;</span><span class="c11 c18">,<br> &nbsp; qos: </span><span class="c55 c18">0</span><span class="c11 c18">,<br> &nbsp; retain: </span><span class="c30 c18">false</span><span class="c11 c18"><br> },<br> rejectUnauthorized: </span><span class="c30 c18">false</span><span class="c11 c18"><br>}<br></span><span class="c37 c18">console</span><span class="c11 c18">.log(</span><span class="c7 c18">&#39;connecting mqtt client&#39;</span><span class="c11 c18">)<br></span><span class="c30 c18">const</span><span class="c11 c18">&nbsp;client = mqtt.connect(mqttServer, opts);</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c24">&sect;3A. client.on();</span></p><p class="c23"><span class="c0">Every app needs an on event manager. Ours too. We have a client.on(&ldquo;something&rdquo;, {}); for that. Here is an example:</span></p><p class="c2"><span class="c0"></span></p><a id="t.ead6f3f85b84c39ae313c068de03a3424eeeef19"></a><a id="t.5"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c5">client.on(</span><span class="c4">&#39;error&#39;</span><span class="c5">, </span><span class="c17">function</span><span class="c5">&nbsp;(err) {<br> </span><span class="c16">console</span><span class="c5">.log(err)<br> client.end()<br>})</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">This handles an error when there&rsquo;s an error at the client. Instead of blocking the code or continuing the script and looping through errors. It just prints the error and ends the connection to end it all.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Then we have the client.on(connect) function: </span></p><p class="c2"><span class="c0"></span></p><a id="t.e5198b2d68b3f25b442b648b9d85d7d4e439dbbf"></a><a id="t.6"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c5">client.on(</span><span class="c4">&#39;connect&#39;</span><span class="c5">, </span><span class="c17">function</span><span class="c5">&nbsp;() {<br> </span><span class="c1">// Once a connection has been made, make a subscription and send a message.</span><span class="c5"><br> </span><span class="c16">console</span><span class="c5">.log(</span><span class="c4">&#39;client connected:&#39;</span><span class="c5">&nbsp;+ clientId)<br> client.subscribe(mqttTopic, { qos: </span><span class="c55 c45">0</span><span class="c5">&nbsp;})<br><br> message = (USER + </span><span class="c4">&quot; just hopped on! say hi!&quot;</span><span class="c5">);<br> message2 = (USER + </span><span class="c4">&quot; just landed! say hello!&quot;</span><span class="c5">);<br> message3 = (USER + </span><span class="c4">&quot; joined the party! welcome!&quot;</span><span class="c5">);<br> message4 = (</span><span class="c4">&quot;welcome &quot;</span><span class="c5">+ USER +</span><span class="c4">&quot;, we hope you brought boogie&#39;s&quot;</span><span class="c5">);<br> message.destinationName = &nbsp;mqttTopic;<br> message2.destinationName = mqttTopic;<br> message3.destinationName = mqttTopic;<br> message4.destinationName = mqttTopic;<br><br> </span><span class="c17">var</span><span class="c5">&nbsp;values = [message,message2,message3,message4]<br> ToUse = values[</span><span class="c16">Math</span><span class="c5">.floor(</span><span class="c16">Math</span><span class="c5">.random() * values.length)];<br><br> client.publish(mqttTopic, ToUse, { qos: </span><span class="c55 c45">0</span><span class="c5">, retain: </span><span class="c17">false</span><span class="c5">&nbsp;})<br> sendPong();<br>})</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">This basically handles messages and what happens when a user connects. One of the examples is the message displaying. And at the end we send a pong (sends info back)</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&gt;&gt;</span></p><p class="c31"><span class="c0"></span></p><p class="c23"><span class="c24">&sect;3B. client.on();</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Then we also have the .on message event. Here:</span></p><p class="c2"><span class="c0"></span></p><a id="t.c2ba9ab51d62eac90963577639b8859179b87e4d"></a><a id="t.7"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c5">client.on(</span><span class="c4">&#39;message&#39;</span><span class="c5">, </span><span class="c17">function</span><span class="c5">&nbsp;(topic, message, packet) {<br> msg = message.toString(); </span><span class="c1">// library delivers &nbsp;buffer so convert to string first</span><span class="c5"><br> </span><span class="c16">console</span><span class="c5">.log(</span><span class="c4">&quot;onMessageArrived: &quot;</span><span class="c5">+ msg);<br> </span><span class="c1">// if it has JSON payload do NOT add to chat</span><span class="c5"><br> </span><span class="c17">try</span><span class="c5">{<br> &nbsp; msgObj = </span><span class="c16">JSON</span><span class="c5">.parse(message.toString()); </span><span class="c1">// t is JSON so handle it how u want</span><span class="c5"><br> &nbsp; </span><span class="c1">// if message has Pin of Pong in it send it to the PingPongHandler</span><span class="c5"><br> &nbsp; </span><span class="c17">if</span><span class="c5">&nbsp;(</span><span class="c16">Object</span><span class="c5">.keys(msgObj)[</span><span class="c55 c45">0</span><span class="c5">] == </span><span class="c4">&quot;ping&quot;</span><span class="c5">){sendPong();};<br> &nbsp; </span><span class="c17">if</span><span class="c5">&nbsp;(</span><span class="c16">Object</span><span class="c5">.keys(msgObj)[</span><span class="c55 c45">0</span><span class="c5">] == </span><span class="c4">&quot;pong&quot;</span><span class="c5">){handlePong(msgObj.pong);}; </span><span class="c1">// pong value is an object!!</span><span class="c5"><br> &nbsp; </span><span class="c1">// other handlers for control messages below</span><span class="c5"><br> }</span><span class="c17">catch</span><span class="c5">{<br> &nbsp; </span><span class="c16">document</span><span class="c5">.getElementById(</span><span class="c4">&quot;chatlog&quot;</span><span class="c5">).innerHTML += </span><span class="c4">&quot;&lt;br&gt;&quot;</span><span class="c5">&nbsp;+ msg;<br> }<br>})</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">This basically activates when a user receives messages. First they convert it to a string, then we check if the message has JSON content in it, if it does then we don&#39;t display it. If it doesn&#39;t then we do.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">And at the end we log the message to the chat log.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c24">&sect;4A. Ping</span></p><p class="c23"><span class="c0">Yes, and no, it&#39;s not the game of ping pong, ping pong basically does this:</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">The client pings, requests info &gt;</span></p><p class="c23"><span class="c0">&lt; the app pongs, gives info back.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Ping:</span></p><p class="c2"><span class="c0"></span></p><a id="t.ef7a8f9d0acf8e65a68ca3dbe7e2361b4a47c226"></a><a id="t.8"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c17">function</span><span class="c5">&nbsp;</span><span class="c16">sendPing</span><span class="c5">(usr=</span><span class="c4">&#39;*&#39;</span><span class="c5">){<br> &nbsp; </span><span class="c1">// ping sends out a message to all (*) or any specific user to respond if ur there</span><span class="c5"><br> &nbsp; </span><span class="c17">var</span><span class="c5">&nbsp;pingObj={ping:usr}; </span><span class="c1">// JS Object {ping : &quot;usr&quot;} -&gt; JSON {/&quot;ping/&quot;:/&quot;usr/&quot;}</span><span class="c5"><br> &nbsp; client.publish(mqttTopic, </span><span class="c16">JSON</span><span class="c5">.stringify(pingObj));<br>}</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">It just sends a ping to all and then does some more json stuff..</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span>&nbsp;</span><span class="c24">&sect;4B. Pong</span></p><p class="c23"><span class="c0">Now we send info back: </span></p><p class="c2"><span class="c0"></span></p><a id="t.824268c5c5a8a3eadc1f9b070ac085d1f4bc5c18"></a><a id="t.9"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c17">function</span><span class="c5">&nbsp;</span><span class="c16">sendPong</span><span class="c5">(){<br> &nbsp; </span><span class="c1">// sends clientID and UserName in a JSON object (and whatever u need more)</span><span class="c5"><br> &nbsp; </span><span class="c17">var</span><span class="c5">&nbsp;pongObj={pong :{userName : userName, clientId:clientId}};<br> &nbsp; client.publish(mqttTopic, </span><span class="c16">JSON</span><span class="c5">.stringify(pongObj));<br> &nbsp; </span><span class="c16">console</span><span class="c5">.log(</span><span class="c16">JSON</span><span class="c5">.stringify(pongObj));<br>}</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">This basically creates a pong object, &nbsp;publishes it into the mqtt, and then the console logs it. Because we don&#39;t want json messages in the chat. You could say this json has become cheat codes or special secret codes.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c24">&sect;5. redrawUserList</span></p><p class="c23"><span class="c0">The userList seems kind of boring and empty. So let&rsquo;s upgrade it a little. For every user that logs on, create a chat in the user list:</span></p><p class="c2"><span class="c0"></span></p><a id="t.74cecca0f1b44e3f875b5a163ee3da250668a317"></a><a id="t.10"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c17">function</span><span class="c5">&nbsp;</span><span class="c16">redrawUserList</span><span class="c5">(){<br> &nbsp; </span><span class="c1">// Generate the userlist HTML</span><span class="c5"><br> &nbsp; </span><span class="c17">var</span><span class="c5">&nbsp;ulist=</span><span class="c4">&quot;&quot;</span><span class="c5">;<br> &nbsp; userList.forEach(</span><span class="c17">function</span><span class="c5">&nbsp;(item) {<br> &nbsp; &nbsp; &nbsp; </span><span class="c1">//var x = arrayItem.prop1 + 2;</span><span class="c5"><br> &nbsp; &nbsp; &nbsp; </span><span class="c17">var</span><span class="c5">&nbsp;</span><span class="c5">CHATBUBBLE</span><span class="c5">=</span><span class="c4">&#39;&lt;div class=&quot;codettesBootcamp2022&quot;&gt;&lt;h4 class=&quot;</span><span class="c4">bootcamp2022name</span><span class="c4">&quot;&gt;&#39;</span><span class="c5">;</span><span class="c1">//&lt;/h4&gt;&lt;/div&gt;</span><span class="c5"><br> &nbsp; &nbsp; &nbsp; </span><span class="c17">if</span><span class="c5">(item.userName == USER){<br> &nbsp; &nbsp; &nbsp; }</span><span class="c17">else</span><span class="c5">{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c5">ulist+</span><span class="c5">= </span><span class="c5">CHATBUBBLE</span><span class="c5">&nbsp;+ item.userName + </span><span class="c4">&quot;&lt;i class=&#39;fa fa-fw fa-phone&#39;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;&quot;</span><span class="c5">+ </span><span class="c4">&quot;&lt;/h4&gt;&lt;/div&gt;&quot;</span><span class="c5">&nbsp;+</span><span class="c4">&quot;&lt;br&gt;&quot;</span><span class="c5"><br> &nbsp; &nbsp; &nbsp; }<br> &nbsp; });<br> &nbsp; </span><span class="c16">console</span><span class="c5">.log(ulist);<br> &nbsp; </span><span class="c16">document</span><span class="c5">.getElementById(</span><span class="c4">&quot;userlist&quot;</span><span class="c5">).innerHTML=ulist;<br>}</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">So this basically does what I said: for every user that pops on, create something in the userlist.</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&gt;&gt;</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c24">&sect;6. Handle pongs</span></p><p class="c23"><span class="c0">This makes sure no person gets in the userlist twice and handles all the pongs. With these pongs the userlist can be updated:</span></p><p class="c2"><span class="c0"></span></p><a id="t.bd6f14d53db5abfc61579cb4a95425c9a7db7688"></a><a id="t.11"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c17">function</span><span class="c5">&nbsp;</span><span class="c16">handlePong</span><span class="c5">(pongObj){<br> &nbsp; </span><span class="c1">// Update Userlist with Pongs</span><span class="c5"><br> &nbsp; </span><span class="c17">const</span><span class="c5">&nbsp;index = userList.findIndex(object =&gt; {<br> &nbsp; &nbsp; </span><span class="c17">return</span><span class="c5">&nbsp;object.userName === pongObj.userName;<br> &nbsp; });<br><br> &nbsp; </span><span class="c1">//console.log(&quot;index:&quot; + index);</span><span class="c5"><br> &nbsp; </span><span class="c17">if</span><span class="c5">(index&gt;=</span><span class="c55 c45">0</span><span class="c5">){<br> &nbsp; &nbsp; &nbsp; </span><span class="c16">console</span><span class="c5">.log(</span><span class="c4">&quot;User exists&quot;</span><span class="c5">);<br> &nbsp; &nbsp; &nbsp; userList[index] = pongObj;<br> &nbsp; } </span><span class="c17">else</span><span class="c5">{<br> &nbsp; &nbsp; &nbsp; </span><span class="c16">console</span><span class="c5">.log(</span><span class="c4">&quot;New User &quot;</span><span class="c5">&nbsp;+ pongObj.userName);<br> &nbsp; &nbsp; &nbsp; userList.push(pongObj);<br> &nbsp; }<br> &nbsp; </span><span class="c1">//console.log(userList);</span><span class="c5"><br> &nbsp; redrawUserList();<br>}</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c24">&sect;7. Steal that input</span></p><p class="c23"><span class="c0">Anything that does something physical on the page, like sending messages and updating the chatlog goes outside.</span></p><p class="c2"><span class="c0"></span></p><a id="t.24f9d17ad444c0cd1fe1c42d01626066cae329be"></a><a id="t.12"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c17">var</span><span class="c5">&nbsp;USER = </span><span class="c16">document</span><span class="c5">.getElementById(</span><span class="c4">&#39;logon-as&#39;</span><span class="c5">).value;<br></span><span class="c17">var</span><span class="c5">&nbsp;ID = </span><span class="c16">document</span><span class="c5">.getElementById(</span><span class="c4">&#39;admin&#39;</span><span class="c5">).value;<br><br></span><span class="c17">function</span><span class="c5">&nbsp;</span><span class="c16">getInput</span><span class="c5">(){<br> &nbsp; </span><span class="c17">var</span><span class="c5">&nbsp;USER = </span><span class="c16">document</span><span class="c5">.getElementById(</span><span class="c4">&#39;logon-as&#39;</span><span class="c5">).value;<br> &nbsp; </span><span class="c17">var</span><span class="c5">&nbsp;ID = </span><span class="c16">document</span><span class="c5">.getElementById(</span><span class="c4">&#39;admin&#39;</span><span class="c5">).value;<br> &nbsp; </span><span class="c16">document</span><span class="c5">.getElementById(</span><span class="c4">&quot;content&quot;</span><span class="c5">).className=</span><span class="c4">&quot;content&quot;</span><span class="c5">;<br> &nbsp; </span><span class="c16">document</span><span class="c5">.getElementById(</span><span class="c4">&quot;</span><span class="c4">chatapp</span><span class="c4">&quot;</span><span class="c5">).className=</span><span class="c4">&quot;N&quot;</span><span class="c5">;<br> &nbsp; </span><span class="c16">console</span><span class="c5">.log(</span><span class="c4">&quot;alert{&gt;&gt;&#39;new user signed on as [&quot;</span><span class="c5">+ USER +</span><span class="c4">&quot;] with:id:of[&quot;</span><span class="c5">+ ID +</span><span class="c4">&quot;]&#39;&lt;&lt;}&quot;</span><span class="c5">);<br> &nbsp; </span><span class="c16">console</span><span class="c5">.log(</span><span class="c4">&quot;dialog hidden&quot;</span><span class="c5">);<br> &nbsp; app.connection();<br>}</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">We first actually do this. This gets the inputs from the login screen and saves them. So we can use them later</span></p><p class="c2"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><p class="c23"><span class="c24">&sect;8A. reborn</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">The functions that actually do something on the page are the sendMessage and sendMessageButton.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Before we can use them.. We have to declare these variables again, else they won&#39;t work:</span></p><p class="c2"><span class="c0"></span></p><a id="t.b33693339c17cbe41c512cb9cea426a1b8f8175d"></a><a id="t.13"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c17">var</span><span class="c5">&nbsp;USER = </span><span class="c16">document</span><span class="c5">.getElementById(</span><span class="c4">&#39;logon-as&#39;</span><span class="c5">).value;<br></span><span class="c17">var</span><span class="c5">&nbsp;mqttServer = </span><span class="c4">&quot;ws://broker.hivemq.com:8000/mqtt&quot;</span><span class="c5">;<br></span><span class="c17">var</span><span class="c5">&nbsp;mqttTopic= </span><span class="c4">&quot;</span><span class="c4">codettes2022</span><span class="c4">&quot;</span><span class="c5">;<br></span><span class="c17">var</span><span class="c5">&nbsp;userName = USER;</span><span class="c1">//document.getElementById(&quot;logon-as&quot;).value; // || &quot;anonymous user&quot;</span><span class="c5"><br></span><span class="c1">//var userName = &quot;anonymous usr&quot;;</span><span class="c5"><br></span><span class="c17">const</span><span class="c5">&nbsp;clientId = </span><span class="c4">&#39;cb22_&#39;</span><span class="c5">&nbsp;+ </span><span class="c16">Math</span><span class="c5">.random().toString(</span><span class="c55 c45">16</span><span class="c5">).substr(</span><span class="c55 c45">2</span><span class="c5">, </span><span class="c55 c45">8</span><span class="c5">)<br></span><span class="c17">var</span><span class="c5">&nbsp;userList = [];<br><br></span><span class="c17">const</span><span class="c5">&nbsp;opts = {<br> keepalive: </span><span class="c55 c45">30</span><span class="c5">,<br> clientId: clientId,<br> protocolId: </span><span class="c4">&#39;MQTT&#39;</span><span class="c5">,<br> protocolVersion: </span><span class="c55 c45">4</span><span class="c5">,<br> clean: </span><span class="c17">true</span><span class="c5">,<br> reconnectPeriod: </span><span class="c55 c45">1000</span><span class="c5">,<br> connectTimeout: </span><span class="c55 c45">30</span><span class="c5">&nbsp;* </span><span class="c55 c45">1000</span><span class="c5">,<br> will: {<br> &nbsp; topic: </span><span class="c4">&#39;WillMsg&#39;</span><span class="c5">,<br> &nbsp; payload: </span><span class="c4">&#39;Connection Closed abnormally..!&#39;</span><span class="c5">,<br> &nbsp; qos: </span><span class="c55 c45">0</span><span class="c5">,<br> &nbsp; retain: </span><span class="c17">false</span><span class="c5"><br> },<br> rejectUnauthorized: </span><span class="c17">false</span><span class="c5"><br>}<br><br></span><span class="c16">console</span><span class="c5">.log(</span><span class="c4">&#39;connecting mqtt client&#39;</span><span class="c5">)<br></span><span class="c17">const</span><span class="c5">&nbsp;client = mqtt.connect(mqttServer, opts);</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&gt;&gt;</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c24">&sect;8B. Physical functions</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">The sendmessage button basically checks if the text is nothing, if it&rsquo;s not then send a message. Remember that this is only triggered when the user uses the button to send messages:</span></p><a id="t.0539a8d78e6c3da25e277d06a9eed551b6241ac7"></a><a id="t.14"></a><table class="c14"><tr class="c15"></tr></table><p class="c38 c46"><span class="c0"></span></p><a id="t.7df777455c61062ecb8a465f182d2f705d474963"></a><a id="t.15"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c30">function</span><span class="c11">&nbsp;</span><span class="c37">sendMessageButton</span><span class="c11">(msgtext){<br> &nbsp; &nbsp;</span><span class="c30">if</span><span class="c11">&nbsp;(msgtext!=</span><span class="c7">&#39;&#39;</span><span class="c11">){<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c30">var</span><span class="c11">&nbsp;USER = </span><span class="c37">document</span><span class="c11">.getElementById(</span><span class="c7">&#39;logon-as&#39;</span><span class="c11">).value;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c30">var</span><span class="c11">&nbsp;userName = USER;</span><span class="c27">//document.getElementById(&quot;loginName&quot;).value; // || &quot;anonymous user&quot;</span><span class="c11"><br> &nbsp; &nbsp; &nbsp; &nbsp;client.publish(mqttTopic, userName + </span><span class="c7">&quot; says: &quot;</span><span class="c11">&nbsp;+ msgtext);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c30">if</span><span class="c11">(msgtext == </span><span class="c7">&quot;whoami&quot;</span><span class="c11">){<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c37">console</span><span class="c11">.log(userName);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;client.publish(mqttTopic, </span><span class="c7">&quot;Your name is &quot;</span><span class="c11">&nbsp;+ userName + </span><span class="c7">&quot;, silly&quot;</span><span class="c11">);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c38 c46"><span class="c0"></span></p><p class="c56"><span class="c0">And then we have the sendmessage, that just listens if you press enter and the textbox has input and then sends the message:</span></p><p class="c29"><span class="c0"></span></p><a id="t.c0d6d570bfd0b0e433d4d3592e1f6639753501a9"></a><a id="t.16"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c17">function</span><span class="c5">&nbsp;</span><span class="c16">sendMsg</span><span class="c5">(ele) {<br> &nbsp; </span><span class="c17">if</span><span class="c5">(event.key === </span><span class="c4">&#39;Enter&#39;</span><span class="c5">) {<br> &nbsp; &nbsp; &nbsp; </span><span class="c17">var</span><span class="c5">&nbsp;USER = </span><span class="c16">document</span><span class="c5">.getElementById(</span><span class="c4">&#39;logon-as&#39;</span><span class="c5">).value;<br> &nbsp; &nbsp; &nbsp; </span><span class="c17">var</span><span class="c5">&nbsp;userName = USER;</span><span class="c1">//document.getElementById(&quot;loginName&quot;).value; // || &quot;anonymous user&quot;</span><span class="c5"><br> &nbsp; &nbsp; &nbsp; </span><span class="c17">if</span><span class="c5">(ele.value == </span><span class="c4">&quot;whoami&quot;</span><span class="c5">){<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c16">console</span><span class="c5">.log(userName);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client.publish(mqttTopic, </span><span class="c4">&quot;Your name is &quot;</span><span class="c5">&nbsp;+ userName + </span><span class="c4">&quot;, silly&quot;</span><span class="c5">);<br> &nbsp; &nbsp; &nbsp; }<br> &nbsp; &nbsp; &nbsp; client.publish(mqttTopic, userName + </span><span class="c4">&quot; says: &quot;</span><span class="c5">&nbsp;+ ele.value);<br> &nbsp; &nbsp; &nbsp; </span><span class="c1">//alert(ele.value);</span><span class="c5"><br> &nbsp; &nbsp; &nbsp; ele.value = </span><span class="c4">&quot;&quot;</span><span class="c5">; </span><span class="c1">// reset the input after entering</span><span class="c5"><br> &nbsp; }<br>}</span></p></td></tr></table><p class="c29"><span class="c0"></span></p><p class="c56"><span class="c0">With all of this code together, we form the app.js. Download it at the github page somewhere above.</span></p><p class="c29"><span class="c0"></span></p><p class="c29"><span class="c0"></span></p><p class="c29"><span class="c0"></span></p><p class="c56"><span class="c0">&gt;&gt;</span></p><h4 class="c41" id="h.z4r09glchm4r"><span class="c3">Does it work though</span></h4><p class="c23"><span class="c0">Yes, it does. And I finalized it a bit. Added some new colors, and even the login screen, check it out:</span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: -0.00px 0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 323.00px;"><img alt="" src="images/image24.png" style="width: 624.00px; height: 351.00px; margin-left: 0.00px; margin-top: -28.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: -0.00px 0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 321.00px;"><img alt="" src="images/image15.png" style="width: 624.00px; height: 351.00px; margin-left: 0.00px; margin-top: -30.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span>And that is the chat app until now! Hope you enjoyed it. And as you can see, it does work.</span></p><h2 class="c47 c42" id="h.zgby92kz48ms"><span class="c32">Build Chat app back-end NodeJS</span></h2><p class="c23"><span class="c0">Hey! I&rsquo;m back, and here&rsquo;s some more documentation on NodeJS back-end in depth ..</span></p><p class="c2"><span class="c0"></span></p><h3 class="c22" id="h.hscxrv5tyao5"><span class="c51 c65 c43">Basic localhost</span></h3><p class="c23"><span class="c0">The First thing I did was of course host something on localhost:xxxx, but how did we do that? Well! Here&rsquo;s the answer: ctrl c + ctrl v. </span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&hellip;</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Just kidding, but most of it was copied from the internet sooo .. </span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span>The platform (or npm package) we used for this was </span><span class="c43">express</span><span>, express helps you host your &ldquo;website&rdquo; on localhost and do stuff with it. But why not http? That would also work .. but we had to work with express. Probably because it supports a </span><span class="c43">topic we will discuss later</span><span class="c0">, or it&rsquo;s very easy to code endpoints, just like Flask. But okay, enough of that. Let&#39;s explain the code.</span></p><p class="c2"><span class="c0"></span></p><h4 class="c41 c42" id="h.ozkp3nkyhfa8"><span class="c3">Express setup</span></h4><p class="c23"><span>To install express, all I had to do was type &ldquo;</span><span class="c62">npm i express</span><span class="c0">&rdquo; in the NodeJS terminal. If you did not know, the &ldquo;i&rdquo; in there basically refers to &ldquo;install&rdquo;, so you&rsquo;re basically telling the system:</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span>&nbsp;&ldquo;</span><span class="c62">hey listen, I said npm install, so you know I wanna install something</span><span class="c0">&rdquo;</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">After installation, I&rsquo;m gonna include the library in my javascript, like this:</span></p><a id="t.d1755323eec52194771f4872f52349e655b07d8b"></a><a id="t.17"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c30">const</span><span class="c11">&nbsp;express = </span><span class="c37">require</span><span class="c11">(</span><span class="c7">&quot;express&quot;</span><span class="c11">)<br></span><span class="c30">const</span><span class="c11">&nbsp;path = </span><span class="c37">require</span><span class="c11">(</span><span class="c7">&quot;path&quot;</span><span class="c11">)<br></span><span class="c30">const</span><span class="c11">&nbsp;app = express()</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span>We also have something called path, we can install it like this: &ldquo;</span><span class="c62">npm i path</span><span class="c0">&rdquo;.</span></p><p class="c23"><span>But here we are basically including the express and path libraries, and setting the &ldquo;app&rdquo; variable to &ldquo;express();&rdquo;. This means that you&rsquo;re telling </span><span>express</span><span class="c0">&nbsp;that you are ready, and that he needs to be ready too.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Here you can see we are taking the static files, like html css and js from the data folder and using them as a landing page when you go to localhost:</span></p><a id="t.6ed294fc3f19067d76e428aadd24c85e36489626"></a><a id="t.18"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c30 c26">const</span><span class="c11 c26">&nbsp;publicDirectoryPath = path.join(__dirname, </span><span class="c7 c26">&#39;data&#39;</span><span class="c11 c26">)<br>app.use(</span><span class="c7 c26">&#39;/&#39;</span><span class="c11 c26">, express.static(publicDirectoryPath))</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><h4 class="c41 c42" id="h.defavqlq9re1"><span class="c3">Express endpoints</span></h4><p class="c23"><span class="c0">When we&rsquo;re gonna make a &ldquo;website&rdquo;, we won&rsquo;t only have a home screen right? We also want subdomains .. so let&rsquo;s add them:</span></p><p class="c2"><span class="c0"></span></p><a id="t.c0826572f23cd6b4bdd4d379aa00f76c28541536"></a><a id="t.19"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c11">app.get(</span><span class="c7">&#39;/api.syscore.log&#39;</span><span class="c11">, (req, res) =&gt; {<br> &nbsp;res.send(</span><span class="c7">&quot;something else&quot;</span><span class="c11">)<br>})<br><br>app.get(</span><span class="c7">&#39;/api.syscore.users&#39;</span><span class="c11">, (req, res) =&gt; {<br> &nbsp;res.send(</span><span class="c7">&quot;something&quot;</span><span class="c11">)<br>})</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">We are first setting the app.get property to whatever you want, it just doesn&#39;t need to have spaces. And then we define the request(req) and the response(res) between the client and the back-end. And then we send something to the website. Of course you can also add styling and html to it by using the method up top but when you don&#39;t want to send much info except for plain text then this is the way to go.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span>Here I have an example but here we fetch some data from </span><span class="c43">MongoDB</span><span class="c0">&nbsp;and use it there, a topic i&#39;ll explain later:</span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 350.67px;"><img alt="" src="images/image13.png" style="width: 624.00px; height: 350.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><h3 class="c22" id="h.xdt3nf6l0sgu"><span class="c51 c65 c43">Set up basic communication using mqtt between back-end and client</span></h3><p class="c23"><span>If you&rsquo;ve looked at the previous </span><span>chatapp</span><span class="c0">&nbsp;code, you&rsquo;ve probably seen functions like &ldquo;client.on message&rdquo; or &ldquo;handlepong&rdquo; or &ldquo;sendmessage&rdquo; .. we are going to use those functions here too.</span></p><h4 class="c41 c42" id="h.cz613hnrmu18"><span class="c3">Mqtt setup NodeJS</span></h4><p class="c23"><span class="c0">To set up mqtt, I first had to install mqtt using the usual: &ldquo;npm i mqtt&rdquo; .. and then the setup in the code:</span></p><p class="c2"><span class="c0"></span></p><a id="t.7d7013e7eb4e60abc6e4931be37fbc29824bce0f"></a><a id="t.20"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c30">const</span><span class="c11">&nbsp;mqtt = require(</span><span class="c7">&#39;mqtt&#39;</span><span class="c11">)<br></span><span class="c30">const</span><span class="c11">&nbsp;client = mqtt.</span><span class="c37">connect</span><span class="c11">(</span><span class="c7">&quot;ws://broker.hivemq.com:8000/mqtt&quot;</span><span class="c11">)</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">We are doing the basic stuff, saying that mqtt is the package mqtt, and connecting to the broker.</span></p><h4 class="c41 c42" id="h.ecleeiewqp2m"><span class="c3">Callbacks and functions</span></h4><p class="c23"><span class="c0">As I already said, we have a few (alot!) functions that we have to add to get our chat app working with NodeJS. </span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c51 c68 c43">&gt;&gt;next page&gt;&gt;</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c24">&sect;1. Callbacks</span></p><p class="c23"><span class="c0">The first callback we&rsquo;ll talk about is the connect callback. But what are callbacks exactly? For example the connect callback, it basically looks out for when a client connects to my app, and does what&#39;s in its brackets. And when a client (currently you) is already connected, it stays idle. (according to my research)</span></p><p class="c2"><span class="c0"></span></p><a id="t.81cc8c7df1fa9fbcf39ffc3a9de805255410ca2b"></a><a id="t.21"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c5">client.on(</span><span class="c4">&#39;connect&#39;</span><span class="c5">, </span><span class="c17">function</span><span class="c5">&nbsp;() {<br> client.subscribe(</span><span class="c4">&#39;codettes2022&#39;</span><span class="c5">, </span><span class="c17">function</span><span class="c5">&nbsp;(err) {<br> &nbsp; </span><span class="c17">if</span><span class="c5">&nbsp;(!err) {<br> &nbsp; &nbsp; client.publish(</span><span class="c4">&#39;codettes2022&#39;</span><span class="c5">, </span><span class="c4">&#39;Hello from NodeJS (No you </span><span class="c4">cant</span><span class="c4">&nbsp;eat it)&#39;</span><span class="c5">)<br> &nbsp; }<br> })<br>})</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&rdquo;</span></p><p class="c23"><span class="c0">The next callback checks when a message arrives. When it gets the message, it checks whether the message has JSON code in it, if it does, do something, if it doesn&rsquo;t, filter it and don&#39;t display it. Else display the message.</span></p><p class="c2"><span class="c0"></span></p><a id="t.5374ca16243db5f89348e6685e47b4f6b3ccb9b5"></a><a id="t.22"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c11 c39">client.on(</span><span class="c7 c39">&#39;message&#39;</span><span class="c11 c39">, </span><span class="c30 c39">function</span><span class="c11 c39">&nbsp;(topic, message) {<br> </span><span class="c27 c39">// message is Buffer</span><span class="c11 c39"><br> &nbsp;</span><span class="c30 c39">try</span><span class="c11 c39">&nbsp;{<br> &nbsp; &nbsp; &nbsp;msgObj = </span><span class="c37 c39">JSON</span><span class="c11 c39">.parse(message.toString()); </span><span class="c27 c39">// t is JSON so handle it how u want</span><span class="c11 c39"><br> &nbsp; &nbsp; &nbsp;</span><span class="c27 c39">// if message has Pin of Pong in it send it to the PingPongHandler</span><span class="c11 c39"><br> &nbsp; &nbsp; &nbsp;</span><span class="c30 c39">if</span><span class="c11 c39">&nbsp;(</span><span class="c37 c39">Object</span><span class="c11 c39">.keys(msgObj)[</span><span class="c55 c39">0</span><span class="c11 c39">] == </span><span class="c7 c39">&quot;ping&quot;</span><span class="c11 c39">) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sendPong(</span><span class="c7 c39">&quot;codettes2022&quot;</span><span class="c11 c39">,</span><span class="c7 c39">&quot;Server&quot;</span><span class="c11 c39">, </span><span class="c7 c39">&quot;cb_12345678&quot;</span><span class="c11 c39">);<br> &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp;</span><span class="c30 c39">if</span><span class="c11 c39">&nbsp;(</span><span class="c37 c39">Object</span><span class="c11 c39">.keys(msgObj)[</span><span class="c55 c39">0</span><span class="c11 c39">] == </span><span class="c7 c39">&quot;pong&quot;</span><span class="c11 c39">) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;handlePong(msgObj.pong);<br> &nbsp; &nbsp; &nbsp;}; </span><span class="c27 c39">// pong value is an object!!</span><span class="c11 c39"><br> &nbsp; &nbsp; &nbsp;</span><span class="c27 c39">// other handlers for control messages below</span><span class="c11 c39"><br> &nbsp;} </span><span class="c30 c39">catch</span><span class="c11 c39">&nbsp;{<br> &nbsp; &nbsp; &nbsp;messages.push({</span><span class="c7 c39">&quot;time&quot;</span><span class="c11 c39">&nbsp;: </span><span class="c37 c39">Date</span><span class="c11 c39">(), &nbsp;</span><span class="c7 c39">&quot;topic&quot;</span><span class="c11 c39">&nbsp;: topic, </span><span class="c7 c39">&quot;message&quot;</span><span class="c11 c39">&nbsp;: message.toString()});<br> &nbsp;}<br> </span><span class="c37 c39">console</span><span class="c11 c39">.log(message.toString())<br>})</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&gt;&gt;</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c24">&sect;2. Functions</span></p><p class="c23"><span class="c0">There&rsquo;s no code without functions. Or, there can be, but then it&rsquo;s really messed up and not structured. Even my app uses functions a lot.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">The first function that we use is the sendPing function. As I already said, It just sends a ping to all and then does some more json stuff.</span></p><p class="c2"><span class="c0"></span></p><a id="t.3d60bc0d62b2a0ac478e3e48f17a8276dd855ac2"></a><a id="t.23"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c17">function</span><span class="c5">&nbsp;sendPing(usr = </span><span class="c4">&#39;*&#39;</span><span class="c5">, mqttTopic = </span><span class="c4">&quot;</span><span class="c4">codettes2022</span><span class="c4">&quot;</span><span class="c5">) {<br> &nbsp; var pingObj = {<br> &nbsp; &nbsp; &nbsp; ping: usr<br> &nbsp; }; // JS Object {ping : </span><span class="c4">&quot;usr&quot;</span><span class="c5">} -&gt; JSON {/</span><span class="c4">&quot;ping/&quot;</span><span class="c5">:/</span><span class="c4">&quot;usr/&quot;</span><span class="c5">}<br> &nbsp; client.publish(mqttTopic, JSON.stringify(pingObj));<br>}</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span>And then we have the </span><span>pong</span><span class="c0">&nbsp;function. That basically sends a pong (response) to everyone. In short: sending information back.</span></p><p class="c2"><span class="c0"></span></p><a id="t.5f17612388480a30822952b2830c6a134c69def0"></a><a id="t.24"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c17">function</span><span class="c5">&nbsp;</span><span class="c16">sendPong</span><span class="c5">(_mqttTopic = </span><span class="c4">&quot;codettes2022&quot;</span><span class="c5">, _userName = </span><span class="c4">&quot;Server&quot;</span><span class="c5">, _clientId = </span><span class="c4">&quot;cb_12345678&quot;</span><span class="c5">) {<br> &nbsp; </span><span class="c1">// sends clientID and UserName in a JSON object (and whatever u need more)</span><span class="c5"><br> &nbsp; </span><span class="c17">var</span><span class="c5">&nbsp;pongObj = {<br> &nbsp; &nbsp; &nbsp; pong: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; userName: _userName,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clientId: _clientId<br> &nbsp; &nbsp; &nbsp; }<br> &nbsp; };<br> &nbsp; </span><span class="c16">console</span><span class="c5">.log(</span><span class="c16">JSON</span><span class="c5">.stringify(pongObj));<br> &nbsp; client.publish(_mqttTopic, </span><span class="c16">JSON</span><span class="c5">.stringify(pongObj));<br>}</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span>And then we have the handle pong, no person gets in the userlist twice and the </span><span>handlepong</span><span class="c0">&nbsp;handles all the pongs. With these pongs the userlist can be updated, as I already said.</span></p><p class="c2"><span class="c0"></span></p><a id="t.97550e24f4f1c160ed397a3e591f22bff0e3ba8c"></a><a id="t.25"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c30 c39">function</span><span class="c11 c39">&nbsp;</span><span class="c37 c39">handlePong</span><span class="c11 c39">(pongObj) {<br> &nbsp; </span><span class="c30 c39">const</span><span class="c11 c39">&nbsp;index = userList.findIndex(object =&gt; {<br> &nbsp; &nbsp; &nbsp; </span><span class="c30 c39">return</span><span class="c11 c39">&nbsp;object.userName === pongObj.userName;<br> &nbsp; });<br> &nbsp; </span><span class="c30 c39">if</span><span class="c11 c39">&nbsp;(index &gt;= </span><span class="c55 c39">0</span><span class="c11 c39">) {<br> &nbsp; &nbsp; &nbsp; </span><span class="c37 c39">console</span><span class="c11 c39">.log(</span><span class="c7 c39">&quot;User exists&quot;</span><span class="c11 c39">);<br> &nbsp; &nbsp; &nbsp; userList[index] = pongObj;<br> &nbsp; } </span><span class="c30 c39">else</span><span class="c11 c39">&nbsp;{<br> &nbsp; &nbsp; &nbsp; </span><span class="c37 c39">console</span><span class="c11 c39">.log(</span><span class="c7 c39">&quot;New User &quot;</span><span class="c11 c39">&nbsp;+ pongObj.userName);<br> &nbsp; &nbsp; &nbsp; userList.push(pongObj);<br> &nbsp; }<br>}</span></p></td></tr></table><h3 class="c22" id="h.tm3x7a558yuj"><span class="c51 c65 c43">Last man standing</span></h3><p class="c23"><span class="c0">So now that we have all that, ending off is the same, we just add the endpoints and listen at port 3000</span></p><p class="c2"><span class="c0"></span></p><a id="t.77bb5107220da6d15f8e466fe49377a6875b74ed"></a><a id="t.26"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c73 c45 c79">//</span><span class="c5">&nbsp;Express static webserserver<br>const publicDirectoryPath = path.join(__dirname, </span><span class="c4">&#39;data&#39;</span><span class="c5">)<br>app.use(</span><span class="c4">&#39;/&#39;</span><span class="c5">,express.static(publicDirectoryPath))<br><br><br></span><span class="c79 c73 c45">//</span><span class="c5">&nbsp;Express API routes<br>app.get(</span><span class="c4">&#39;/log&#39;</span><span class="c5">, (req, res) =&gt; {<br> res.send(messages)<br>})<br><br>app.get(</span><span class="c4">&#39;/users&#39;</span><span class="c5">, (req, res) =&gt; {<br> res.send(userList)<br>})<br><br><br>app.listen(</span><span class="c45 c55">3000</span><span class="c5">, () =&gt; {<br> &nbsp;</span><span class="c16">console</span><span class="c5">.log(</span><span class="c4">&quot;Server has started!&quot;</span><span class="c5">)<br>})</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Ok, so now we can add all the log and info at endpoints and use it with NodeJS. Now comes storing the data somewhere, like in MongoDB, but that&rsquo;s for the next objective, see you there!</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Link to the NodeJS code:</span></p><p class="c23"><span class="c40"><a class="c64" href="https://www.google.com/url?q=https://github.com/Keshav11-coder/CB2022_Keshav/tree/main/cloudserver&amp;sa=D&amp;source=editors&amp;ust=1674418971251668&amp;usg=AOvVaw2ox6u8knIOT9PEIbzdT62u">https://github.com/Keshav11-coder/CB2022_Keshav/tree/main/cloudserver</a></span></p><p class="c31"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&gt;&gt;</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c31 c57"><span class="c51 c45 c43"></span></p><h2 class="c47 c42" id="h.1p8srux9gfbk"><span class="c32">Setup MongoDB datastore &amp; connect via NodeJS</span></h2><p class="c23"><span class="c0">Now! I said last time we need some sort of way to store our messages/users/chats .. only if we had something .. something like .. MySQL .. or ..</span></p><h3 class="c22" id="h.yoomosdywicp"><span class="c51 c65 c43">Introduction to MongoDB</span></h3><p class="c23"><span class="c0">Welcome to mongoDB! </span></p><p class="c23"><span class="c43">MongoDB</span><span class="c0">&nbsp;is a document database with the scalability and flexibility that you want with the querying and indexing that you need.</span></p><p class="c23"><span class="c0">Let&#39;s get started!</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">The first thing you will install for monitoring, debugging and managing, just like mqttLens, is MongoDBCompass. I installed it from here:</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c40"><a class="c64" href="https://www.google.com/url?q=https://www.mongodb.com/docs/manual/administration/install-community/&amp;sa=D&amp;source=editors&amp;ust=1674418971254096&amp;usg=AOvVaw04JBlSMUdvQEyBld0Pd_y7">Install MongoDB Community Edition</a></span></p><p class="c2"><span class="c21"></span></p><p class="c23"><span class="c0">I&rsquo;m broke, so I installed the community edition.</span></p><p class="c23"><span class="c0">After that, I started it up, looked through some tutorials and now I know what I&rsquo;m doing.</span></p><p class="c23"><span class="c0">Basic code for creating a collection/adding to a collection or database:</span></p><p class="c2"><span class="c0"></span></p><a id="t.14ad6e3e9713155c53f0506abe4698824b45a5c0"></a><a id="t.27"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c9">dbo.collection(</span><span class="c6">&quot;messages&quot;</span><span class="c9">).insertMany(</span><span class="c9">msgvar</span><span class="c9">, </span><span class="c25">function</span><span class="c9">&nbsp;(err, res, collection) {<br> &nbsp; &nbsp;</span><span class="c25">if</span><span class="c9">&nbsp;(err) </span><span class="c25">throw</span><span class="c9">&nbsp;err;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">console</span><span class="c9">.log(</span><span class="c6">&quot;Number of documents inserted for &lt;messages&gt;: &quot;</span><span class="c9">&nbsp;+ res.insertedCount);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c27 c48">//db.close();</span><span class="c9"><br>});</span></p></td></tr></table><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 600.50px; height: 337.47px;"><img alt="" src="images/image19.png" style="width: 600.50px; height: 337.47px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">This is a full code:</span></p><p class="c2"><span class="c0"></span></p><a id="t.44c9890d006150db9e6b73e68d3812411fd3408c"></a><a id="t.28"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c11">var MongoClient = require(</span><span class="c7">&#39;mongodb&#39;</span><span class="c11">).MongoClient;<br>var url = </span><span class="c7">&quot;mongodb://0.0.0.0:27017/&quot;</span><span class="c11">;<br><br>MongoClient.connect(url, function(err, db) {<br> &nbsp;</span><span class="c30">if</span><span class="c11">&nbsp;(err) </span><span class="c30">throw</span><span class="c11">&nbsp;err;<br> &nbsp;var dbo = db.db(</span><span class="c7">&quot;mydb&quot;</span><span class="c11">);<br> &nbsp;var myobj = [<br> &nbsp; &nbsp;{ </span><span class="c7">name:</span><span class="c11">&nbsp;</span><span class="c7">&#39;John&#39;</span><span class="c11">, </span><span class="c7">address:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Highway 71&#39;</span><span class="c11">},<br> &nbsp; &nbsp;{ </span><span class="c7">name:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Peter&#39;</span><span class="c11">, </span><span class="c7">address:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Lowstreet 4&#39;</span><span class="c11">},<br> &nbsp; &nbsp;{ </span><span class="c7">name:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Amy&#39;</span><span class="c11">, </span><span class="c7">address:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Apple st 652&#39;</span><span class="c11">},<br> &nbsp; &nbsp;{ </span><span class="c7">name:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Hannah&#39;</span><span class="c11">, </span><span class="c7">address:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Mountain 21&#39;</span><span class="c11">},<br> &nbsp; &nbsp;{ </span><span class="c7">name:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Michael&#39;</span><span class="c11">, </span><span class="c7">address:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Valley 345&#39;</span><span class="c11">},<br> &nbsp; &nbsp;{ </span><span class="c7">name:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Sandy&#39;</span><span class="c11">, </span><span class="c7">address:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Ocean blvd 2&#39;</span><span class="c11">},<br> &nbsp; &nbsp;{ </span><span class="c7">name:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Betty&#39;</span><span class="c11">, </span><span class="c7">address:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Green Grass 1&#39;</span><span class="c11">},<br> &nbsp; &nbsp;{ </span><span class="c7">name:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Richard&#39;</span><span class="c11">, </span><span class="c7">address:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Sky st 331&#39;</span><span class="c11">},<br> &nbsp; &nbsp;{ </span><span class="c7">name:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Susan&#39;</span><span class="c11">, </span><span class="c7">address:</span><span class="c11">&nbsp;</span><span class="c7">&#39;One way 98&#39;</span><span class="c11">},<br> &nbsp; &nbsp;{ </span><span class="c7">name:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Vicky&#39;</span><span class="c11">, </span><span class="c7">address:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Yellow Garden 2&#39;</span><span class="c11">},<br> &nbsp; &nbsp;{ </span><span class="c7">name:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Ben&#39;</span><span class="c11">, </span><span class="c7">address:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Park Lane 38&#39;</span><span class="c11">},<br> &nbsp; &nbsp;{ </span><span class="c7">name:</span><span class="c11">&nbsp;</span><span class="c7">&#39;William&#39;</span><span class="c11">, </span><span class="c7">address:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Central st 954&#39;</span><span class="c11">},<br> &nbsp; &nbsp;{ </span><span class="c7">name:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Chuck&#39;</span><span class="c11">, </span><span class="c7">address:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Main Road 989&#39;</span><span class="c11">},<br> &nbsp; &nbsp;{ </span><span class="c7">name:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Viola&#39;</span><span class="c11">, </span><span class="c7">address:</span><span class="c11">&nbsp;</span><span class="c7">&#39;Sideway 1633&#39;</span><span class="c11">}<br> &nbsp;];<br> &nbsp;dbo.collection(</span><span class="c7">&quot;customers&quot;</span><span class="c11">).insertMany(myobj, function(err, res) {<br> &nbsp; &nbsp;</span><span class="c30">if</span><span class="c11">&nbsp;(err) </span><span class="c30">throw</span><span class="c11">&nbsp;err;<br> &nbsp; &nbsp;console.log(</span><span class="c7">&quot;Number of documents inserted: &quot;</span><span class="c11">&nbsp;+ res.insertedCount);<br> &nbsp; &nbsp;db.close();<br> &nbsp;});<br>});</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><p class="c23"><span class="c0">But we don&#39;t want to just- AdD DaTa To MoNGoDB .. no .. I want to add JSON data when a message arrives and when a &nbsp;new user gets online. Then I want to fetch that information from mongo and use it in my endpoint, because currently it is just displaying content/message_log when you are on there at that point. When you weren&#39;t there, you missed it. But now with the mongo, we can recover that data and show the history.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">So? Let&rsquo;s do that!</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&gt;&gt;</span></p><h3 class="c22" id="h.xslylsrovf66"><span class="c51 c65 c43">Setup mongoDB in NodeJS</span></h3><p class="c23"><span class="c0">SO. As usual, we go straight into NodeJS terminal and type: &ldquo;npm i mongodb&rdquo;, and be done with the installation. </span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Now .. we set it up, the package, etc .. </span></p><p class="c2"><span class="c0"></span></p><a id="t.c26d6c10a4cc5afad9f8ce3d4def382f9a9c12ae"></a><a id="t.29"></a><table class="c14"><tr class="c75"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c8">var MongoClient</span><span class="c9">&nbsp;= require(</span><span class="c6">&#39;mongodb&#39;</span><span class="c9">).MongoClient;<br></span><span class="c8">var url</span><span class="c9">&nbsp;= </span><span class="c6">&quot;mongodb://0.0.0.0:27017/&quot;</span><span class="c9">;</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span>We also need a url, which mongodb </span><span>can</span><span>&nbsp;connect to. In our case </span><span>http://localhost:27017</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Then, we do this, now .. this piece of code is kind of complicated .. and i&#39;ll explain it briefly</span></p><p class="c2"><span class="c0"></span></p><a id="t.cd62ab7d450620a51d5702cba16327667a2588b8"></a><a id="t.30"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c9">&nbsp; &nbsp; MongoClient.connect(url, </span><span class="c25">function</span><span class="c9">&nbsp;(err, db) {<br> &nbsp; &nbsp; &nbsp;</span><span class="c25">if</span><span class="c9">&nbsp;(err) </span><span class="c25">throw</span><span class="c9">&nbsp;err;<br> &nbsp; &nbsp; &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;dbo = db.db(</span><span class="c6">&quot;</span><span class="c6">chatapp</span><span class="c6">&quot;</span><span class="c9">);<br> &nbsp; &nbsp; &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;</span><span class="c9">messageee</span><span class="c9">&nbsp;= message.toString();<br> &nbsp; &nbsp; &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;</span><span class="c9">msgvar</span><span class="c9">&nbsp;= [{ </span><span class="c6">&quot;msg&quot;</span><span class="c9">: </span><span class="c9">messageee</span><span class="c9">&nbsp;}];<br> &nbsp; &nbsp; &nbsp;dbo.collection(</span><span class="c6">&quot;messages&quot;</span><span class="c9">).insertMany(</span><span class="c9">msgvar</span><span class="c9">, </span><span class="c25">function</span><span class="c9">&nbsp;(err, res, collection) {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c25">if</span><span class="c9">&nbsp;(err) </span><span class="c25">throw</span><span class="c9">&nbsp;err;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">console</span><span class="c9">.log(</span><span class="c6">&quot;Number of documents inserted for &lt;messages&gt;: &quot;</span><span class="c9">&nbsp;+ res.insertedCount);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c27 c48">//db.close();</span><span class="c9"><br> &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp;</span><span class="c25">const</span><span class="c9">&nbsp;collection = dbo.collection(</span><span class="c6">&#39;messages&#39;</span><span class="c9">)<br> &nbsp; &nbsp; &nbsp;collection.find().toArray((err, items) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c27 c48">//console.log(items)</span><span class="c9"><br> &nbsp; &nbsp; &nbsp;})<br> &nbsp; &nbsp;});</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">Yeah well .. I gave it weird names but in general: we connect the mongoclient with the url, and then we set up the function. Much like the callbacks. Then we check if there&rsquo;s an error, if not then continue. We set up our variables. The msgvar is a JSON object. Then we add to the database&rsquo;s collection messages and insert the messages there. Basically storing all messages. And then we find the collection and then we extract all items in there and I would console log it. I removed it because it was becoming too big. And this would then go in the onmessage callback.</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&gt;&gt;</span></p><h4 class="c41 c42" id="h.x45fecqsjsn"><span class="c61 c43">Updating callbacks and functions</span></h4><p class="c23"><span class="c0">So we need to update all our callbacks and functions.</span></p><h5 class="c52 c42" id="h.oo7347igg0s9"><span class="c51 c68 c43">On message arrived</span></h5><p class="c23"><span class="c0">Okay, so now our on message arrived looks like this:</span></p><p class="c2"><span class="c0"></span></p><a id="t.b1b78e7b3376519234361f192b3670740591c3fa"></a><a id="t.31"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c11 c26">client.on(</span><span class="c7 c26">&#39;message&#39;</span><span class="c11 c26">, </span><span class="c30 c26">function</span><span class="c11 c26">&nbsp;(topic, message) {<br> &nbsp;</span><span class="c30 c26">var</span><span class="c11 c26">&nbsp;MongoClient = </span><span class="c37 c26">require</span><span class="c11 c26">(</span><span class="c7 c26">&#39;mongodb&#39;</span><span class="c11 c26">).MongoClient;<br> &nbsp;</span><span class="c30 c26">var</span><span class="c11 c26">&nbsp;url = </span><span class="c7 c26">&quot;mongodb://0.0.0.0:27017/&quot;</span><span class="c11 c26">;<br> &nbsp;</span><span class="c27 c26">// message is Buffer</span><span class="c11 c26"><br> &nbsp;</span><span class="c30 c26">try</span><span class="c11 c26">&nbsp;{<br> &nbsp; &nbsp;msgObj = </span><span class="c37 c26">JSON</span><span class="c11 c26">.parse(message.toString()); </span><span class="c27 c26">// t is JSON so handle it how u want</span><span class="c11 c26"><br> &nbsp; &nbsp;</span><span class="c27 c26">// if message has Ping of Pong in it send it to the PingPongHandler</span><span class="c11 c26"><br> &nbsp; &nbsp;</span><span class="c30 c26">if</span><span class="c11 c26">&nbsp;(</span><span class="c37 c26">Object</span><span class="c11 c26">.keys(msgObj)[</span><span class="c55 c26">0</span><span class="c11 c26">] == </span><span class="c7 c26">&quot;ping&quot;</span><span class="c11 c26">) {<br> &nbsp; &nbsp; &nbsp;sendPong(</span><span class="c7 c26">&quot;codettes2022&quot;</span><span class="c11 c26">, </span><span class="c7 c26">&quot;</span><span class="c7 c26">Keshavs</span><span class="c7 c26">&nbsp;</span><span class="c7 c26">NODEJS</span><span class="c7 c26">&nbsp;server&quot;</span><span class="c11 c26">, </span><span class="c7 c26">&quot;cb__SERVER{usr:&#39;Keshav&#39;::S_id__unwn}&quot;</span><span class="c11 c26">);<br> &nbsp; &nbsp;};<br> &nbsp; &nbsp;</span><span class="c30 c26">if</span><span class="c11 c26">&nbsp;(</span><span class="c37 c26">Object</span><span class="c11 c26">.keys(msgObj)[</span><span class="c55 c26">0</span><span class="c11 c26">] == </span><span class="c7 c26">&quot;pong&quot;</span><span class="c11 c26">) {<br> &nbsp; &nbsp; &nbsp;handlePong(msgObj.pong);<br> &nbsp; &nbsp;}; </span><span class="c27 c26">// pong value is an object!!</span><span class="c11 c26"><br> &nbsp; &nbsp;</span><span class="c27 c26">// other handlers for control messages below</span><span class="c11 c26"><br> &nbsp;} </span><span class="c30 c26">catch</span><span class="c11 c26">&nbsp;{<br> &nbsp; &nbsp;messages.push({ </span><span class="c7 c26">&quot;time&quot;</span><span class="c11 c26">: </span><span class="c37 c26">Date</span><span class="c11 c26">(), </span><span class="c7 c26">&quot;topic&quot;</span><span class="c11 c26">: topic, </span><span class="c7 c26">&quot;message&quot;</span><span class="c11 c26">: message.toString() });<br> &nbsp; &nbsp;MongoClient.connect(url, </span><span class="c30 c26">function</span><span class="c11 c26">&nbsp;(err, db) {<br> &nbsp; &nbsp; &nbsp;</span><span class="c30 c26">if</span><span class="c11 c26">&nbsp;(err) </span><span class="c30 c26">throw</span><span class="c11 c26">&nbsp;err;<br> &nbsp; &nbsp; &nbsp;</span><span class="c30 c26">var</span><span class="c11 c26">&nbsp;dbo = db.db(</span><span class="c7 c26">&quot;</span><span class="c7 c26">chatapp</span><span class="c7 c26">&quot;</span><span class="c11 c26">);<br> &nbsp; &nbsp; &nbsp;</span><span class="c30 c26">var</span><span class="c11 c26">&nbsp;</span><span class="c11 c26">messageee</span><span class="c11 c26">&nbsp;= message.toString();<br> &nbsp; &nbsp; &nbsp;</span><span class="c30 c26">var</span><span class="c11 c26">&nbsp;</span><span class="c11 c26">msgvar</span><span class="c11 c26">&nbsp;= [{ </span><span class="c7 c26">&quot;msg&quot;</span><span class="c11 c26">: </span><span class="c11 c26">messageee</span><span class="c11 c26">&nbsp;}];<br> &nbsp; &nbsp; &nbsp;dbo.collection(</span><span class="c7 c26">&quot;messages&quot;</span><span class="c11 c26">).insertMany(</span><span class="c11 c26">msgvar</span><span class="c11 c26">, </span><span class="c30 c26">function</span><span class="c11 c26">&nbsp;(err, res, collection) {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c30 c26">if</span><span class="c11 c26">&nbsp;(err) </span><span class="c30 c26">throw</span><span class="c11 c26">&nbsp;err;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c37 c26">console</span><span class="c11 c26">.log(</span><span class="c7 c26">&quot;Number of documents inserted for &lt;messages&gt;: &quot;</span><span class="c11 c26">&nbsp;+ res.insertedCount);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c27 c26">//db.close();</span><span class="c11 c26"><br> &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp;</span><span class="c30 c26">const</span><span class="c11 c26">&nbsp;collection = dbo.collection(</span><span class="c7 c26">&#39;messages&#39;</span><span class="c11 c26">)<br> &nbsp; &nbsp; &nbsp;collection.find().toArray((err, items) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c27 c26">//console.log(items)</span><span class="c11 c26"><br> &nbsp; &nbsp; &nbsp;})<br> &nbsp; &nbsp;});<br> &nbsp;}<br> &nbsp;</span><span class="c37 c26">console</span><span class="c11 c26">.log(message.toString())<br>})</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&gt;&gt;</span></p><h5 class="c52 c42" id="h.l558d47zo1ua"><span class="c51 c68 c43">HandlePong</span></h5><p class="c23"><span>The </span><span>handlepong</span><span class="c0">&nbsp;will also be changed. It&rsquo;s almost like the message storage but instead storing all users. Pretty straight forward:</span></p><p class="c2"><span class="c0"></span></p><a id="t.829aff0aac99134f3a1895649aa7f80011e76736"></a><a id="t.32"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c9">&nbsp; MongoClient.connect(url, </span><span class="c25">function</span><span class="c9">&nbsp;(err, db) {<br> &nbsp; &nbsp;</span><span class="c25">if</span><span class="c9">&nbsp;(err) </span><span class="c25">throw</span><span class="c9">&nbsp;err;<br> &nbsp; &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;dbo = db.db(</span><span class="c6">&quot;</span><span class="c6">chatapp</span><span class="c6">&quot;</span><span class="c9">);<br> &nbsp; &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;</span><span class="c9">usrnm</span><span class="c9">&nbsp;= pongObj.userName.toString();<br> &nbsp; &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;</span><span class="c9">usrvar</span><span class="c9">&nbsp;= [{ </span><span class="c6">&quot;USR&quot;</span><span class="c9">: </span><span class="c9">usrnm</span><span class="c9">&nbsp;}];<br> &nbsp; &nbsp;dbo.collection(</span><span class="c6">&quot;users&quot;</span><span class="c9">).insertMany(</span><span class="c9">usrvar</span><span class="c9">, </span><span class="c25">function</span><span class="c9">&nbsp;(err, res, collection) {<br> &nbsp; &nbsp; &nbsp;</span><span class="c25">if</span><span class="c9">&nbsp;(err) </span><span class="c25">throw</span><span class="c9">&nbsp;err;<br> &nbsp; &nbsp; &nbsp;</span><span class="c8">console</span><span class="c9">.log(</span><span class="c6">&quot;Number of documents inserted for &lt;users&gt;: &quot;</span><span class="c9">&nbsp;+ res.insertedCount);<br> &nbsp; &nbsp; &nbsp;</span><span class="c27 c48">//db.close();</span><span class="c9"><br> &nbsp; &nbsp;});<br> &nbsp; &nbsp;</span><span class="c25">const</span><span class="c9">&nbsp;collection = dbo.collection(</span><span class="c6">&#39;users&#39;</span><span class="c9">)<br> &nbsp; &nbsp;collection.find().toArray((err, items) =&gt; {<br> &nbsp; &nbsp; &nbsp;</span><span class="c27 c48">//idk what to do here</span><span class="c9"><br> &nbsp; &nbsp;})<br> &nbsp;});</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">We are only changing the values and the collection name to &ldquo;users&rdquo;.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">So the goal I&rsquo;m trying to achieve by doing this is storing all user data and message logs in mongodb, and when a user goes to the endpoint, you can view the entire log of messages or top ten.</span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 529.50px; height: 297.84px;"><img alt="" src="images/image20.png" style="width: 529.50px; height: 297.84px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">The full user update code looks like this:</span></p><p class="c2"><span class="c0"></span></p><a id="t.238e23c9c2ef56ac9aed3b8de467d0dafab7fcf1"></a><a id="t.33"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c25">function</span><span class="c9">&nbsp;</span><span class="c8">handlePong</span><span class="c9">(pongObj) {<br> &nbsp;</span><span class="c27 c48">// Update Userlist with Pongs</span><span class="c9"><br> &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;MongoClient = </span><span class="c8">require</span><span class="c9">(</span><span class="c6">&#39;mongodb&#39;</span><span class="c9">).MongoClient;<br> &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;url = </span><span class="c6">&quot;mongodb://0.0.0.0:27017/&quot;</span><span class="c9">;<br> &nbsp;</span><span class="c25">const</span><span class="c9">&nbsp;index = userList.findIndex(object =&gt; {<br> &nbsp; &nbsp;</span><span class="c25">return</span><span class="c9">&nbsp;object.userName === pongObj.userName;<br> &nbsp;})<br><br> &nbsp;</span><span class="c27 c48">//console.log(&quot;index:&quot; + index);</span><span class="c9"><br> &nbsp;</span><span class="c25">if</span><span class="c9">&nbsp;(index &gt;= </span><span class="c35">0</span><span class="c9">) {<br> &nbsp; &nbsp;</span><span class="c8">console</span><span class="c9">.log(</span><span class="c6">&quot;User exists&quot;</span><span class="c9">);<br> &nbsp; &nbsp;userList[index] = pongObj;<br> &nbsp;} </span><span class="c25">else</span><span class="c9">&nbsp;{<br> &nbsp; &nbsp;</span><span class="c8">console</span><span class="c9">.log(</span><span class="c6">&quot;New User &quot;</span><span class="c9">&nbsp;+ pongObj.userName);<br> &nbsp; &nbsp;userList.push(pongObj);<br> &nbsp;}<br> &nbsp;MongoClient.connect(url, </span><span class="c25">function</span><span class="c9">&nbsp;(err, db) {<br> &nbsp; &nbsp;</span><span class="c25">if</span><span class="c9">&nbsp;(err) </span><span class="c25">throw</span><span class="c9">&nbsp;err;<br> &nbsp; &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;dbo = db.db(</span><span class="c6">&quot;</span><span class="c6">chatapp</span><span class="c6">&quot;</span><span class="c9">);<br> &nbsp; &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;</span><span class="c9">usrnm</span><span class="c9">&nbsp;= pongObj.userName.toString();<br> &nbsp; &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;</span><span class="c9">usrvar</span><span class="c9">&nbsp;= [{ </span><span class="c6">&quot;USR&quot;</span><span class="c9">: </span><span class="c9">usrnm</span><span class="c9">&nbsp;}];<br> &nbsp; &nbsp;dbo.collection(</span><span class="c6">&quot;users&quot;</span><span class="c9">).insertMany(</span><span class="c9">usrvar</span><span class="c9">, </span><span class="c25">function</span><span class="c9">&nbsp;(err, res, collection) {<br> &nbsp; &nbsp; &nbsp;</span><span class="c25">if</span><span class="c9">&nbsp;(err) </span><span class="c25">throw</span><span class="c9">&nbsp;err;<br> &nbsp; &nbsp; &nbsp;</span><span class="c8">console</span><span class="c9">.log(</span><span class="c6">&quot;Number of documents inserted for &lt;users&gt;: &quot;</span><span class="c9">&nbsp;+ res.insertedCount);<br> &nbsp; &nbsp; &nbsp;</span><span class="c27 c48">//db.close();</span><span class="c9"><br> &nbsp; &nbsp;});<br> &nbsp; &nbsp;</span><span class="c25">const</span><span class="c9">&nbsp;collection = dbo.collection(</span><span class="c6">&#39;users&#39;</span><span class="c9">)<br> &nbsp; &nbsp;collection.find().toArray((err, items) =&gt; {<br> &nbsp; &nbsp; &nbsp;</span><span class="c27 c48">//idk what to do here</span><span class="c9"><br> &nbsp; &nbsp;})<br> &nbsp;});<br>}</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&gt;&gt;</span></p><p class="c31"><span class="c0"></span></p><h3 class="c22" id="h.rxqllc7ba6ud"><span class="c51 c65 c43">Setup mongoose</span></h3><p class="c23"><span class="c0">Mongoose is an Object Data Modeling (ODM) library for MongoDB and Node.js. It manages relationships between data, provides schema validation, and is used to translate between objects in code and the representation of those objects in MongoDB.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">You can simply install mongoose by typing &ldquo;npm i mongoose&rdquo; into the NodeJS command prompt.</span></p><p class="c2"><span class="c51 c73 c45"></span></p><p class="c23"><span class="c0">I didn&rsquo;t use mongoose often, but when I&rsquo;ll use it later, I&rsquo;ll be mentioning it.</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">&gt;&gt;</span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><h2 class="c47 c42 c57" id="h.iap3q0ej7xa8"><span class="c32">Create data-bound widgets to display sensor data</span></h2><p class="c23"><span class="c0">So, now that we figured out a way to store and receive data in mongoDB and javascript.. But what if we want to use that data in html? Well that&rsquo;s what we&rsquo;ll be doing today.</span></p><p class="c2"><span class="c0"></span></p><h3 class="c22" id="h.j4dxyaywwikl"><span class="c51 c65 c43">Approach</span></h3><p class="c23"><span>I first was breaking my head about this, since this was according to my experience impossible.. Because it&#39;s the server side handler that gets and sends all the data.. And I could do that with importing in html too but the mongoDB library isn&rsquo;t only written in javascript.. So I was kind of stuck. But then I came across </span><span class="c43">ejs</span><span class="c43">. </span><span>W</span><span>ith</span><span class="c0">&nbsp;ejs I can code in html, but at the same time I can use javascript variables in the html code. So my server hosts the ejs file and then I can use the server variables in my html (ejs):</span></p><p class="c2"><span class="c0"></span></p><a id="t.71a17fe3664c1f3d379405d974749a898aabd30c"></a><a id="t.34"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c9">&nbsp; &nbsp; &nbsp; res.</span><span class="c25">render</span><span class="c9">(</span><span class="c6">&#39;index.ejs&#39;</span><span class="c9">, {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c25">log</span><span class="c9">: itm<br> &nbsp; &nbsp; &nbsp;});</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><a id="t.bd1c0e0d3ed02eb14b700adb772f0e70abdf7cdc"></a><a id="t.35"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c33 c48">&lt;</span><span class="c58 c48 c43">h4</span><span class="c33 c48">&nbsp;id=</span><span class="c6">&quot;hr&quot;</span><span class="c33 c48">&gt;&lt;</span><span class="c58 c48 c43">%=</span><span class="c9">&nbsp;</span><span class="c25">log</span><span class="c9">&nbsp;</span><span class="c33 c48">%&gt;&lt;/</span><span class="c48 c43 c58">h4</span><span class="c33 c48">&gt;</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">And to get the latest data from mongoDB, I did this:</span></p><p class="c2"><span class="c0"></span></p><a id="t.02f0535a37277916ef96a79742d0e3d4053c6060"></a><a id="t.36"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c9">&nbsp; MongoClient.connect(url, </span><span class="c25">function</span><span class="c9">&nbsp;(err, db) {<br> &nbsp; &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;dbo = db.db(</span><span class="c6">&quot;</span><span class="c6">chatapp</span><span class="c6">&quot;</span><span class="c9">);<br> &nbsp; &nbsp;</span><span class="c25">const</span><span class="c9">&nbsp;collection = dbo.collection(</span><span class="c6">&#39;messages&#39;</span><span class="c9">);<br> &nbsp; &nbsp;collection.find().sort({ </span><span class="c6">&#39;_id&#39;</span><span class="c9">: </span><span class="c35">-1</span><span class="c9">&nbsp;}).limit(</span><span class="c35">1</span><span class="c9">).toArray((err, items) =&gt; {<br> &nbsp; &nbsp; &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;_log = items;<br> &nbsp; &nbsp; &nbsp;_log.forEach(</span><span class="c25">function</span><span class="c9">&nbsp;(item) {<br> &nbsp; &nbsp; &nbsp; &nbsp;globalThis.itm = item.msg<br> &nbsp; &nbsp; &nbsp; &nbsp;globalThis.itm = itm.toString();<br> &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp;res.render(</span><span class="c6">&#39;index.ejs&#39;</span><span class="c9">, {<br> &nbsp; &nbsp; &nbsp; &nbsp;log: itm<br> &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp;});<br> &nbsp;});</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">So I&rsquo;m doing the basic stuff until I take the latest one and then I say that I only want the message from the JSON, else it will come in as JSON objects. And then finally, I &ldquo;globalize&rdquo; it and pass it to the render.</span></p><p class="c23"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 474.50px; height: 248.55px;"><img alt="" src="images/image2.png" style="width: 474.50px; height: 248.55px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c2"><span class="c0"></span></p><p class="c31"><span class="c0"></span></p><p class="c23"><span class="c26 c34">Example getting data from a tello drone, storing, retrieving and displaying it</span></p><p class="c2"><span class="c34 c26"></span></p><p class="c23"><span class="c0">So now that we know what the approach does, let&#39;s look at the code.</span></p><h3 class="c22" id="h.okypw1wrr45s"><span class="c51 c43 c65">Code</span></h3><h4 class="c41 c42" id="h.t4t88ulcpvtm"><span class="c3">Setup</span></h4><p class="c23"><span class="c0">Let&rsquo;s look at the first piece of NodeJS code, here we are including all libraries and initializing all the needed platforms:</span></p><p class="c2"><span class="c0"></span></p><a id="t.c312f394877116da7c120d247b22f8d5c068ec2d"></a><a id="t.37"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c8">const express</span><span class="c9">&nbsp;= require(</span><span class="c6">&quot;express&quot;</span><span class="c9">);<br></span><span class="c8">const path</span><span class="c9">&nbsp;= require(</span><span class="c6">&quot;path&quot;</span><span class="c9">);<br></span><span class="c8">const mongoose</span><span class="c9">&nbsp;= require(</span><span class="c6">&#39;mongoose&#39;</span><span class="c9">);<br></span><span class="c8">const ejs</span><span class="c9">&nbsp;= require(</span><span class="c6">&#39;ejs&#39;</span><span class="c9">);<br></span><span class="c8">const app</span><span class="c9">&nbsp;= express();<br></span><span class="c8">const MongoClient</span><span class="c9">&nbsp;= require(</span><span class="c6">&#39;mongodb&#39;</span><span class="c9">).MongoClient;<br></span><span class="c8">const url</span><span class="c9">&nbsp;= </span><span class="c6">&quot;mongodb://0.0.0.0:27017/&quot;</span><span class="c9">;<br></span><span class="c8">const PORT</span><span class="c9">&nbsp;= 3000;<br></span><span class="c8">const defIP</span><span class="c9">&nbsp;= </span><span class="c6">&quot;http://localhost:3000 or http://127.0.0.1:3000/&quot;</span><span class="c9">;</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">And then we set up the basic mqtt:</span></p><p class="c2"><span class="c0"></span></p><a id="t.8a42a3d9fc7058ac5a1b3bd28ee1781a02cce75d"></a><a id="t.38"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c27 c26">// MQTT client connection on NodeJS</span><span class="c11 c26"><br></span><span class="c30 c26">var</span><span class="c11 c26">&nbsp;userList = []; </span><span class="c27 c26">// manage the userlist</span><span class="c11 c26"><br></span><span class="c30 c26">var</span><span class="c11 c26">&nbsp;messages = []; </span><span class="c27 c26">// message log dit wordt straks die MongoDB</span><span class="c11 c26"><br><br></span><span class="c27 c26">//connect mqtt</span><span class="c11 c26"><br></span><span class="c30 c26">const</span><span class="c11 c26">&nbsp;mqtt = </span><span class="c37 c26">require</span><span class="c11 c26">(</span><span class="c7 c26">&#39;mqtt&#39;</span><span class="c11 c26">);<br></span><span class="c30 c26">const</span><span class="c11 c26">&nbsp;client = mqtt.connect(</span><span class="c7 c26">&quot;ws://broker.hivemq.com:8000/mqtt&quot;</span><span class="c11 c26">);<br></span><span class="c30 c26">var</span><span class="c11 c26">&nbsp;mqtt_tpc = </span><span class="c7 c26">&quot;codettes2022&quot;</span><span class="c11 c26">; </span><span class="c27 c26">// change the mqtt topic here</span></p></td></tr></table><h4 class="c41 c42" id="h.ky4fte2zt56x"><span class="c61 c43">Main </span><span class="c3">Endpoint</span></h4><p class="c23"><span class="c0">I will not explain the callbacks and functions again because they stay the same.</span></p><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">But here we have the first endpoint, the message endpoint. </span></p><p class="c2"><span class="c0"></span></p><a id="t.b3ba99983cfd319f88909639a4ea38b926ac3e36"></a><a id="t.39"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c9">app.set(</span><span class="c6">&#39;view engine&#39;</span><span class="c9">, </span><span class="c6">&#39;ejs&#39;</span><span class="c9">);<br>app.</span><span class="c25">use</span><span class="c9">(express.</span><span class="c25">static</span><span class="c9">(__dirname + </span><span class="c6">&#39;/public&#39;</span><span class="c9">));<br><br>app.get(</span><span class="c6">&#39;/&#39;</span><span class="c9">, (req, res) =&gt; {<br> &nbsp;MongoClient.connect(url, </span><span class="c25">function</span><span class="c9">&nbsp;(err, db) {<br> &nbsp; &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;dbo = db.db(</span><span class="c6">&quot;</span><span class="c6">chatapp</span><span class="c6">&quot;</span><span class="c9">);<br> &nbsp; &nbsp;</span><span class="c25">const</span><span class="c9">&nbsp;collection = dbo.collection(</span><span class="c6">&#39;messages&#39;</span><span class="c9">);<br> &nbsp; &nbsp;collection.find().sort({ </span><span class="c6">&#39;_id&#39;</span><span class="c9">: </span><span class="c35">-1</span><span class="c9">&nbsp;}).limit(</span><span class="c35">1</span><span class="c9">).toArray((err, items) =&gt; {<br> &nbsp; &nbsp; &nbsp;</span><span class="c25">var</span><span class="c9">&nbsp;_log = items;<br> &nbsp; &nbsp; &nbsp;_log.</span><span class="c25">forEach</span><span class="c9">(</span><span class="c25">function</span><span class="c9">&nbsp;(item) {<br> &nbsp; &nbsp; &nbsp; &nbsp;globalThis.itm = item.msg<br> &nbsp; &nbsp; &nbsp; &nbsp;globalThis.itm = itm.toString();<br> &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp;res.render(</span><span class="c6">&#39;index.ejs&#39;</span><span class="c9">, {<br> &nbsp; &nbsp; &nbsp; &nbsp;log: itm<br> &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp;});<br> &nbsp;});<br>});</span></p></td></tr></table><p class="c2"><span class="c0"></span></p><p class="c23"><span class="c0">So first we are setting up the EJS view engine. And then we set up the main endpoint. First we enter the mongoClient callback, then we declare our necessary variables, then we enter the collection, here we will find the latest message, set it to a variable and then extract the message object out of it. We set that item to a global variable and then we use it in the render to be later used in the EJS file:</span></p><p class="c2"><span class="c0"></span></p><a id="t.bd1c0e0d3ed02eb14b700adb772f0e70abdf7cdc"></a><a id="t.40"></a><table class="c14"><tr class="c15"><td class="c10" colspan="1" rowspan="1"><p class="c38"><span class="c33">&lt;</span><span class="c58 c43">h4</span><span class="c33">&nbsp;id=</span><span class="c7">&quot;hr&quot;</span><span class="c33">&gt;&lt;</span><span class="c58 c43">%=</span><span class="c11">&nbsp;</span><span class="c30">log</span><span class="c11">&nbsp;</span><span class="c33">%&gt;&lt;/</span><span class="c58 c43">h4</span><span class="c33">&gt;</span></p></td></tr></table><p class="c38 c46"><span class="c0"></span></p><p class="c56"><span class="c0">That was pretty simple.. Not too much.. But Mr Theo has another method he will explain too. This is just an approach. </span></p><p class="c29"><span class="c0"></span></p><p class="c29"><span class="c0"></span></p><p class="c29"><span class="c0"></span></p><p class="c29"><span class="c0"></span></p><p class="c56"><span class="c0">&lt;&gt;</span></p><p class="c38 c46"><span class="c0"></span></p><p class="c29"><span class="c0"></span></p></body></html>
