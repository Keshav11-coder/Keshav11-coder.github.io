<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=fND5XPYKrF2tQDwwfWZJI3Br7nJQwv2dbxP3J1RFOgHvzWUO0rQXKh_711aqDzF9');ul.lst-kix_mrbf3etw55go-0{list-style-type:none}ul.lst-kix_mrbf3etw55go-1{list-style-type:none}ul.lst-kix_mrbf3etw55go-2{list-style-type:none}ul.lst-kix_mrbf3etw55go-7{list-style-type:none}ul.lst-kix_xt5lbbahzf58-7{list-style-type:none}ul.lst-kix_mrbf3etw55go-8{list-style-type:none}ul.lst-kix_xt5lbbahzf58-6{list-style-type:none}.lst-kix_9loaant0yasb-8>li:before{content:"-  "}ul.lst-kix_xt5lbbahzf58-5{list-style-type:none}ul.lst-kix_xt5lbbahzf58-4{list-style-type:none}ul.lst-kix_mrbf3etw55go-3{list-style-type:none}ul.lst-kix_xt5lbbahzf58-3{list-style-type:none}ul.lst-kix_mrbf3etw55go-4{list-style-type:none}ul.lst-kix_xt5lbbahzf58-2{list-style-type:none}.lst-kix_9loaant0yasb-7>li:before{content:"-  "}ul.lst-kix_mrbf3etw55go-5{list-style-type:none}ul.lst-kix_xt5lbbahzf58-1{list-style-type:none}ul.lst-kix_mrbf3etw55go-6{list-style-type:none}ul.lst-kix_xt5lbbahzf58-0{list-style-type:none}ol.lst-kix_pebqbp50lxbn-0.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-0 0}.lst-kix_9loaant0yasb-4>li:before{content:"-  "}.lst-kix_9loaant0yasb-5>li:before{content:"-  "}.lst-kix_9loaant0yasb-2>li:before{content:"-  "}.lst-kix_9loaant0yasb-6>li:before{content:"-  "}ul.lst-kix_xt5lbbahzf58-8{list-style-type:none}.lst-kix_9loaant0yasb-3>li:before{content:"-  "}.lst-kix_pebqbp50lxbn-8>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-8}.lst-kix_lr2po1pqbijq-5>li:before{content:"-  "}.lst-kix_lr2po1pqbijq-7>li:before{content:"-  "}.lst-kix_lr2po1pqbijq-2>li:before{content:"-  "}.lst-kix_lr2po1pqbijq-6>li:before{content:"-  "}.lst-kix_lr2po1pqbijq-3>li:before{content:"-  "}.lst-kix_lr2po1pqbijq-4>li:before{content:"-  "}ol.lst-kix_pebqbp50lxbn-8.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-8 0}.lst-kix_nhgktuvbl2kx-3>li:before{content:"-  "}.lst-kix_nhgktuvbl2kx-4>li:before{content:"-  "}.lst-kix_djasomgyryj4-0>li:before{content:"-  "}.lst-kix_pebqbp50lxbn-0>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-0}.lst-kix_nhgktuvbl2kx-5>li:before{content:"-  "}.lst-kix_djasomgyryj4-1>li:before{content:"-  "}.lst-kix_nhgktuvbl2kx-7>li:before{content:"-  "}.lst-kix_nhgktuvbl2kx-8>li:before{content:"-  "}.lst-kix_nhgktuvbl2kx-6>li:before{content:"-  "}.lst-kix_lr2po1pqbijq-8>li:before{content:"-  "}.lst-kix_xt5lbbahzf58-6>li:before{content:"-  "}ul.lst-kix_9loaant0yasb-8{list-style-type:none}.lst-kix_xt5lbbahzf58-7>li:before{content:"-  "}ul.lst-kix_9loaant0yasb-5{list-style-type:none}.lst-kix_wk0pa07ne8j0-0>li:before{content:"-  "}ul.lst-kix_9loaant0yasb-4{list-style-type:none}ul.lst-kix_9loaant0yasb-7{list-style-type:none}.lst-kix_xt5lbbahzf58-8>li:before{content:"-  "}ul.lst-kix_9loaant0yasb-6{list-style-type:none}ul.lst-kix_9loaant0yasb-1{list-style-type:none}.lst-kix_wk0pa07ne8j0-2>li:before{content:"-  "}.lst-kix_wk0pa07ne8j0-3>li:before{content:"-  "}ul.lst-kix_9loaant0yasb-0{list-style-type:none}ul.lst-kix_9loaant0yasb-3{list-style-type:none}.lst-kix_pebqbp50lxbn-6>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-6}ul.lst-kix_9loaant0yasb-2{list-style-type:none}.lst-kix_mrbf3etw55go-7>li:before{content:"-  "}.lst-kix_mrbf3etw55go-8>li:before{content:"-  "}.lst-kix_wk0pa07ne8j0-1>li:before{content:"-  "}.lst-kix_mrbf3etw55go-5>li:before{content:"-  "}.lst-kix_mrbf3etw55go-6>li:before{content:"-  "}.lst-kix_wk0pa07ne8j0-6>li:before{content:"-  "}.lst-kix_wk0pa07ne8j0-7>li:before{content:"-  "}.lst-kix_wk0pa07ne8j0-4>li:before{content:"-  "}.lst-kix_wk0pa07ne8j0-8>li:before{content:"-  "}ol.lst-kix_pebqbp50lxbn-5.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-5 0}.lst-kix_mrbf3etw55go-2>li:before{content:"-  "}.lst-kix_mrbf3etw55go-3>li:before{content:"-  "}.lst-kix_mrbf3etw55go-4>li:before{content:"-  "}.lst-kix_wk0pa07ne8j0-5>li:before{content:"-  "}.lst-kix_pebqbp50lxbn-5>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-5}ul.lst-kix_wk0pa07ne8j0-0{list-style-type:none}ul.lst-kix_wk0pa07ne8j0-1{list-style-type:none}.lst-kix_pebqbp50lxbn-2>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-2}ul.lst-kix_wk0pa07ne8j0-2{list-style-type:none}ul.lst-kix_wk0pa07ne8j0-3{list-style-type:none}ul.lst-kix_wk0pa07ne8j0-4{list-style-type:none}ul.lst-kix_wk0pa07ne8j0-5{list-style-type:none}ul.lst-kix_wk0pa07ne8j0-6{list-style-type:none}.lst-kix_mrbf3etw55go-1>li:before{content:"-  "}ul.lst-kix_wk0pa07ne8j0-7{list-style-type:none}ul.lst-kix_wk0pa07ne8j0-8{list-style-type:none}.lst-kix_mrbf3etw55go-0>li:before{content:"-  "}ol.lst-kix_pebqbp50lxbn-6.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-6 0}ul.lst-kix_pebqbp50lxbn-1{list-style-type:none}ul.lst-kix_djasomgyryj4-0{list-style-type:none}ul.lst-kix_djasomgyryj4-1{list-style-type:none}ul.lst-kix_djasomgyryj4-2{list-style-type:none}ul.lst-kix_djasomgyryj4-3{list-style-type:none}ul.lst-kix_djasomgyryj4-4{list-style-type:none}ul.lst-kix_djasomgyryj4-5{list-style-type:none}ul.lst-kix_djasomgyryj4-6{list-style-type:none}ul.lst-kix_djasomgyryj4-7{list-style-type:none}ol.lst-kix_pebqbp50lxbn-4.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-4 0}.lst-kix_pebqbp50lxbn-4>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-4}ol.lst-kix_pebqbp50lxbn-7.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-7 0}ol.lst-kix_pebqbp50lxbn-2{list-style-type:none}ol.lst-kix_pebqbp50lxbn-3{list-style-type:none}ol.lst-kix_pebqbp50lxbn-4{list-style-type:none}ol.lst-kix_pebqbp50lxbn-5{list-style-type:none}ol.lst-kix_pebqbp50lxbn-6{list-style-type:none}ol.lst-kix_pebqbp50lxbn-7{list-style-type:none}ol.lst-kix_pebqbp50lxbn-8{list-style-type:none}ol.lst-kix_pebqbp50lxbn-0{list-style-type:none}.lst-kix_pebqbp50lxbn-8>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-8,lower-roman) ". "}.lst-kix_pebqbp50lxbn-6>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-6,decimal) ". "}.lst-kix_pebqbp50lxbn-7>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-7,lower-latin) ". "}.lst-kix_pebqbp50lxbn-3>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-3}.lst-kix_pebqbp50lxbn-3>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-3,decimal) ". "}.lst-kix_pebqbp50lxbn-4>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-4,lower-latin) ". "}.lst-kix_pebqbp50lxbn-5>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-5,lower-roman) ". "}.lst-kix_djasomgyryj4-7>li:before{content:"-  "}.lst-kix_djasomgyryj4-6>li:before{content:"-  "}.lst-kix_djasomgyryj4-8>li:before{content:"-  "}.lst-kix_xt5lbbahzf58-5>li:before{content:"-  "}.lst-kix_djasomgyryj4-5>li:before{content:"-  "}ol.lst-kix_pebqbp50lxbn-2.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-2 0}.lst-kix_xt5lbbahzf58-4>li:before{content:"-  "}.lst-kix_pebqbp50lxbn-2>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-2,lower-roman) ". "}.lst-kix_djasomgyryj4-4>li:before{content:"-  "}.lst-kix_djasomgyryj4-2>li:before{content:"-  "}.lst-kix_xt5lbbahzf58-1>li:before{content:"-  "}.lst-kix_xt5lbbahzf58-3>li:before{content:"-  "}ul.lst-kix_nhgktuvbl2kx-0{list-style-type:none}.lst-kix_nhgktuvbl2kx-2>li:before{content:"-  "}.lst-kix_pebqbp50lxbn-0>li:before{content:"" counter(lst-ctn-kix_pebqbp50lxbn-0,decimal) ". "}.lst-kix_pebqbp50lxbn-1>li:before{content:"\0025cb  "}ul.lst-kix_nhgktuvbl2kx-2{list-style-type:none}ul.lst-kix_nhgktuvbl2kx-1{list-style-type:none}.lst-kix_djasomgyryj4-3>li:before{content:"-  "}.lst-kix_xt5lbbahzf58-2>li:before{content:"-  "}.lst-kix_nhgktuvbl2kx-1>li:before{content:"-  "}.lst-kix_xt5lbbahzf58-0>li:before{content:"-  "}.lst-kix_nhgktuvbl2kx-0>li:before{content:"-  "}.lst-kix_lr2po1pqbijq-1>li:before{content:"-  "}.lst-kix_lr2po1pqbijq-0>li:before{content:"-  "}ul.lst-kix_lr2po1pqbijq-0{list-style-type:none}ul.lst-kix_lr2po1pqbijq-1{list-style-type:none}ul.lst-kix_lr2po1pqbijq-2{list-style-type:none}ul.lst-kix_lr2po1pqbijq-3{list-style-type:none}ol.lst-kix_pebqbp50lxbn-3.start{counter-reset:lst-ctn-kix_pebqbp50lxbn-3 0}ul.lst-kix_lr2po1pqbijq-8{list-style-type:none}.lst-kix_9loaant0yasb-0>li:before{content:"-  "}.lst-kix_9loaant0yasb-1>li:before{content:"-  "}ul.lst-kix_lr2po1pqbijq-4{list-style-type:none}ul.lst-kix_lr2po1pqbijq-5{list-style-type:none}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}ul.lst-kix_lr2po1pqbijq-6{list-style-type:none}ul.lst-kix_lr2po1pqbijq-7{list-style-type:none}ul.lst-kix_nhgktuvbl2kx-4{list-style-type:none}ul.lst-kix_nhgktuvbl2kx-3{list-style-type:none}ul.lst-kix_nhgktuvbl2kx-6{list-style-type:none}ul.lst-kix_nhgktuvbl2kx-5{list-style-type:none}ul.lst-kix_nhgktuvbl2kx-8{list-style-type:none}.lst-kix_pebqbp50lxbn-7>li{counter-increment:lst-ctn-kix_pebqbp50lxbn-7}ul.lst-kix_nhgktuvbl2kx-7{list-style-type:none}ul.lst-kix_djasomgyryj4-8{list-style-type:none}ol{margin:0;padding:0}table td,table th{padding:0}.c8{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:0pt;border-right-width:0pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:0pt;border-top-style:solid;background-color:#333333;border-left-style:solid;border-bottom-width:0pt;width:468pt;border-top-color:#000000;border-bottom-style:solid}.c0{margin-left:36pt;padding-top:0pt;padding-left:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c51{padding-top:12pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:center}.c50{background-color:#2b2b2b;color:#e8bf6a;font-weight:400;text-decoration:none;vertical-align:baseline;font-family:"Courier New";font-style:normal}.c41{padding-top:14pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:center}.c38{padding-top:18pt;padding-bottom:6pt;line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:center}.c22{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:10pt;font-family:"Arial";font-style:normal}.c3{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c10{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center;height:11pt}.c56{padding-top:38pt;padding-bottom:26pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c13{color:#000000;text-decoration:none;vertical-align:baseline;font-size:12pt;font-family:"Arial";font-style:normal}.c12{padding-top:0pt;padding-bottom:0pt;line-height:1.15;orphans:2;widows:2;text-align:center}.c14{background-color:#333333;font-size:7pt;font-family:"Consolas";color:#a2fca2;font-weight:400}.c29{background-color:#333333;font-size:9pt;font-family:"Consolas";color:#888888;font-weight:400}.c39{text-decoration:none;vertical-align:baseline;font-size:14pt;font-family:"Arial";font-style:normal}.c31{background-color:#333333;font-size:10pt;font-family:"Consolas";color:#888888;font-weight:400}.c4{background-color:#333333;font-size:10pt;font-family:"Consolas";color:#ffffaa;font-weight:400}.c16{background-color:#333333;font-size:10pt;font-family:"Consolas";color:#a2fca2;font-weight:400}.c44{text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.c21{background-color:#333333;font-size:10pt;font-family:"Consolas";color:#ffffff;font-weight:400}.c15{background-color:#333333;font-size:7pt;font-family:"Consolas";color:#62c8f3;font-weight:400}.c65{padding-top:14pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;text-align:center}.c27{background-color:#333333;font-size:10pt;font-family:"Consolas";color:#d36363;font-weight:400}.c9{background-color:#333333;font-size:10pt;font-family:"Consolas";color:#fcc28c;font-weight:400}.c1{background-color:#333333;font-size:10.5pt;font-family:"Consolas";color:#ffffff;font-weight:400}.c66{padding-top:16pt;padding-bottom:4pt;line-height:1.15;page-break-after:avoid;text-align:center}.c17{background-color:#333333;font-size:9pt;font-family:"Consolas";color:#a2fca2;font-weight:400}.c26{background-color:#333333;font-size:7pt;font-family:"Consolas";color:#ffffff;font-weight:400}.c49{text-decoration:none;vertical-align:baseline;font-size:13pt;font-family:"Arial";font-style:normal}.c73{padding-top:20pt;padding-bottom:20pt;line-height:1.15;page-break-after:avoid;text-align:center}.c2{background-color:#333333;font-size:10pt;font-family:"Consolas";color:#62c8f3;font-weight:400}.c52{color:#333333;text-decoration:none;vertical-align:baseline;font-family:"Arial";font-style:normal}.c24{background-color:#333333;font-family:"Consolas";color:#fcc28c;font-weight:400}.c37{margin-left:36pt;padding-left:0pt;orphans:2;widows:2}.c6{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:left}.c18{background-color:#333333;font-family:"Consolas";color:#a2fca2;font-weight:400}.c42{background-color:#333333;font-size:7pt;font-family:"Consolas";color:#62c8f3}.c33{background-color:#333333;font-family:"Consolas";color:#888888;font-weight:400}.c40{background-color:#333333;font-family:"Consolas";color:#ffffaa;font-weight:400}.c28{background-color:#333333;font-family:"Consolas";color:#ffffff;font-weight:400}.c61{padding-top:0pt;padding-bottom:0pt;line-height:1.15;text-align:center}.c20{border-spacing:0;border-collapse:collapse;margin-right:auto}.c36{background-color:#333333;font-family:"Consolas";color:#d36363;font-weight:400}.c48{orphans:2;widows:2;height:11pt}.c47{background-color:#333333;font-family:"Consolas";color:#62c8f3}.c54{text-decoration:none;vertical-align:baseline;font-style:normal}.c71{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.c57{color:#d4d4d4;font-weight:400;font-family:"Consolas"}.c74{text-decoration:none;vertical-align:baseline;font-family:"Comic Sans MS"}.c67{text-decoration:none;vertical-align:baseline;font-size:11pt}.c63{background-color:#333333;font-family:"Consolas";color:#c6b4f0}.c64{background-color:#2b2b2b;color:#a9b7c6;font-family:"Courier New"}.c60{color:#f8f8f2;font-weight:400;font-family:"Consolas"}.c30{color:inherit;text-decoration:inherit}.c5{font-size:10pt;font-weight:700}.c59{orphans:2;widows:2}.c68{color:#666666;font-size:12pt}.c77{color:#88846f;font-family:"Consolas"}.c53{padding:0;margin:0}.c25{color:#000000}.c70{color:#333333}.c43{color:#6aa84f}.c19{font-size:10.5pt}.c11{font-weight:700}.c62{font-weight:400}.c34{font-style:italic}.c69{font-size:16pt}.c76{font-size:20pt}.c75{font-family:"Comfortaa"}.c72{height:40.5pt}.c35{font-size:10pt}.c23{font-size:8pt}.c58{height:11pt}.c55{font-family:"Arial"}.c32{font-size:9pt}.c7{height:0pt}.c46{font-size:7pt}.c45{margin-left:36pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.15;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c71 doc-content"><h1 class="c59 c73" id="h.7dhf43c1414o"><span class="c54 c25 c62 c55 c76">Interface &amp; Application Programming</span></h1><h2 class="c56" id="h.xbj12sz5m84r"><span class="c44 c25 c11">Objectives</span></h2><p class="c6 c59 c45"><span class="c54 c5 c25 c55">Wk 1</span></p><ul class="c53 lst-kix_mrbf3etw55go-0 start"><li class="c37 c6 li-bullet-0"><span class="c54 c5 c25 c55">[x] Setup Dev Environment for ESP32 S2</span></li><li class="c37 c6 li-bullet-0"><span class="c54 c5 c25 c55">[x] Setup NodeJS Dev Environment on your PC</span></li><li class="c37 c6 li-bullet-0"><span class="c54 c5 c25 c55">[x] Add Screenshots and description of the process of creation. </span></li><li class="c37 c6 li-bullet-0"><span class="c54 c5 c25 c55">[x] Describe the design &amp; programming steps</span></li><li class="c37 c6 li-bullet-0"><span class="c54 c5 c25 c55">[x] Screenshots or video of your Prototype/app working</span></li><li class="c37 c6 li-bullet-0"><span class="c54 c5 c25 c55">[x] Describe any errors or problems with the process and how you fixed them. </span></li><li class="c37 c6 li-bullet-0"><span class="c5">[x] Include all the files you created for download.</span><span class="c11">&nbsp;</span></li></ul><p class="c6 c59 c45"><span class="c54 c5 c25 c55">Wk 2</span></p><ul class="c53 lst-kix_djasomgyryj4-0 start"><li class="c37 c6 li-bullet-0"><span class="c5">[x] Build HTML5 Chat app<br></span><span class="c35">* Draw mockup / layout</span><span class="c5"><br>* </span><span class="c35">frame and add </span><span class="c35">id&rsquo;s</span><span class="c35">&nbsp;to &lt;div&gt;&rsquo;s</span><span class="c11"><br>* </span><span class="c22">Style the page and <br>* wire up the JS code and understand</span></li></ul><p class="c6 c59 c45"><span class="c54 c5 c25 c55">Wk 3</span></p><ul class="c53 lst-kix_djasomgyryj4-0"><li class="c37 c6 li-bullet-0"><span class="c5">[x] Build Chat app back-end NodeJS<br></span><span class="c22">* Build NodeJS server side to: <br>* host your ChatApp (Express static HTML)<br>* Build / test API endpoints (for: users &amp; messages)</span></li></ul><p class="c6 c45 c59"><span class="c54 c5 c25 c55">Wk 4</span></p><ul class="c53 lst-kix_djasomgyryj4-0"><li class="c37 c6 li-bullet-0"><span class="c5">[x] Setup MongoDB datastore &amp; connect via NodeJS</span><span class="c35"><br>* Setup MongoDB datastore + mongoose ODM (Object-Document-Manager)<br>* Store and recall message data using an API (ex. request top 100 msg)<br>* Wire up MongoDB to API endpoints</span><span class="c11"><br>* </span><span class="c22">Update app-flow to use back-end for Users and &ldquo;old&rdquo; messages</span></li></ul><p class="c6 c59 c45"><span class="c54 c5 c25 c55">Wk 5</span></p><ul class="c53 lst-kix_djasomgyryj4-0"><li class="c6 c37 li-bullet-0"><span class="c5">[x] Create data-bound widgets to display sensor data<br></span><span class="c35">&nbsp;* On ESP32 add MQTT client + ArduinoJSON<br> * Send Sensor data to MQTT server (as a JSON object)<br> * Create a DataCard, a Gauge and a time Chart widget on Dashboard (use chat app)<br> * Strategy on DataBinding and Widget updating (Last updated)<br> * User Login/Pw (state persistence)</span></li></ul><ul class="c53 lst-kix_xt5lbbahzf58-0 start"><li class="c37 c6 li-bullet-0"><span class="c54 c5 c25 c55">[] Explain the HackOmation quadrant in relation to your final project.</span></li><li class="c37 c6 li-bullet-0"><span class="c5">[] Build UI mockups for your FInal Project and HTML Layout</span></li></ul><h2 class="c38" id="h.m3vg3k82ngju"><span class="c54 c25 c62 c69 c55">Setup Development Environment for ESP32S2</span></h2><h4 class="c41" id="h.u9bpq9ak0g62"><span class="c25 c11">Installing ESP32</span></h4><p class="c12"><span class="c3">The first thing I did when setting up, was actually installing the esp32s2 board in the Arduino IDE.</span></p><p class="c12"><span class="c3">I&rsquo;m documenting this way later, so I already have it installed:</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 488.50px; height: 278.70px;"><img alt="" src="images/image4.png" style="width: 488.50px; height: 278.70px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c6 c48"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">You can see I have to update. But I don&#39;t always do that. Since later versions limit some important stuff.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Then I just select the board I&rsquo;m using and we&rsquo;re good for setting up esp boards.</span><span style="overflow: hidden; display: inline-block; margin: -0.00px -0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 495.50px; height: 326.38px;"><img alt="" src="images/image10.png" style="width: 495.50px; height: 326.38px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><h4 class="c41" id="h.f27w2152a33d"><span class="c13 c11">Setting up SPIFFS (Serial Peripheral Interface Flash File System)</span></h4><p class="c12"><span class="c3">You can host your web server with an esp32s2. But to upload the webpage content to display on your webpage, you need to upload data to the esp32 from a data folder using SPIFFS.</span></p><p class="c10"><span class="c3"></span></p><h5 class="c51" id="h.yoxhuc5elhyh"><span class="c44 c25 c11">Spiffs installation</span></h5><p class="c12"><span class="c3">If I go into my arduino folder, where all my projects are, I created a new folder called &ldquo;tools&rdquo;. In that folder I created another folder called &ldquo;ESP32FS&rdquo;. In the ESP32FS folder I created another folder called &ldquo;tool&rdquo;, and put the &ldquo;esp32s2.jar&rdquo; in that folder. The total structure should look like this:</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 512.50px; height: 86.24px;"><img alt="" src="images/image7.png" style="width: 512.50px; height: 86.24px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">I stored the whole structure on github in a zip, so when something goes wrong, I don&#39;t have to go searching for the original one.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c43"><a class="c30" href="https://www.google.com/url?q=https://github.com/Keshav11-coder/CB2022_Keshav&amp;sa=D&amp;source=editors&amp;ust=1659045919779536&amp;usg=AOvVaw0Upnef-nDS2uLfuBZa8Xj0">https://github.com/Keshav11-coder/CB2022_Keshav</a></span></p><p class="c10"><span class="c44 c43 c62"></span></p><h5 class="c51" id="h.afnf9x594yv8"><span class="c25 c11 c44">Checking if it works</span></h5><p class="c12"><span class="c3">When that has already been done, I restarted my arduino IDE and searched for an option called &ldquo;esp32 sketch data upload&rdquo;</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: -0.00px -0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 360.60px; height: 349.50px;"><img alt="" src="images/image23.png" style="width: 360.60px; height: 349.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><h2 class="c38" id="h.hfmg6ni8dhuv"><span class="c54 c25 c62 c69 c55">Setup NodeJS Dev Environment on your PC</span></h2><p class="c6 c48"><span class="c3"></span></p><p class="c12"><span class="c44 c25 c11">Lil&rsquo; story</span></p><p class="c12"><span class="c3">I already had nodeJS installed from 2021, when we were flying an AR drone with it. That was fun! I can tell you all about it! But there were a few things I had to install with it .. like NVM.</span></p><p class="c10"><span class="c3"></span></p><h4 class="c41" id="h.brl4xhke8si9"><span class="c13 c11">Upgrading my NodeJS</span></h4><p class="c12"><span class="c3">As I already said, I already had nodeJS for some time and it was a pretty old version. So I downloaded the latest version 18: </span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 469.07px; height: 263.50px;"><img alt="" src="images/image6.png" style="width: 469.07px; height: 263.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><p class="c12"><span class="c3">Installed it, and it was good to go.</span></p><p class="c10"><span class="c3"></span></p><p class="c6 c59"><span style="overflow: hidden; display: inline-block; margin: 0.00px -0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 288.50px; height: 224.03px;"><img alt="" src="images/image17.png" style="width: 288.50px; height: 224.03px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><h4 class="c41" id="h.jjrs80opz2q3"><span class="c13 c11">Installing NVM (Node Version Manager)</span></h4><p class="c6 c48"><span class="c3"></span></p><p class="c12"><span class="c3">I didn&rsquo;t have much experience with installing this so I followed some instructions here:</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c43"><a class="c30" href="https://www.google.com/url?q=https://dev.to/skaytech/how-to-install-node-version-manager-nvm-for-windows-10-4nbi&amp;sa=D&amp;source=editors&amp;ust=1659045919783080&amp;usg=AOvVaw2yFLk6CtfCFY0KNu7byVCf">https://dev.to/skaytech/how-to-install-node-version-manager-nvm-for-windows-10-4nbi</a></span></p><p class="c10"><span class="c44 c43 c62"></span></p><p class="c12"><span class="c3">Basically .. </span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">I downloaded the nvm-setup zip from github: </span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c43"><a class="c30" href="https://www.google.com/url?q=https://github.com/coreybutler/nvm-windows/releases&amp;sa=D&amp;source=editors&amp;ust=1659045919783574&amp;usg=AOvVaw2dXIVpSOulb8tS0I9vhdu1">Releases &middot; coreybutler/nvm-windows &middot; GitHub</a></span></p><p class="c10"><span class="c44 c43 c62"></span></p><p class="c12"><span class="c3">&hellip; unzipped it, took the nvm-setup folder somewhere safe and double-clicked the nvm-setop.exe file inside of it.</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 93.33px;"><img alt="" src="images/image5.png" style="width: 624.00px; height: 93.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: -0.00px -0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 446.86px; height: 363.50px;"><img alt="" src="images/image12.png" style="width: 446.86px; height: 363.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><h5 class="c51" id="h.ao22hvmnvq7s"><span class="c44 c25 c11">Checking if it works</span></h5><p class="c12"><span class="c3">Now that all of that is finished, I opened the NodeJS command prompt.</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 319.00px; height: 321.00px;"><img alt="" src="images/image16.png" style="width: 624.00px; height: 351.00px; margin-left: -19.00px; margin-top: -15.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><p class="c12"><span class="c3">And typed in: &ldquo;Node&rdquo;, &ldquo;nvm&rdquo;, &ldquo;npm&rdquo;; to check if everything works. If it doesn&rsquo;t give an error, it&rsquo;s good. If it does, I did something wrong.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 357.33px;"><img alt="" src="images/image9.png" style="width: 624.00px; height: 357.33px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><h2 class="c38" id="h.xngok832s36t"><span class="c11">Chatapp</span></h2><p class="c12"><span class="c3">Next we had to build a chat app with MQTT and html, css and javascript.</span></p><p class="c12"><span class="c3">Lucky me, because I knew those languages very well.</span></p><p class="c10"><span class="c3"></span></p><h4 class="c41" id="h.7z8ddmfrrq2f"><span class="c13 c11">MQTT debugging setup</span></h4><p class="c12"><span class="c3">In the session, Mr Theo showed us how to use mqtt. Here&rsquo;s how we did it.</span></p><p class="c10"><span class="c3"></span></p><h5 class="c51" id="h.hw7gm9jcd37k"><span class="c44 c11 c70">MQTTLens</span></h5><p class="c12"><span class="c3">Mqttlens is a chrome extension, or wep app, that you can add to chrome. I added it already:</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: -0.00px -0.00px; border: 2.67px solid #333333; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 498.50px; height: 280.41px;"><img alt="" src="images/image11.png" style="width: 498.50px; height: 280.41px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Now that we added it, let&#39;s launch the app:</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: -0.00px -0.00px; border: 2.67px solid #333333; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 505.00px; height: 284.06px;"><img alt="" src="images/image14.png" style="width: 505.00px; height: 284.06px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><h5 class="c51" id="h.baoq07b09kko"><span class="c44 c25 c11">Setup connection to HIVEMQ</span></h5><p class="c12"><span class="c3">As you can see, I already have a connection named &ldquo;bootcamp2022&rdquo;, here are the settings.</span><span style="overflow: hidden; display: inline-block; margin: -0.00px -0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 470.50px; height: 410.93px;"><img alt="" src="images/image1.png" style="width: 470.50px; height: 410.93px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><p class="c12"><span class="c67 c25 c62 c34 c55">As you also can see in the heading title, I said HIVEMQ instead of MQTT, because while coding we had some problems with MQTT, so we switched to HIVEMQ. HIVEMQ is built on top of MQTT, so basically MQTT but better.</span></p><p class="c10"><span class="c67 c25 c62 c34 c55"></span></p><p class="c12"><span class="c3">Next we set the topic, which is currently set to &ldquo;codettes2022&rdquo;, to .. well .. &ldquo;codettes2022&rdquo; at both places. Then we type a message. And then click on &ldquo;subscribe&rdquo; and then publish to publish the message:</span><span style="overflow: hidden; display: inline-block; margin: 0.00px -0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 381.00px; height: 214.05px;"><img alt="" src="images/image3.png" style="width: 381.00px; height: 214.05px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&nbsp;</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><p class="c12"><span class="c3">Now you see the message popup down there.</span></p><h4 class="c41" id="h.mq8nbi9usk35"><span class="c13 c11">Creating a sketch of my chat app</span></h4><p class="c12"><span class="c3">After explaining how MQTT works, we had to make a sketch. My sketch looks like this:</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: -13.26px 13.26px; border: 0.00px solid #000000; transform: rotate(4.71rad) translateZ(0px); -webkit-transform: rotate(4.71rad) translateZ(0px); width: 385.47px; height: 411.98px;"><img alt="" src="images/image21.png" style="width: 385.47px; height: 411.98px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Now we had to make that into html tags. (transforming it into a web page/chat app)</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">I first started looking through some html tags that might be useful. Such as</span></p><p class="c12"><span class="c3">&nbsp;</span></p><ul class="c53 lst-kix_lr2po1pqbijq-0 start"><li class="c0 li-bullet-0"><span class="c3">&lt;aside&gt;</span></li><li class="c0 li-bullet-0"><span class="c3">&lt;div&gt;</span></li><li class="c0 li-bullet-0"><span class="c3">&lt;input&gt;</span></li><li class="c0 li-bullet-0"><span class="c3">&lt;button&gt;</span></li><li class="c0 li-bullet-0"><span class="c3">&lt;h4&gt;</span></li></ul><p class="c10 c45"><span class="c3"></span></p><p class="c12 c45"><span class="c3">Etc .. </span></p><p class="c10 c45"><span class="c3"></span></p><p class="c10 c45"><span class="c3"></span></p><p class="c10 c45"><span class="c3"></span></p><p class="c10 c45"><span class="c3"></span></p><p class="c10 c45"><span class="c3"></span></p><p class="c10 c45"><span class="c3"></span></p><h5 class="c51" id="h.mhrywkjcd5b3"><span class="c44 c25 c11">Coding</span></h5><p class="c12"><span class="c3">The first thing I started doing is making a basic userlist with the &lt;aside&gt; element:</span><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 122.37px; height: 242.50px;"><img alt="" src="images/image18.png" style="width: 122.37px; height: 242.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10 c45"><span class="c3"></span></p><p class="c10 c45"><span class="c3"></span></p><p class="c10 c45"><span class="c3"></span></p><p class="c10 c45"><span class="c3"></span></p><p class="c10 c45"><span class="c3"></span></p><p class="c10 c45"><span class="c3"></span></p><p class="c10 c45"><span class="c3"></span></p><p class="c10 c45"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">It doesn&rsquo;t update itself yet, but that will be fixed later. The basic code structure for this is:</span></p><p class="c10"><span class="c3"></span></p><a id="t.8c3db0ccc5ec65c65460eefe0e01b7118abd80d2"></a><a id="t.0"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c2">&lt;</span><span class="c47 c5">aside</span><span class="c2">&gt;</span><span class="c21"><br></span><span class="c2">&lt;</span><span class="c47 c5">div</span><span class="c2">&nbsp;class=</span><span class="c16">&quot;chat-bg&quot;</span><span class="c2">&gt;</span><span class="c21"><br> &nbsp; </span><span class="c2">&lt;</span><span class="c47 c5">div</span><span class="c2">&nbsp;class=</span><span class="c16">&quot;status&quot;</span><span class="c2">&gt;</span><span class="c21"><br> &nbsp; </span><span class="c2">&lt;/</span><span class="c47 c5">div</span><span class="c2">&gt;</span><span class="c21"><br> &nbsp; </span><span class="c2">&lt;</span><span class="c47 c5">h4</span><span class="c2">&nbsp;style=</span><span class="c16">&quot;font-family: arial; text-align: center;&quot;</span><span class="c2">&gt;</span><span class="c21">chats</span><span class="c2">&lt;/</span><span class="c47 c5">h4</span><span class="c2">&gt;</span><span class="c21"><br> &nbsp; </span><span class="c2">&lt;</span><span class="c47 c5">div</span><span class="c2">&nbsp;class=</span><span class="c16">&quot;codettesBootcamp2022&quot;</span><span class="c2">&gt;</span><span class="c21"><br> &nbsp; &nbsp; &nbsp; </span><span class="c2">&lt;</span><span class="c47 c5">img</span><span class="c2">&nbsp;class=</span><span class="c16">&quot;bootcamp2022LOGO&quot;</span><span class="c2">&nbsp;src=</span><span class="c16">&quot;bootcamplogo.jpg&quot;</span><span class="c2">&gt;</span><span class="c21"><br> &nbsp; &nbsp; &nbsp; </span><span class="c2">&lt;</span><span class="c47 c5">h4</span><span class="c2">&nbsp;class=</span><span class="c16">&quot;</span><span class="c16">bootcamp2022name</span><span class="c16">&quot;</span><span class="c2">&gt;</span><span class="c21">Bootcamp2022</span><span class="c2">&lt;/</span><span class="c47 c5">h4</span><span class="c2">&gt;</span><span class="c21"><br> &nbsp; </span><span class="c2">&lt;/</span><span class="c47 c5">div</span><span class="c2">&gt;</span><span class="c21"><br> &nbsp; </span><span class="c2">&lt;</span><span class="c47 c5">div</span><span class="c2">&nbsp;id=</span><span class="c16">&quot;userlist&quot;</span><span class="c2">&gt;&lt;/</span><span class="c47 c5">div</span><span class="c2">&gt;</span><span class="c21"><br></span><span class="c2">&lt;/</span><span class="c47 c5">div</span><span class="c2">&gt;</span><span class="c21"><br></span><span class="c2">&lt;/</span><span class="c47 c5">aside</span><span class="c2">&gt;</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">As you can see, it&#39;s all inside an &lt;aside&gt; element.</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Then we have my chat app code:</span></p><p class="c10"><span class="c3"></span></p><a id="t.a9754409e2a330ef22b5b4e0164df3ef238c3f2a"></a><a id="t.1"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c15">&lt;</span><span class="c42 c11">aside</span><span class="c15">&gt;</span><span class="c26"><br> &nbsp; </span><span class="c15">&lt;</span><span class="c42 c11">div</span><span class="c15">&nbsp;class=</span><span class="c14">&quot;chat-LOG&quot;</span><span class="c15">&gt;</span><span class="c26"><br> &nbsp; &nbsp; &nbsp; </span><span class="c15">&lt;</span><span class="c42 c11">div</span><span class="c15">&nbsp;class=</span><span class="c14">&quot;person&quot;</span><span class="c15">&gt;</span><span class="c26"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c15">&lt;</span><span class="c42 c11">h3</span><span class="c15">&nbsp;class=</span><span class="c14">&quot;person-name&quot;</span><span class="c15">&gt;</span><span class="c26">Bootcamp2022</span><span class="c15">&lt;/</span><span class="c42 c11">h3</span><span class="c15">&gt;</span><span class="c26"><br> &nbsp; &nbsp; &nbsp; </span><span class="c15">&lt;/</span><span class="c42 c11">div</span><span class="c15">&gt;</span><span class="c26"><br> &nbsp; &nbsp; &nbsp; </span><span class="c15">&lt;</span><span class="c42 c11">div</span><span class="c15">&nbsp;class=</span><span class="c14">&quot;text-inpt&quot;</span><span class="c15">&nbsp;style=</span><span class="c14">&quot;width: 100%;&quot;</span><span class="c15">&gt;</span><span class="c26"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c15">&lt;</span><span class="c42 c11">div</span><span class="c15">&nbsp;id=</span><span class="c14">&quot;chatlog&quot;</span><span class="c15">&nbsp;style=</span><span class="c14">&quot;width: 100%; height: 650px; text-align: center;&quot;</span><span class="c15">&gt;</span><span class="c26"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c15">&lt;</span><span class="c42 c11">h6</span><span class="c15">&nbsp;style=</span><span class="c14">&quot;margin: 0; padding-top: 10px;&quot;</span><span class="c15">&gt;</span><span class="c26">this chat isn&#39;t safe, so chances of message leaks are<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; high. be<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; careful.</span><span class="c15">&lt;/</span><span class="c42 c11">h6</span><span class="c15">&gt;</span><span class="c26"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c15">&lt;</span><span class="c42 c11">div</span><span class="c15">&nbsp;id=</span><span class="c14">&quot;name&quot;</span><span class="c15">&gt;</span><span class="c26"><br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c15">&lt;/</span><span class="c42 c11">div</span><span class="c15">&gt;</span><span class="c26"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c15">&lt;/</span><span class="c42 c11">div</span><span class="c15">&gt;</span><span class="c26"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c15">&lt;</span><span class="c42 c11">input</span><span class="c15">&nbsp;class=</span><span class="c14">&quot;</span><span class="c14">inpt</span><span class="c14">&quot;</span><span class="c15">&nbsp;type=</span><span class="c14">&quot;text&quot;</span><span class="c15">&nbsp;id=</span><span class="c14">&quot;chatInput&quot;</span><span class="c15">&nbsp;onkeydown=</span><span class="c14">&quot;sendMsg(this)&quot;</span><span class="c15">&gt;</span><span class="c26"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c15">&lt;</span><span class="c42 c11">button</span><span class="c15">&nbsp;class=</span><span class="c14">&quot;sendButton&quot;</span><span class="c15"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; onclick=</span><span class="c14">&quot;sendMessageButton(getElementById(&#39;chatInput&#39;).value); getElementById(&#39;chatInput&#39;).value=&#39;&#39;;&quot;</span><span class="c15">&gt;</span><span class="c26"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c33 c46">&lt;!--digital art--&gt;</span><span class="c26"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c15">&lt;</span><span class="c42 c11">img</span><span class="c15">&nbsp;class=</span><span class="c14">&quot;send-img&quot;</span><span class="c15">&nbsp;src=</span><span class="c14">&quot;sendmessage-orig.png&quot;</span><span class="c15">&gt;&lt;/</span><span class="c42 c11">button</span><span class="c15">&gt;</span><span class="c26"><br> &nbsp; &nbsp; &nbsp; </span><span class="c15">&lt;/</span><span class="c42 c11">div</span><span class="c15">&gt;</span><span class="c26"><br> &nbsp; </span><span class="c15">&lt;/</span><span class="c11 c42">div</span><span class="c15">&gt;</span><span class="c26"><br></span><span class="c15">&lt;/</span><span class="c42 c11">aside</span><span class="c15 c54">&gt;</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Here it&rsquo;s also in an &lt;aside&gt; element, but then we have a bunch of div&rsquo;s. First the chat log div, where you chat. In there is another div, where the person you are talking to is displayed. Then we come to the text-input element. In there the chat log element. Then we have a little warning, and then we add some spacing because we cannot give the inputs paddings or margins, else we cannot display our messages. And then we add the input and the button, and finally we close it.</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 481.50px; height: 338.22px;"><img alt="" src="images/image22.png" style="width: 481.50px; height: 338.22px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><h6 class="c51" id="h.36lrfsxx5iia"><span class="c11 c25">L</span><span class="c67 c25 c11 c34 c55">ibraries</span></h6><p class="c12"><span class="c3">A key thing to note is that we need the mqtt library in order to use it in our javascript. Actually this had to be first but here it is, all in the &lt;head&gt; element:</span></p><p class="c10"><span class="c3"></span></p><a id="t.9ed72fda0cd38c3480e3b8be9b4d1589bef128b8"></a><a id="t.2"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c2">&lt;</span><span class="c47 c5">head</span><span class="c2">&gt;</span><span class="c21"><br> &nbsp; </span><span class="c2">&lt;</span><span class="c47 c5">meta</span><span class="c2">&nbsp;charset=</span><span class="c16">&quot;UTF-8&quot;</span><span class="c2">&gt;</span><span class="c21"><br> &nbsp; </span><span class="c2">&lt;</span><span class="c47 c5">title</span><span class="c2">&gt;</span><span class="c21">bootcamp2022GANG</span><span class="c2">&lt;/</span><span class="c47 c5">title</span><span class="c2">&gt;</span><span class="c21"><br> &nbsp; </span><span class="c2">&lt;</span><span class="c47 c5">link</span><span class="c2">&nbsp;rel=</span><span class="c16">&quot;stylesheet&quot;</span><span class="c2">&nbsp;type=</span><span class="c16">&quot;text/css&quot;</span><span class="c2">&nbsp;href=</span><span class="c16">&quot;style.css&quot;</span><span class="c2">&gt;</span><span class="c21"><br> &nbsp; </span><span class="c2">&lt;</span><span class="c47 c5">script</span><span class="c2">&nbsp;src=</span><span class="c16">&quot;https://cdnjs.cloudflare.com/ajax/libs/mqtt/4.3.7/mqtt.min.js&quot;</span><span class="c2">&nbsp;type=</span><span class="c16">&quot;text/javascript&quot;</span><span class="c2">&gt;&lt;/</span><span class="c47 c5">script</span><span class="c2">&gt;</span><span class="c21"><br></span><span class="c2">&lt;/</span><span class="c47 c5">head</span><span class="c2">&gt;</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Now that we have that done, I can show you the complete thing:</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 539.50px; height: 303.47px;"><img alt="" src="images/image8.png" style="width: 539.50px; height: 303.47px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Now let&#39;s code some javascript.</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&gt;&gt;</span></p><p class="c10"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><h6 class="c51" id="h.64ol3aal5mx"><span class="c25 c11">J</span><span class="c67 c25 c11 c34 c55">avascript - introduction</span></h6><p class="c12"><span class="c67 c25 c11 c34 c75">&ldquo;Javascript is a hot language, it was originally created to move things around and to make things jump from one place to another on the page, but now it is a very popular language and almost all websites use javascript. Javascript can do anything, apply cookies secretly, hide stuff, completely change the html and css, redirect you to a hack site, spoof your data, etc .. that&rsquo;s why some browsers have an option to block javascript. Or sometimes when a site has suspicious javascript, your browser advises you not to enter. An example of this is just a basic javascript loop of displaying stuff and console logging forever on the website. This will crash your computer, resulting in data loss, and the website will be blocked by your browser. Even with your own javascript. So that&#39;s why you gotta be careful with websites using javascript. But in general javascript can do a lot of awesome stuff, for more, check codepen, there are a lot of examples there.&rdquo;</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Well .. that was a long description of javascript. Let&rsquo;s start!</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">The javascript code is here, if you hate me explaining:</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c43"><a class="c30" href="https://www.google.com/url?q=https://github.com/Keshav11-coder/CB2022_Keshav&amp;sa=D&amp;source=editors&amp;ust=1659045919804506&amp;usg=AOvVaw1hDYSMwPbABiV3GJH_aGme">https://github.com/Keshav11-coder/CB2022_Keshav</a></span></p><p class="c10"><span class="c44 c43 c62"></span></p><p class="c12"><span class="c3">chatappV5.0, is currently the latest;</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&gt;&gt;</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><h6 class="c51" id="h.416yq3l5gf05"><span class="c25 c11 c34 c55 c67">Javascript</span></h6><p class="c12"><span class="c3">In this heading, I&#39;ll be explaining how my javascript works. </span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c49 c25 c11">&sect;1. Structure</span></p><p class="c12"><span class="c3">Keep your coffee ready, put on your headphones, open Spotify .. let&#39;s dive in .. </span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">For our code, we need the whole code to run in order to &ldquo;connect&rdquo;. But when you try to send a message, it wont work. That is if you put it in a function. And the sendMessage is also a function. You cannot call functions in functions in javascript. So we&rsquo;re gonna work with class objects. But not the regular class .. objects .. </span></p><p class="c10"><span class="c3"></span></p><a id="t.6b4c857a8096e386f80507090aa457f0c09d2714"></a><a id="t.3"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c28">app = {<br>connection:</span><span class="c24">function</span><span class="c28">(){<br>}</span></p></td></tr></table><p class="c10"><span class="c44 c25 c11"></span></p><p class="c12"><span class="c3">And in the connect function we put everything .. the settings, the client.on&rsquo;s, and the settings (opts).</span></p><p class="c12"><span class="c3">And anything that does something physical on the page, goes out of the object.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c49 c25 c11">&sect;2. settings/variables</span></p><p class="c12"><span class="c3">Everything needs settings or variables, else it just can&rsquo;t work. Our app too.</span></p><p class="c12"><span class="c3">It&rsquo;s a lot, but it&rsquo;s worth it.</span></p><p class="c10"><span class="c3"></span></p><a id="t.877a79da0287452c59901ecd95bb926ac87ee451"></a><a id="t.4"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c24 c46">var</span><span class="c26">&nbsp;USER = </span><span class="c40 c46">document</span><span class="c26">.getElementById(</span><span class="c14">&#39;logon-as&#39;</span><span class="c26">).value;<br></span><span class="c24 c46">var</span><span class="c26">&nbsp;ID = </span><span class="c40 c46">document</span><span class="c26">.getElementById(</span><span class="c14">&#39;admin&#39;</span><span class="c26">).value;<br></span><span class="c24 c46">var</span><span class="c26">&nbsp;mqttServer = </span><span class="c14">&quot;ws://broker.hivemq.com:8000/mqtt&quot;</span><span class="c26">;<br></span><span class="c24 c46">var</span><span class="c26">&nbsp;mqttTopic= </span><span class="c14">&quot;</span><span class="c14">codettes2022</span><span class="c14">&quot;</span><span class="c26">;<br></span><span class="c24 c46">var</span><span class="c26">&nbsp;userName = USER;<br></span><span class="c24 c46">const</span><span class="c26">&nbsp;clientId = </span><span class="c14">&#39;cb22_&#39;</span><span class="c26">&nbsp;+ </span><span class="c40 c46">Math</span><span class="c26">.random().toString(</span><span class="c36 c46">16</span><span class="c26">).substr(</span><span class="c36 c46">2</span><span class="c26">, </span><span class="c36 c46">8</span><span class="c26">)<br></span><span class="c24 c46">var</span><span class="c26">&nbsp;userList = [];<br></span><span class="c24 c46">const</span><span class="c26">&nbsp;opts = {<br> keepalive: </span><span class="c36 c46">30</span><span class="c26">,<br> clientId: clientId,<br> protocolId: </span><span class="c14">&#39;MQTT&#39;</span><span class="c26">,<br> protocolVersion: </span><span class="c36 c46">4</span><span class="c26">,<br> clean: </span><span class="c24 c46">true</span><span class="c26">,<br> reconnectPeriod: </span><span class="c36 c46">1000</span><span class="c26">,<br> connectTimeout: </span><span class="c36 c46">30</span><span class="c26">&nbsp;* </span><span class="c36 c46">1000</span><span class="c26">,<br> will: {<br> &nbsp; topic: </span><span class="c14">&#39;WillMsg&#39;</span><span class="c26">,<br> &nbsp; payload: </span><span class="c14">&#39;Connection Closed abnormally..!&#39;</span><span class="c26">,<br> &nbsp; qos: </span><span class="c36 c46">0</span><span class="c26">,<br> &nbsp; retain: </span><span class="c24 c46">false</span><span class="c26"><br> },<br> rejectUnauthorized: </span><span class="c24 c46">false</span><span class="c26"><br>}<br></span><span class="c40 c46">console</span><span class="c26">.log(</span><span class="c14">&#39;connecting mqtt client&#39;</span><span class="c26">)<br></span><span class="c24 c46">const</span><span class="c26">&nbsp;client = mqtt.connect(mqttServer, opts);</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c49 c25 c11">&sect;3A. client.on();</span></p><p class="c12"><span class="c3">Every app needs an on event manager. Ours too. We have a client.on(&ldquo;something&rdquo;, {}); for that. Here is an example:</span></p><p class="c10"><span class="c3"></span></p><a id="t.ead6f3f85b84c39ae313c068de03a3424eeeef19"></a><a id="t.5"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c21">client.on(</span><span class="c16">&#39;error&#39;</span><span class="c21">, </span><span class="c9">function</span><span class="c21">&nbsp;(err) {<br> </span><span class="c4">console</span><span class="c21">.log(err)<br> client.end()<br>})</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">This handlesan error when there&rsquo;s an error at the client. Instead of blocking the code or continuing the script and looping through errors. It just prints the error and ends the connection to end it all.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Then we have the client.on(connect) function: </span></p><p class="c10"><span class="c3"></span></p><a id="t.e5198b2d68b3f25b442b648b9d85d7d4e439dbbf"></a><a id="t.6"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c21">client.on(</span><span class="c16">&#39;connect&#39;</span><span class="c21">, </span><span class="c9">function</span><span class="c21">&nbsp;() {<br> </span><span class="c31">// Once a connection has been made, make a subscription and send a message.</span><span class="c21"><br> </span><span class="c4">console</span><span class="c21">.log(</span><span class="c16">&#39;client connected:&#39;</span><span class="c21">&nbsp;+ clientId)<br> client.subscribe(mqttTopic, { qos: </span><span class="c27">0</span><span class="c21">&nbsp;})<br><br> message = (USER + </span><span class="c16">&quot; just hopped on! say hi!&quot;</span><span class="c21">);<br> message2 = (USER + </span><span class="c16">&quot; just landed! say hello!&quot;</span><span class="c21">);<br> message3 = (USER + </span><span class="c16">&quot; joined the party! welcome!&quot;</span><span class="c21">);<br> message4 = (</span><span class="c16">&quot;welcome &quot;</span><span class="c21">+ USER +</span><span class="c16">&quot;, we hope you brought boogie&#39;s&quot;</span><span class="c21">);<br> message.destinationName = &nbsp;mqttTopic;<br> message2.destinationName = mqttTopic;<br> message3.destinationName = mqttTopic;<br> message4.destinationName = mqttTopic;<br><br> </span><span class="c9">var</span><span class="c21">&nbsp;values = [message,message2,message3,message4]<br> ToUse = values[</span><span class="c4">Math</span><span class="c21">.floor(</span><span class="c4">Math</span><span class="c21">.random() * values.length)];<br><br> client.publish(mqttTopic, ToUse, { qos: </span><span class="c27">0</span><span class="c21">, retain: </span><span class="c9">false</span><span class="c21">&nbsp;})<br> sendPong();<br>})</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">This basically handles messages and what happens when a user connects. One of the examples is the message displaying. And at the end we send a pong (sends info back)</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&gt;&gt;</span></p><p class="c6 c48"><span class="c3"></span></p><p class="c12"><span class="c49 c25 c11">&sect;3B. client.on();</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Then we also have the .on message event. Here:</span></p><p class="c10"><span class="c3"></span></p><a id="t.c2ba9ab51d62eac90963577639b8859179b87e4d"></a><a id="t.7"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c21">client.on(</span><span class="c16">&#39;message&#39;</span><span class="c21">, </span><span class="c9">function</span><span class="c21">&nbsp;(topic, message, packet) {<br> msg = message.toString(); </span><span class="c31">// library delivers &nbsp;buffer so convert to string first</span><span class="c21"><br> </span><span class="c4">console</span><span class="c21">.log(</span><span class="c16">&quot;onMessageArrived: &quot;</span><span class="c21">+ msg);<br> </span><span class="c31">// if it has JSON payload do NOT add to chat</span><span class="c21"><br> </span><span class="c9">try</span><span class="c21">{<br> &nbsp; msgObj = </span><span class="c4">JSON</span><span class="c21">.parse(message.toString()); </span><span class="c31">// t is JSON so handle it how u want</span><span class="c21"><br> &nbsp; </span><span class="c31">// if message has Pin of Pong in it send it to the PingPongHandler</span><span class="c21"><br> &nbsp; </span><span class="c9">if</span><span class="c21">&nbsp;(</span><span class="c4">Object</span><span class="c21">.keys(msgObj)[</span><span class="c27">0</span><span class="c21">] == </span><span class="c16">&quot;ping&quot;</span><span class="c21">){sendPong();};<br> &nbsp; </span><span class="c9">if</span><span class="c21">&nbsp;(</span><span class="c4">Object</span><span class="c21">.keys(msgObj)[</span><span class="c27">0</span><span class="c21">] == </span><span class="c16">&quot;pong&quot;</span><span class="c21">){handlePong(msgObj.pong);}; </span><span class="c31">// pong value is an object!!</span><span class="c21"><br> &nbsp; </span><span class="c31">// other handlers for control messages below</span><span class="c21"><br> }</span><span class="c9">catch</span><span class="c21">{<br> &nbsp; </span><span class="c4">document</span><span class="c21">.getElementById(</span><span class="c16">&quot;chatlog&quot;</span><span class="c21">).innerHTML += </span><span class="c16">&quot;&lt;br&gt;&quot;</span><span class="c21">&nbsp;+ msg;<br> }<br>})</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">This basically activates when a user receives messages. First they convert it to a string, then we check if the message has JSON content in it, if it does then we don&#39;t display it. If it doesn&#39;t then we do.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">And at the end we log the message to the chat log.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c49 c25 c11">&sect;4A. Ping</span></p><p class="c12"><span class="c3">Yes, and no, it&#39;s not the game of ping pong, ping pong basically does this:</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">The client pings, requests info &gt;</span></p><p class="c12"><span class="c3">&lt; the app pongs, gives info back.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Ping:</span></p><p class="c10"><span class="c3"></span></p><a id="t.ef7a8f9d0acf8e65a68ca3dbe7e2361b4a47c226"></a><a id="t.8"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c9">function</span><span class="c21">&nbsp;</span><span class="c4">sendPing</span><span class="c21">(usr=</span><span class="c16">&#39;*&#39;</span><span class="c21">){<br> &nbsp; </span><span class="c31">// ping sends out a message to all (*) or any specific user to respond if ur there</span><span class="c21"><br> &nbsp; </span><span class="c9">var</span><span class="c21">&nbsp;pingObj={ping:usr}; </span><span class="c31">// JS Object {ping : &quot;usr&quot;} -&gt; JSON {/&quot;ping/&quot;:/&quot;usr/&quot;}</span><span class="c21"><br> &nbsp; client.publish(mqttTopic, </span><span class="c4">JSON</span><span class="c21">.stringify(pingObj));<br>}</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">It just sends a ping to all and then does some more json stuff..</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span>&nbsp;</span><span class="c49 c25 c11">&sect;4B. Pong</span></p><p class="c12"><span class="c3">Now we send info back: </span></p><p class="c10"><span class="c3"></span></p><a id="t.824268c5c5a8a3eadc1f9b070ac085d1f4bc5c18"></a><a id="t.9"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c9">function</span><span class="c21">&nbsp;</span><span class="c4">sendPong</span><span class="c21">(){<br> &nbsp; </span><span class="c31">// sends clientID and UserName in a JSON object (and whatever u need more)</span><span class="c21"><br> &nbsp; </span><span class="c9">var</span><span class="c21">&nbsp;pongObj={pong :{userName : userName, clientId:clientId}};<br> &nbsp; client.publish(mqttTopic, </span><span class="c4">JSON</span><span class="c21">.stringify(pongObj));<br> &nbsp; </span><span class="c4">console</span><span class="c21">.log(</span><span class="c4">JSON</span><span class="c21">.stringify(pongObj));<br>}</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">This basically creates a pong object, &nbsp;publishes it into the mqtt, and then the console logs it. Because we don&#39;t want json messages in the chat. You could say this json has become cheat codes or special secret codes.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c49 c25 c11">&sect;5. redrawUserList</span></p><p class="c12"><span class="c3">The userList seems kind of boring and empty. So let&rsquo;s upgrade it a little. For every user that logs on, create a chat in the user list:</span></p><p class="c10"><span class="c3"></span></p><a id="t.74cecca0f1b44e3f875b5a163ee3da250668a317"></a><a id="t.10"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c9">function</span><span class="c21">&nbsp;</span><span class="c4">redrawUserList</span><span class="c21">(){<br> &nbsp; </span><span class="c31">// Generate the userlist HTML</span><span class="c21"><br> &nbsp; </span><span class="c9">var</span><span class="c21">&nbsp;ulist=</span><span class="c16">&quot;&quot;</span><span class="c21">;<br> &nbsp; userList.forEach(</span><span class="c9">function</span><span class="c21">&nbsp;(item) {<br> &nbsp; &nbsp; &nbsp; </span><span class="c31">//var x = arrayItem.prop1 + 2;</span><span class="c21"><br> &nbsp; &nbsp; &nbsp; </span><span class="c9">var</span><span class="c21">&nbsp;</span><span class="c21">CHATBUBBLE</span><span class="c21">=</span><span class="c16">&#39;&lt;div class=&quot;codettesBootcamp2022&quot;&gt;&lt;h4 class=&quot;</span><span class="c16">bootcamp2022name</span><span class="c16">&quot;&gt;&#39;</span><span class="c21">;</span><span class="c31">//&lt;/h4&gt;&lt;/div&gt;</span><span class="c21"><br> &nbsp; &nbsp; &nbsp; </span><span class="c9">if</span><span class="c21">(item.userName == USER){<br> &nbsp; &nbsp; &nbsp; }</span><span class="c9">else</span><span class="c21">{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c21">ulist+</span><span class="c21">= </span><span class="c21">CHATBUBBLE</span><span class="c21">&nbsp;+ item.userName + </span><span class="c16">&quot;&lt;i class=&#39;fa fa-fw fa-phone&#39;&gt;&lt;/i&gt;&lt;/a&gt;&lt;/li&gt;&quot;</span><span class="c21">+ </span><span class="c16">&quot;&lt;/h4&gt;&lt;/div&gt;&quot;</span><span class="c21">&nbsp;+</span><span class="c16">&quot;&lt;br&gt;&quot;</span><span class="c21"><br> &nbsp; &nbsp; &nbsp; }<br> &nbsp; });<br> &nbsp; </span><span class="c4">console</span><span class="c21">.log(ulist);<br> &nbsp; </span><span class="c4">document</span><span class="c21">.getElementById(</span><span class="c16">&quot;userlist&quot;</span><span class="c21">).innerHTML=ulist;<br>}</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">So this basically does what I said: for every user that pops on, create something in the userlist.</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&gt;&gt;</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c49 c25 c11">&sect;6. Handle pongs</span></p><p class="c12"><span class="c3">This makes sure no person gets in the userlist twice and handles all the pongs. With these pongs the userlist can be updated:</span></p><p class="c10"><span class="c3"></span></p><a id="t.bd6f14d53db5abfc61579cb4a95425c9a7db7688"></a><a id="t.11"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c9">function</span><span class="c21">&nbsp;</span><span class="c4">handlePong</span><span class="c21">(pongObj){<br> &nbsp; </span><span class="c31">// Update Userlist with Pongs</span><span class="c21"><br> &nbsp; </span><span class="c9">const</span><span class="c21">&nbsp;index = userList.findIndex(object =&gt; {<br> &nbsp; &nbsp; </span><span class="c9">return</span><span class="c21">&nbsp;object.userName === pongObj.userName;<br> &nbsp; });<br><br> &nbsp; </span><span class="c31">//console.log(&quot;index:&quot; + index);</span><span class="c21"><br> &nbsp; </span><span class="c9">if</span><span class="c21">(index&gt;=</span><span class="c27">0</span><span class="c21">){<br> &nbsp; &nbsp; &nbsp; </span><span class="c4">console</span><span class="c21">.log(</span><span class="c16">&quot;User exists&quot;</span><span class="c21">);<br> &nbsp; &nbsp; &nbsp; userList[index] = pongObj;<br> &nbsp; } </span><span class="c9">else</span><span class="c21">{<br> &nbsp; &nbsp; &nbsp; </span><span class="c4">console</span><span class="c21">.log(</span><span class="c16">&quot;New User &quot;</span><span class="c21">&nbsp;+ pongObj.userName);<br> &nbsp; &nbsp; &nbsp; userList.push(pongObj);<br> &nbsp; }<br> &nbsp; </span><span class="c31">//console.log(userList);</span><span class="c21"><br> &nbsp; redrawUserList();<br>}</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c49 c25 c11">&sect;7. Steal that input</span></p><p class="c12"><span class="c3">Anything that does something physical on the page, like sending messages and updating the chatlog goes outside.</span></p><p class="c10"><span class="c3"></span></p><a id="t.24f9d17ad444c0cd1fe1c42d01626066cae329be"></a><a id="t.12"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c9">var</span><span class="c21">&nbsp;USER = </span><span class="c4">document</span><span class="c21">.getElementById(</span><span class="c16">&#39;logon-as&#39;</span><span class="c21">).value;<br></span><span class="c9">var</span><span class="c21">&nbsp;ID = </span><span class="c4">document</span><span class="c21">.getElementById(</span><span class="c16">&#39;admin&#39;</span><span class="c21">).value;<br><br></span><span class="c9">function</span><span class="c21">&nbsp;</span><span class="c4">getInput</span><span class="c21">(){<br> &nbsp; </span><span class="c9">var</span><span class="c21">&nbsp;USER = </span><span class="c4">document</span><span class="c21">.getElementById(</span><span class="c16">&#39;logon-as&#39;</span><span class="c21">).value;<br> &nbsp; </span><span class="c9">var</span><span class="c21">&nbsp;ID = </span><span class="c4">document</span><span class="c21">.getElementById(</span><span class="c16">&#39;admin&#39;</span><span class="c21">).value;<br> &nbsp; </span><span class="c4">document</span><span class="c21">.getElementById(</span><span class="c16">&quot;content&quot;</span><span class="c21">).className=</span><span class="c16">&quot;content&quot;</span><span class="c21">;<br> &nbsp; </span><span class="c4">document</span><span class="c21">.getElementById(</span><span class="c16">&quot;</span><span class="c16">chatapp</span><span class="c16">&quot;</span><span class="c21">).className=</span><span class="c16">&quot;N&quot;</span><span class="c21">;<br> &nbsp; </span><span class="c4">console</span><span class="c21">.log(</span><span class="c16">&quot;alert{&gt;&gt;&#39;new user signed on as [&quot;</span><span class="c21">+ USER +</span><span class="c16">&quot;] with:id:of[&quot;</span><span class="c21">+ ID +</span><span class="c16">&quot;]&#39;&lt;&lt;}&quot;</span><span class="c21">);<br> &nbsp; </span><span class="c4">console</span><span class="c21">.log(</span><span class="c16">&quot;dialog hidden&quot;</span><span class="c21">);<br> &nbsp; app.connection();<br>}</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">We first actually do this. This gets the inputs from the login screen and saves them. So we can use them later</span></p><p class="c10"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><p class="c12"><span class="c49 c25 c11">&sect;8A. reborn</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">The functions that actually do something on the page are the sendMessage and sendMessageButton.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Before we can use them.. We have to declare these variables again, else they won&#39;t work:</span></p><p class="c10"><span class="c3"></span></p><a id="t.b33693339c17cbe41c512cb9cea426a1b8f8175d"></a><a id="t.13"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c9">var</span><span class="c21">&nbsp;USER = </span><span class="c4">document</span><span class="c21">.getElementById(</span><span class="c16">&#39;logon-as&#39;</span><span class="c21">).value;<br></span><span class="c9">var</span><span class="c21">&nbsp;mqttServer = </span><span class="c16">&quot;ws://broker.hivemq.com:8000/mqtt&quot;</span><span class="c21">;<br></span><span class="c9">var</span><span class="c21">&nbsp;mqttTopic= </span><span class="c16">&quot;</span><span class="c16">codettes2022</span><span class="c16">&quot;</span><span class="c21">;<br></span><span class="c9">var</span><span class="c21">&nbsp;userName = USER;</span><span class="c31">//document.getElementById(&quot;logon-as&quot;).value; // || &quot;anonymous user&quot;</span><span class="c21"><br></span><span class="c31">//var userName = &quot;anonymous usr&quot;;</span><span class="c21"><br></span><span class="c9">const</span><span class="c21">&nbsp;clientId = </span><span class="c16">&#39;cb22_&#39;</span><span class="c21">&nbsp;+ </span><span class="c4">Math</span><span class="c21">.random().toString(</span><span class="c27">16</span><span class="c21">).substr(</span><span class="c27">2</span><span class="c21">, </span><span class="c27">8</span><span class="c21">)<br></span><span class="c9">var</span><span class="c21">&nbsp;userList = [];<br><br></span><span class="c9">const</span><span class="c21">&nbsp;opts = {<br> keepalive: </span><span class="c27">30</span><span class="c21">,<br> clientId: clientId,<br> protocolId: </span><span class="c16">&#39;MQTT&#39;</span><span class="c21">,<br> protocolVersion: </span><span class="c27">4</span><span class="c21">,<br> clean: </span><span class="c9">true</span><span class="c21">,<br> reconnectPeriod: </span><span class="c27">1000</span><span class="c21">,<br> connectTimeout: </span><span class="c27">30</span><span class="c21">&nbsp;* </span><span class="c27">1000</span><span class="c21">,<br> will: {<br> &nbsp; topic: </span><span class="c16">&#39;WillMsg&#39;</span><span class="c21">,<br> &nbsp; payload: </span><span class="c16">&#39;Connection Closed abnormally..!&#39;</span><span class="c21">,<br> &nbsp; qos: </span><span class="c27">0</span><span class="c21">,<br> &nbsp; retain: </span><span class="c9">false</span><span class="c21"><br> },<br> rejectUnauthorized: </span><span class="c9">false</span><span class="c21"><br>}<br><br></span><span class="c4">console</span><span class="c21">.log(</span><span class="c16">&#39;connecting mqtt client&#39;</span><span class="c21">)<br></span><span class="c9">const</span><span class="c21">&nbsp;client = mqtt.connect(mqttServer, opts);</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&gt;&gt;</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c25 c11 c49">&sect;8B. Physical functions</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">The sendmessage button basically checks if the text is nothing, if it&rsquo;s not then send a message. Remember that this is only triggered when the user uses the button to send messages:</span></p><a id="t.0539a8d78e6c3da25e277d06a9eed551b6241ac7"></a><a id="t.14"></a><table class="c20"><tr class="c7"></tr></table><p class="c6 c58"><span class="c3"></span></p><a id="t.7df777455c61062ecb8a465f182d2f705d474963"></a><a id="t.15"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c24">function</span><span class="c28">&nbsp;</span><span class="c40">sendMessageButton</span><span class="c28">(msgtext){<br> &nbsp; &nbsp;</span><span class="c24">if</span><span class="c28">&nbsp;(msgtext!=</span><span class="c18">&#39;&#39;</span><span class="c28">){<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c24">var</span><span class="c28">&nbsp;USER = </span><span class="c40">document</span><span class="c28">.getElementById(</span><span class="c18">&#39;logon-as&#39;</span><span class="c28">).value;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c24">var</span><span class="c28">&nbsp;userName = USER;</span><span class="c33">//document.getElementById(&quot;loginName&quot;).value; // || &quot;anonymous user&quot;</span><span class="c28"><br> &nbsp; &nbsp; &nbsp; &nbsp;client.publish(mqttTopic, userName + </span><span class="c18">&quot; says: &quot;</span><span class="c28">&nbsp;+ msgtext);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c24">if</span><span class="c28">(msgtext == </span><span class="c18">&quot;whoami&quot;</span><span class="c28">){<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c40">console</span><span class="c28">.log(userName);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;client.publish(mqttTopic, </span><span class="c18">&quot;Your name is &quot;</span><span class="c28">&nbsp;+ userName + </span><span class="c18">&quot;, silly&quot;</span><span class="c28">);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c6 c58"><span class="c3"></span></p><p class="c61"><span class="c3">And then we have the sendmessage, that just listens if you press enter and the textbox has input and then sends the message:</span></p><p class="c61 c58"><span class="c3"></span></p><a id="t.c0d6d570bfd0b0e433d4d3592e1f6639753501a9"></a><a id="t.16"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c9">function</span><span class="c21">&nbsp;</span><span class="c4">sendMsg</span><span class="c21">(ele) {<br> &nbsp; </span><span class="c9">if</span><span class="c21">(event.key === </span><span class="c16">&#39;Enter&#39;</span><span class="c21">) {<br> &nbsp; &nbsp; &nbsp; </span><span class="c9">var</span><span class="c21">&nbsp;USER = </span><span class="c4">document</span><span class="c21">.getElementById(</span><span class="c16">&#39;logon-as&#39;</span><span class="c21">).value;<br> &nbsp; &nbsp; &nbsp; </span><span class="c9">var</span><span class="c21">&nbsp;userName = USER;</span><span class="c31">//document.getElementById(&quot;loginName&quot;).value; // || &quot;anonymous user&quot;</span><span class="c21"><br> &nbsp; &nbsp; &nbsp; </span><span class="c9">if</span><span class="c21">(ele.value == </span><span class="c16">&quot;whoami&quot;</span><span class="c21">){<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c4">console</span><span class="c21">.log(userName);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; client.publish(mqttTopic, </span><span class="c16">&quot;Your name is &quot;</span><span class="c21">&nbsp;+ userName + </span><span class="c16">&quot;, silly&quot;</span><span class="c21">);<br> &nbsp; &nbsp; &nbsp; }<br> &nbsp; &nbsp; &nbsp; client.publish(mqttTopic, userName + </span><span class="c16">&quot; says: &quot;</span><span class="c21">&nbsp;+ ele.value);<br> &nbsp; &nbsp; &nbsp; </span><span class="c31">//alert(ele.value);</span><span class="c21"><br> &nbsp; &nbsp; &nbsp; ele.value = </span><span class="c16">&quot;&quot;</span><span class="c21">; </span><span class="c31">// reset the input after entering</span><span class="c21"><br> &nbsp; }<br>}</span></p></td></tr></table><p class="c61 c58"><span class="c3"></span></p><p class="c61"><span class="c3">With all of this code together, we form the app.js. Download it at the github page somewhere above.</span></p><p class="c58 c61"><span class="c3"></span></p><p class="c61 c58"><span class="c3"></span></p><p class="c61 c58"><span class="c3"></span></p><p class="c61"><span class="c3">&gt;&gt;</span></p><h4 class="c65" id="h.z4r09glchm4r"><span class="c13 c11">Does it work though</span></h4><p class="c12"><span class="c3">Yes, it does. And I finalized it a bit. Added some new colors, and even the login screen, check it out:</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: -0.00px 0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 323.00px;"><img alt="" src="images/image24.png" style="width: 624.00px; height: 351.00px; margin-left: 0.00px; margin-top: -28.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: -0.00px 0.00px; border: 2.67px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 321.00px;"><img alt="" src="images/image15.png" style="width: 624.00px; height: 351.00px; margin-left: 0.00px; margin-top: -30.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">And that is the chat app until now! Hope you enjoyed it. And as you can see, it does work.</span></p><p class="c6 c48"><span class="c5 c52"></span></p><h2 class="c38" id="h.zgby92kz48ms"><span class="c54 c25 c11 c69 c55">Build Chat app back-end NodeJS</span></h2><p class="c12"><span class="c3">Hey! I&rsquo;m back, and here&rsquo;s some more documentation on NodeJS back-end in depth ..</span></p><p class="c10"><span class="c3"></span></p><h3 class="c66 c59" id="h.hscxrv5tyao5"><span class="c39 c25 c11">Basic localhost</span></h3><p class="c12"><span class="c3">The First thing I did was of course host something on localhost:xxxx, but how did we do that? Well! Here&rsquo;s the answer: ctrl c + ctrl v. </span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&hellip;</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Just kidding, but most of it was copied from the internet sooo .. </span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span>The platform (or npm package) we used for this was </span><span class="c11">express</span><span>, express helps you host your &ldquo;website&rdquo; on localhost and do stuff with it. But why not http? That would also work .. but we had to work with express. Probably because it supports a </span><span class="c11">topic we will discuss later</span><span class="c3">, or it&rsquo;s very easy to code endpoints, just like Flask. But okay, enough of that. Let&#39;s explain the code.</span></p><p class="c10"><span class="c3"></span></p><h4 class="c41" id="h.ozkp3nkyhfa8"><span class="c13 c11">Express setup</span></h4><p class="c12"><span>To install express, all I had to do was type &ldquo;</span><span class="c34">npm i express</span><span class="c3">&rdquo; in the NodeJS terminal. If you did not know, the &ldquo;i&rdquo; in there basically refers to &ldquo;install&rdquo;, so you&rsquo;re basically telling the system:</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span>&nbsp;&ldquo;</span><span class="c34">hey listen, I said npm install, so you know I wanna install something</span><span class="c3">&rdquo;</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">After installation, I&rsquo;m gonna include the library in my javascript, like this:</span></p><a id="t.d1755323eec52194771f4872f52349e655b07d8b"></a><a id="t.17"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c24">const</span><span class="c28">&nbsp;express = </span><span class="c40">require</span><span class="c28">(</span><span class="c18">&quot;express&quot;</span><span class="c28">)<br></span><span class="c24">const</span><span class="c28">&nbsp;path = </span><span class="c40">require</span><span class="c28">(</span><span class="c18">&quot;path&quot;</span><span class="c28">)<br></span><span class="c24">const</span><span class="c28">&nbsp;app = express()</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span>We also have something called path, we can install it like this: &ldquo;</span><span class="c34">npm i path</span><span class="c3">&rdquo;.</span></p><p class="c12"><span>But here we are basically including the express and path libraries, and setting the &ldquo;app&rdquo; variable to &ldquo;express();&rdquo;. This means that you&rsquo;re telling </span><span>express</span><span class="c3">&nbsp;that you are ready, and that he needs to be ready too.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Here you can see we are taking the static files, like html css and js from the data folder and using them as a landing page when you go to localhost:</span></p><a id="t.6ed294fc3f19067d76e428aadd24c85e36489626"></a><a id="t.18"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c24 c32">const</span><span class="c28 c32">&nbsp;publicDirectoryPath = path.join(__dirname, </span><span class="c17">&#39;data&#39;</span><span class="c28 c32">)<br>app.use(</span><span class="c17">&#39;/&#39;</span><span class="c28 c32">, express.static(publicDirectoryPath))</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><h4 class="c41" id="h.defavqlq9re1"><span class="c13 c11">Express endpoints</span></h4><p class="c12"><span class="c3">When we&rsquo;re gonna make a &ldquo;website&rdquo;, we won&rsquo;t only have a home screen right? We also want subdomains .. so let&rsquo;s add them:</span></p><p class="c10"><span class="c3"></span></p><a id="t.c0826572f23cd6b4bdd4d379aa00f76c28541536"></a><a id="t.19"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c28">app.get(</span><span class="c18">&#39;/api.syscore.log&#39;</span><span class="c28">, (req, res) =&gt; {<br> &nbsp;res.send(</span><span class="c18">&quot;something else&quot;</span><span class="c28">)<br>})<br><br>app.get(</span><span class="c18">&#39;/api.syscore.users&#39;</span><span class="c28">, (req, res) =&gt; {<br> &nbsp;res.send(</span><span class="c18">&quot;something&quot;</span><span class="c28">)<br>})</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">We are first setting the app.get property to whatever you want, it just doesn&#39;t need to have spaces. And then we define the request(req) and the response(res) between the client and the back-end. And then we send something to the website. Of course you can also add styling and html to it by using the method up top but when you don&#39;t want to send much info except for plain text then this is the way to go.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span>Here I have an example but here we fetch some data from </span><span class="c11">MongoDB</span><span class="c3">&nbsp;and use it there, a topic i&#39;ll explain later:</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 350.67px;"><img alt="" src="images/image13.png" style="width: 624.00px; height: 350.67px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><h3 class="c66 c59" id="h.xdt3nf6l0sgu"><span class="c25 c11 c39">Set up basic communication using mqtt between back-end and client</span></h3><p class="c12"><span>If you&rsquo;ve looked at the previous </span><span>chatapp</span><span class="c3">&nbsp;code, you&rsquo;ve probably seen functions like &ldquo;client.on message&rdquo; or &ldquo;handlepong&rdquo; or &ldquo;sendmessage&rdquo; .. we are going to use those functions here too.</span></p><h4 class="c41" id="h.cz613hnrmu18"><span class="c13 c11">Mqtt setup NodeJS</span></h4><p class="c12"><span class="c3">To set up mqtt, I first had to install mqtt using the usual: &ldquo;npm i mqtt&rdquo; .. and then the setup in the code:</span></p><p class="c10"><span class="c3"></span></p><a id="t.7d7013e7eb4e60abc6e4931be37fbc29824bce0f"></a><a id="t.20"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c24">const</span><span class="c28">&nbsp;mqtt = require(</span><span class="c18">&#39;mqtt&#39;</span><span class="c28">)<br></span><span class="c24">const</span><span class="c28">&nbsp;client = mqtt.</span><span class="c40">connect</span><span class="c28">(</span><span class="c18">&quot;ws://broker.hivemq.com:8000/mqtt&quot;</span><span class="c28">)</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">We are doing the basic stuff, saying that mqtt is the package mqtt, and connecting to the broker.</span></p><h4 class="c41" id="h.ecleeiewqp2m"><span class="c13 c11">Callbacks and functions</span></h4><p class="c12"><span class="c3">As I already said, we have a few (alot!) functions that we have to add to get our chat app working with NodeJS. </span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c44 c25 c11">&gt;&gt;next page&gt;&gt;</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c49 c25 c11">&sect;1. Callbacks</span></p><p class="c12"><span class="c3">The first callback we&rsquo;ll talk about is the connect callback. But what are callbacks exactly? For example the connect callback, it basically looks out for when a client connects to my app, and does what&#39;s in its brackets. And when a client (currently you) is already connected, it stays idle. (according to my research)</span></p><p class="c10"><span class="c3"></span></p><a id="t.81cc8c7df1fa9fbcf39ffc3a9de805255410ca2b"></a><a id="t.21"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c21">client.on(</span><span class="c16">&#39;connect&#39;</span><span class="c21">, </span><span class="c9">function</span><span class="c21">&nbsp;() {<br> client.subscribe(</span><span class="c16">&#39;codettes2022&#39;</span><span class="c21">, </span><span class="c9">function</span><span class="c21">&nbsp;(err) {<br> &nbsp; </span><span class="c9">if</span><span class="c21">&nbsp;(!err) {<br> &nbsp; &nbsp; client.publish(</span><span class="c16">&#39;codettes2022&#39;</span><span class="c21">, </span><span class="c16">&#39;Hello from NodeJS (No you </span><span class="c16">cant</span><span class="c16">&nbsp;eat it)&#39;</span><span class="c21">)<br> &nbsp; }<br> })<br>})</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&rdquo;</span></p><p class="c12"><span class="c3">The next callback checks when a message arrives. When it gets the message, it checks whether the message has JSON code in it, if it does, do something, if it doesn&rsquo;t, filter it and don&#39;t display it. Else display the message.</span></p><p class="c10"><span class="c3"></span></p><a id="t.5374ca16243db5f89348e6685e47b4f6b3ccb9b5"></a><a id="t.22"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c28 c23">client.on(</span><span class="c18 c23">&#39;message&#39;</span><span class="c28 c23">, </span><span class="c24 c23">function</span><span class="c28 c23">&nbsp;(topic, message) {<br> </span><span class="c33 c23">// message is Buffer</span><span class="c28 c23"><br> &nbsp;</span><span class="c24 c23">try</span><span class="c28 c23">&nbsp;{<br> &nbsp; &nbsp; &nbsp;msgObj = </span><span class="c40 c23">JSON</span><span class="c28 c23">.parse(message.toString()); </span><span class="c33 c23">// t is JSON so handle it how u want</span><span class="c28 c23"><br> &nbsp; &nbsp; &nbsp;</span><span class="c33 c23">// if message has Pin of Pong in it send it to the PingPongHandler</span><span class="c28 c23"><br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c23">if</span><span class="c28 c23">&nbsp;(</span><span class="c40 c23">Object</span><span class="c28 c23">.keys(msgObj)[</span><span class="c36 c23">0</span><span class="c28 c23">] == </span><span class="c18 c23">&quot;ping&quot;</span><span class="c28 c23">) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sendPong(</span><span class="c18 c23">&quot;codettes2022&quot;</span><span class="c28 c23">,</span><span class="c18 c23">&quot;Server&quot;</span><span class="c28 c23">, </span><span class="c18 c23">&quot;cb_12345678&quot;</span><span class="c28 c23">);<br> &nbsp; &nbsp; &nbsp;};<br> &nbsp; &nbsp; &nbsp;</span><span class="c23 c24">if</span><span class="c28 c23">&nbsp;(</span><span class="c40 c23">Object</span><span class="c28 c23">.keys(msgObj)[</span><span class="c23 c36">0</span><span class="c28 c23">] == </span><span class="c18 c23">&quot;pong&quot;</span><span class="c28 c23">) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;handlePong(msgObj.pong);<br> &nbsp; &nbsp; &nbsp;}; </span><span class="c33 c23">// pong value is an object!!</span><span class="c28 c23"><br> &nbsp; &nbsp; &nbsp;</span><span class="c33 c23">// other handlers for control messages below</span><span class="c28 c23"><br> &nbsp;} </span><span class="c24 c23">catch</span><span class="c28 c23">&nbsp;{<br> &nbsp; &nbsp; &nbsp;messages.push({</span><span class="c18 c23">&quot;time&quot;</span><span class="c28 c23">&nbsp;: </span><span class="c40 c23">Date</span><span class="c28 c23">(), &nbsp;</span><span class="c18 c23">&quot;topic&quot;</span><span class="c28 c23">&nbsp;: topic, </span><span class="c18 c23">&quot;message&quot;</span><span class="c28 c23">&nbsp;: message.toString()});<br> &nbsp;}<br> </span><span class="c40 c23">console</span><span class="c28 c23">.log(message.toString())<br>})</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&gt;&gt;</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c49 c25 c11">&sect;2. Functions</span></p><p class="c12"><span class="c3">There&rsquo;s no code without functions. Or, there can be, but then it&rsquo;s really messed up and not structured. Even my app uses functions a lot.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">The first function that we use is the sendPing function. As I already said, It just sends a ping to all and then does some more json stuff.</span></p><p class="c10"><span class="c3"></span></p><a id="t.3d60bc0d62b2a0ac478e3e48f17a8276dd855ac2"></a><a id="t.23"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c9">function</span><span class="c21">&nbsp;sendPing(usr = </span><span class="c16">&#39;*&#39;</span><span class="c21">, mqttTopic = </span><span class="c16">&quot;</span><span class="c16">codettes2022</span><span class="c16">&quot;</span><span class="c21">) {<br> &nbsp; var pingObj = {<br> &nbsp; &nbsp; &nbsp; ping: usr<br> &nbsp; }; // JS Object {ping : </span><span class="c16">&quot;usr&quot;</span><span class="c21">} -&gt; JSON {/</span><span class="c16">&quot;ping/&quot;</span><span class="c21">:/</span><span class="c16">&quot;usr/&quot;</span><span class="c21">}<br> &nbsp; client.publish(mqttTopic, JSON.stringify(pingObj));<br>}</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span>And then we have the </span><span>pong</span><span class="c3">&nbsp;function. That basically sends a pong (response) to everyone. In short: sending information back.</span></p><p class="c10"><span class="c3"></span></p><a id="t.5f17612388480a30822952b2830c6a134c69def0"></a><a id="t.24"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c9">function</span><span class="c21">&nbsp;</span><span class="c4">sendPong</span><span class="c21">(_mqttTopic = </span><span class="c16">&quot;codettes2022&quot;</span><span class="c21">, _userName = </span><span class="c16">&quot;Server&quot;</span><span class="c21">, _clientId = </span><span class="c16">&quot;cb_12345678&quot;</span><span class="c21">) {<br> &nbsp; </span><span class="c31">// sends clientID and UserName in a JSON object (and whatever u need more)</span><span class="c21"><br> &nbsp; </span><span class="c9">var</span><span class="c21">&nbsp;pongObj = {<br> &nbsp; &nbsp; &nbsp; pong: {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; userName: _userName,<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; clientId: _clientId<br> &nbsp; &nbsp; &nbsp; }<br> &nbsp; };<br> &nbsp; </span><span class="c4">console</span><span class="c21">.log(</span><span class="c4">JSON</span><span class="c21">.stringify(pongObj));<br> &nbsp; client.publish(_mqttTopic, </span><span class="c4">JSON</span><span class="c21">.stringify(pongObj));<br>}</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span>And then we have the handle pong, no person gets in the userlist twice and the </span><span>handlepong</span><span class="c3">&nbsp;handles all the pongs. With these pongs the userlist can be updated, as I already said.</span></p><p class="c10"><span class="c3"></span></p><a id="t.97550e24f4f1c160ed397a3e591f22bff0e3ba8c"></a><a id="t.25"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c24 c23">function</span><span class="c28 c23">&nbsp;</span><span class="c40 c23">handlePong</span><span class="c28 c23">(pongObj) {<br> &nbsp; </span><span class="c24 c23">const</span><span class="c28 c23">&nbsp;index = userList.findIndex(object =&gt; {<br> &nbsp; &nbsp; &nbsp; </span><span class="c24 c23">return</span><span class="c28 c23">&nbsp;object.userName === pongObj.userName;<br> &nbsp; });<br> &nbsp; </span><span class="c24 c23">if</span><span class="c28 c23">&nbsp;(index &gt;= </span><span class="c36 c23">0</span><span class="c28 c23">) {<br> &nbsp; &nbsp; &nbsp; </span><span class="c40 c23">console</span><span class="c28 c23">.log(</span><span class="c18 c23">&quot;User exists&quot;</span><span class="c28 c23">);<br> &nbsp; &nbsp; &nbsp; userList[index] = pongObj;<br> &nbsp; } </span><span class="c24 c23">else</span><span class="c28 c23">&nbsp;{<br> &nbsp; &nbsp; &nbsp; </span><span class="c40 c23">console</span><span class="c28 c23">.log(</span><span class="c18 c23">&quot;New User &quot;</span><span class="c28 c23">&nbsp;+ pongObj.userName);<br> &nbsp; &nbsp; &nbsp; userList.push(pongObj);<br> &nbsp; }<br>}</span></p></td></tr></table><h3 class="c66 c59" id="h.tm3x7a558yuj"><span class="c39 c25 c11">Last man standing</span></h3><p class="c12"><span class="c3">So now that we have all that, ending off is the same, we just add the endpoints and listen at port 3000</span></p><p class="c10"><span class="c3"></span></p><a id="t.77bb5107220da6d15f8e466fe49377a6875b74ed"></a><a id="t.26"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c63 c62 c35">//</span><span class="c21">&nbsp;Express static webserserver<br>const publicDirectoryPath = path.join(__dirname, </span><span class="c16">&#39;data&#39;</span><span class="c21">)<br>app.use(</span><span class="c16">&#39;/&#39;</span><span class="c21">,express.static(publicDirectoryPath))<br><br><br></span><span class="c62 c35 c63">//</span><span class="c21">&nbsp;Express API routes<br>app.get(</span><span class="c16">&#39;/log&#39;</span><span class="c21">, (req, res) =&gt; {<br> res.send(messages)<br>})<br><br>app.get(</span><span class="c16">&#39;/users&#39;</span><span class="c21">, (req, res) =&gt; {<br> res.send(userList)<br>})<br><br><br>app.listen(</span><span class="c27">3000</span><span class="c21">, () =&gt; {<br> &nbsp;</span><span class="c4">console</span><span class="c21">.log(</span><span class="c16">&quot;Server has started!&quot;</span><span class="c21">)<br>})</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Ok, so now we can add all the log and info at endpoints and use it with NodeJS. Now comes storing the data somewhere, like in MongoDB, but that&rsquo;s for the next objective, see you there!</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Link to the NodeJS code:</span></p><p class="c12"><span class="c43"><a class="c30" href="https://www.google.com/url?q=https://github.com/Keshav11-coder/CB2022_Keshav/tree/main/cloudserver&amp;sa=D&amp;source=editors&amp;ust=1659045919847113&amp;usg=AOvVaw3kUxKYm7gPUF6Mtz4886zB">https://github.com/Keshav11-coder/CB2022_Keshav/tree/main/cloudserver</a></span></p><p class="c6 c48"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&gt;&gt;</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c6 c48 c45"><span class="c54 c5 c25 c55"></span></p><h2 class="c38" id="h.1p8srux9gfbk"><span class="c54 c25 c11 c69 c55">Setup MongoDB datastore &amp; connect via NodeJS</span></h2><p class="c12"><span class="c3">Now! I said last time we need some sort of way to store our messages/users/chats .. only if we had something .. something like .. MySQL .. or ..</span></p><h3 class="c66 c59" id="h.yoomosdywicp"><span class="c39 c25 c11">Introduction to MongoDB</span></h3><p class="c12"><span class="c3">Welcome to mongoDB! </span></p><p class="c12"><span class="c11">MongoDB</span><span class="c3">&nbsp;is a document database with the scalability and flexibility that you want with the querying and indexing that you need.</span></p><p class="c12"><span class="c3">Let&#39;s get started!</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">The first thing you will install for monitoring, debugging and managing, just like mqttLens, is MongoDBCompass. I installed it from here:</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c43"><a class="c30" href="https://www.google.com/url?q=https://www.mongodb.com/docs/manual/administration/install-community/&amp;sa=D&amp;source=editors&amp;ust=1659045919848405&amp;usg=AOvVaw0lAqfqXGbJ6034h8GbvRhC">Install MongoDB Community Edition</a></span></p><p class="c10"><span class="c44 c43 c62"></span></p><p class="c12"><span class="c3">I&rsquo;m broke, so I installed the community edition.</span></p><p class="c12"><span class="c3">After that, I started it up, looked through some tutorials and now I know what I&rsquo;m doing.</span></p><p class="c12"><span class="c3">Basic code for creating a collection/adding to a collection or database:</span></p><p class="c10"><span class="c3"></span></p><a id="t.14ad6e3e9713155c53f0506abe4698824b45a5c0"></a><a id="t.27"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c1">dbo.collection(</span><span class="c18 c19">&quot;messages&quot;</span><span class="c1">).insertMany(</span><span class="c1">msgvar</span><span class="c1">, </span><span class="c24 c19">function</span><span class="c1">&nbsp;(err, res, collection) {<br> &nbsp; &nbsp;</span><span class="c24 c19">if</span><span class="c1">&nbsp;(err) </span><span class="c24 c19">throw</span><span class="c1">&nbsp;err;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c40 c19">console</span><span class="c1">.log(</span><span class="c18 c19">&quot;Number of documents inserted for &lt;messages&gt;: &quot;</span><span class="c1">&nbsp;+ res.insertedCount);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c33 c19">//db.close();</span><span class="c1"><br>});</span></p></td></tr></table><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 600.50px; height: 337.47px;"><img alt="" src="images/image19.png" style="width: 600.50px; height: 337.47px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">This is a full code:</span></p><p class="c10"><span class="c3"></span></p><a id="t.44c9890d006150db9e6b73e68d3812411fd3408c"></a><a id="t.28"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c28">var MongoClient = require(</span><span class="c18">&#39;mongodb&#39;</span><span class="c28">).MongoClient;<br>var url = </span><span class="c18">&quot;mongodb://0.0.0.0:27017/&quot;</span><span class="c28">;<br><br>MongoClient.connect(url, function(err, db) {<br> &nbsp;</span><span class="c24">if</span><span class="c28">&nbsp;(err) </span><span class="c24">throw</span><span class="c28">&nbsp;err;<br> &nbsp;var dbo = db.db(</span><span class="c18">&quot;mydb&quot;</span><span class="c28">);<br> &nbsp;var myobj = [<br> &nbsp; &nbsp;{ </span><span class="c18">name:</span><span class="c28">&nbsp;</span><span class="c18">&#39;John&#39;</span><span class="c28">, </span><span class="c18">address:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Highway 71&#39;</span><span class="c28">},<br> &nbsp; &nbsp;{ </span><span class="c18">name:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Peter&#39;</span><span class="c28">, </span><span class="c18">address:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Lowstreet 4&#39;</span><span class="c28">},<br> &nbsp; &nbsp;{ </span><span class="c18">name:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Amy&#39;</span><span class="c28">, </span><span class="c18">address:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Apple st 652&#39;</span><span class="c28">},<br> &nbsp; &nbsp;{ </span><span class="c18">name:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Hannah&#39;</span><span class="c28">, </span><span class="c18">address:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Mountain 21&#39;</span><span class="c28">},<br> &nbsp; &nbsp;{ </span><span class="c18">name:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Michael&#39;</span><span class="c28">, </span><span class="c18">address:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Valley 345&#39;</span><span class="c28">},<br> &nbsp; &nbsp;{ </span><span class="c18">name:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Sandy&#39;</span><span class="c28">, </span><span class="c18">address:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Ocean blvd 2&#39;</span><span class="c28">},<br> &nbsp; &nbsp;{ </span><span class="c18">name:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Betty&#39;</span><span class="c28">, </span><span class="c18">address:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Green Grass 1&#39;</span><span class="c28">},<br> &nbsp; &nbsp;{ </span><span class="c18">name:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Richard&#39;</span><span class="c28">, </span><span class="c18">address:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Sky st 331&#39;</span><span class="c28">},<br> &nbsp; &nbsp;{ </span><span class="c18">name:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Susan&#39;</span><span class="c28">, </span><span class="c18">address:</span><span class="c28">&nbsp;</span><span class="c18">&#39;One way 98&#39;</span><span class="c28">},<br> &nbsp; &nbsp;{ </span><span class="c18">name:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Vicky&#39;</span><span class="c28">, </span><span class="c18">address:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Yellow Garden 2&#39;</span><span class="c28">},<br> &nbsp; &nbsp;{ </span><span class="c18">name:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Ben&#39;</span><span class="c28">, </span><span class="c18">address:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Park Lane 38&#39;</span><span class="c28">},<br> &nbsp; &nbsp;{ </span><span class="c18">name:</span><span class="c28">&nbsp;</span><span class="c18">&#39;William&#39;</span><span class="c28">, </span><span class="c18">address:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Central st 954&#39;</span><span class="c28">},<br> &nbsp; &nbsp;{ </span><span class="c18">name:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Chuck&#39;</span><span class="c28">, </span><span class="c18">address:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Main Road 989&#39;</span><span class="c28">},<br> &nbsp; &nbsp;{ </span><span class="c18">name:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Viola&#39;</span><span class="c28">, </span><span class="c18">address:</span><span class="c28">&nbsp;</span><span class="c18">&#39;Sideway 1633&#39;</span><span class="c28">}<br> &nbsp;];<br> &nbsp;dbo.collection(</span><span class="c18">&quot;customers&quot;</span><span class="c28">).insertMany(myobj, function(err, res) {<br> &nbsp; &nbsp;</span><span class="c24">if</span><span class="c28">&nbsp;(err) </span><span class="c24">throw</span><span class="c28">&nbsp;err;<br> &nbsp; &nbsp;console.log(</span><span class="c18">&quot;Number of documents inserted: &quot;</span><span class="c28">&nbsp;+ res.insertedCount);<br> &nbsp; &nbsp;db.close();<br> &nbsp;});<br>});</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><p class="c12"><span class="c3">But we don&#39;t want to just- AdD DaTa To MoNGoDB .. no .. I want to add JSON data when a message arrives and when a &nbsp;new user gets online. Then I want to fetch that information from mongo and use it in my endpoint, because currently it is just displaying content/message_log when you are on there at that point. When you weren&#39;t there, you missed it. But now with the mongo, we can recover that data and show the history.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">So? Let&rsquo;s do that!</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&gt;&gt;</span></p><h3 class="c66 c59" id="h.xslylsrovf66"><span class="c39 c25 c11">Setup mongoDB in NodeJS</span></h3><p class="c12"><span class="c3">SO. As usual, we go straight into NodeJS terminal and type: &ldquo;npm i mongodb&rdquo;, and be done with the installation. </span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Now .. we set it up, the package, etc .. </span></p><p class="c10"><span class="c3"></span></p><a id="t.c26d6c10a4cc5afad9f8ce3d4def382f9a9c12ae"></a><a id="t.29"></a><table class="c20"><tr class="c72"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c40 c19">var MongoClient</span><span class="c1">&nbsp;= require(</span><span class="c18 c19">&#39;mongodb&#39;</span><span class="c1">).MongoClient;<br></span><span class="c40 c19">var url</span><span class="c1">&nbsp;= </span><span class="c18 c19">&quot;mongodb://0.0.0.0:27017/&quot;</span><span class="c1">;</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span>We also need a url, which mongodb </span><span>can</span><span>&nbsp;connect to. In our case </span><span>http://localhost:27017</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Then, we do this, now .. this piece of code is kind of complicated .. and i&#39;ll explain it briefly</span></p><p class="c10"><span class="c3"></span></p><a id="t.cd62ab7d450620a51d5702cba16327667a2588b8"></a><a id="t.30"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c1">&nbsp; &nbsp; MongoClient.connect(url, </span><span class="c24 c19">function</span><span class="c1">&nbsp;(err, db) {<br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c19">if</span><span class="c1">&nbsp;(err) </span><span class="c24 c19">throw</span><span class="c1">&nbsp;err;<br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;dbo = db.db(</span><span class="c18 c19">&quot;</span><span class="c18 c19">chatapp</span><span class="c18 c19">&quot;</span><span class="c1">);<br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;</span><span class="c1">messageee</span><span class="c1">&nbsp;= message.toString();<br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;</span><span class="c1">msgvar</span><span class="c1">&nbsp;= [{ </span><span class="c18 c19">&quot;msg&quot;</span><span class="c1">: </span><span class="c1">messageee</span><span class="c1">&nbsp;}];<br> &nbsp; &nbsp; &nbsp;dbo.collection(</span><span class="c18 c19">&quot;messages&quot;</span><span class="c1">).insertMany(</span><span class="c1">msgvar</span><span class="c1">, </span><span class="c24 c19">function</span><span class="c1">&nbsp;(err, res, collection) {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c24 c19">if</span><span class="c1">&nbsp;(err) </span><span class="c24 c19">throw</span><span class="c1">&nbsp;err;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c40 c19">console</span><span class="c1">.log(</span><span class="c18 c19">&quot;Number of documents inserted for &lt;messages&gt;: &quot;</span><span class="c1">&nbsp;+ res.insertedCount);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c33 c19">//db.close();</span><span class="c1"><br> &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c19">const</span><span class="c1">&nbsp;collection = dbo.collection(</span><span class="c18 c19">&#39;messages&#39;</span><span class="c1">)<br> &nbsp; &nbsp; &nbsp;collection.find().toArray((err, items) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c33 c19">//console.log(items)</span><span class="c1"><br> &nbsp; &nbsp; &nbsp;})<br> &nbsp; &nbsp;});</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">Yeah well .. I gave it weird names but in general: we connect the mongoclient with the url, and then we set up the function. Much like the callbacks. Then we check if there&rsquo;s an error, if not then continue. We set up our variables. The msgvar is a JSON object. Then we add to the database&rsquo;s collection messages and insert the messages there. Basically storing all messages. And then we find the collection and then we extract all items in there and I would console log it. I removed it because it was becoming too big. And this would then go in the onmessage callback.</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&gt;&gt;</span></p><h4 class="c41" id="h.x45fecqsjsn"><span class="c25 c11">Updating callbacks and functions</span></h4><p class="c12"><span class="c3">So we need to update all our callbacks and functions.</span></p><h5 class="c51" id="h.oo7347igg0s9"><span class="c44 c25 c11">On message arrived</span></h5><p class="c12"><span class="c3">Okay, so now our on message arrived looks like this:</span></p><p class="c10"><span class="c3"></span></p><a id="t.b1b78e7b3376519234361f192b3670740591c3fa"></a><a id="t.31"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c28 c32">client.on(</span><span class="c17">&#39;message&#39;</span><span class="c28 c32">, </span><span class="c24 c32">function</span><span class="c28 c32">&nbsp;(topic, message) {<br> &nbsp;</span><span class="c24 c32">var</span><span class="c28 c32">&nbsp;MongoClient = </span><span class="c40 c32">require</span><span class="c28 c32">(</span><span class="c17">&#39;mongodb&#39;</span><span class="c28 c32">).MongoClient;<br> &nbsp;</span><span class="c24 c32">var</span><span class="c28 c32">&nbsp;url = </span><span class="c17">&quot;mongodb://0.0.0.0:27017/&quot;</span><span class="c28 c32">;<br> &nbsp;</span><span class="c29">// message is Buffer</span><span class="c28 c32"><br> &nbsp;</span><span class="c24 c32">try</span><span class="c28 c32">&nbsp;{<br> &nbsp; &nbsp;msgObj = </span><span class="c40 c32">JSON</span><span class="c28 c32">.parse(message.toString()); </span><span class="c29">// t is JSON so handle it how u want</span><span class="c28 c32"><br> &nbsp; &nbsp;</span><span class="c29">// if message has Ping of Pong in it send it to the PingPongHandler</span><span class="c28 c32"><br> &nbsp; &nbsp;</span><span class="c24 c32">if</span><span class="c28 c32">&nbsp;(</span><span class="c32 c40">Object</span><span class="c28 c32">.keys(msgObj)[</span><span class="c36 c32">0</span><span class="c28 c32">] == </span><span class="c17">&quot;ping&quot;</span><span class="c28 c32">) {<br> &nbsp; &nbsp; &nbsp;sendPong(</span><span class="c17">&quot;codettes2022&quot;</span><span class="c28 c32">, </span><span class="c17">&quot;</span><span class="c17">Keshavs</span><span class="c17">&nbsp;</span><span class="c17">NODEJS</span><span class="c17">&nbsp;server&quot;</span><span class="c28 c32">, </span><span class="c17">&quot;cb__SERVER{usr:&#39;Keshav&#39;::S_id__unwn}&quot;</span><span class="c28 c32">);<br> &nbsp; &nbsp;};<br> &nbsp; &nbsp;</span><span class="c24 c32">if</span><span class="c28 c32">&nbsp;(</span><span class="c40 c32">Object</span><span class="c28 c32">.keys(msgObj)[</span><span class="c36 c32">0</span><span class="c28 c32">] == </span><span class="c17">&quot;pong&quot;</span><span class="c28 c32">) {<br> &nbsp; &nbsp; &nbsp;handlePong(msgObj.pong);<br> &nbsp; &nbsp;}; </span><span class="c29">// pong value is an object!!</span><span class="c28 c32"><br> &nbsp; &nbsp;</span><span class="c29">// other handlers for control messages below</span><span class="c28 c32"><br> &nbsp;} </span><span class="c24 c32">catch</span><span class="c28 c32">&nbsp;{<br> &nbsp; &nbsp;messages.push({ </span><span class="c17">&quot;time&quot;</span><span class="c28 c32">: </span><span class="c40 c32">Date</span><span class="c28 c32">(), </span><span class="c17">&quot;topic&quot;</span><span class="c28 c32">: topic, </span><span class="c17">&quot;message&quot;</span><span class="c28 c32">: message.toString() });<br> &nbsp; &nbsp;MongoClient.connect(url, </span><span class="c24 c32">function</span><span class="c28 c32">&nbsp;(err, db) {<br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c32">if</span><span class="c28 c32">&nbsp;(err) </span><span class="c24 c32">throw</span><span class="c28 c32">&nbsp;err;<br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c32">var</span><span class="c28 c32">&nbsp;dbo = db.db(</span><span class="c17">&quot;</span><span class="c17">chatapp</span><span class="c17">&quot;</span><span class="c28 c32">);<br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c32">var</span><span class="c28 c32">&nbsp;</span><span class="c28 c32">messageee</span><span class="c28 c32">&nbsp;= message.toString();<br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c32">var</span><span class="c28 c32">&nbsp;</span><span class="c28 c32">msgvar</span><span class="c28 c32">&nbsp;= [{ </span><span class="c17">&quot;msg&quot;</span><span class="c28 c32">: </span><span class="c28 c32">messageee</span><span class="c28 c32">&nbsp;}];<br> &nbsp; &nbsp; &nbsp;dbo.collection(</span><span class="c17">&quot;messages&quot;</span><span class="c28 c32">).insertMany(</span><span class="c28 c32">msgvar</span><span class="c28 c32">, </span><span class="c24 c32">function</span><span class="c28 c32">&nbsp;(err, res, collection) {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c24 c32">if</span><span class="c28 c32">&nbsp;(err) </span><span class="c24 c32">throw</span><span class="c28 c32">&nbsp;err;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c40 c32">console</span><span class="c28 c32">.log(</span><span class="c17">&quot;Number of documents inserted for &lt;messages&gt;: &quot;</span><span class="c28 c32">&nbsp;+ res.insertedCount);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c29">//db.close();</span><span class="c28 c32"><br> &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c32">const</span><span class="c28 c32">&nbsp;collection = dbo.collection(</span><span class="c17">&#39;messages&#39;</span><span class="c28 c32">)<br> &nbsp; &nbsp; &nbsp;collection.find().toArray((err, items) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c29">//console.log(items)</span><span class="c28 c32"><br> &nbsp; &nbsp; &nbsp;})<br> &nbsp; &nbsp;});<br> &nbsp;}<br> &nbsp;</span><span class="c40 c32">console</span><span class="c28 c32">.log(message.toString())<br>})</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&gt;&gt;</span></p><h5 class="c51" id="h.l558d47zo1ua"><span class="c44 c25 c11">HandlePong</span></h5><p class="c12"><span>The </span><span>handlepong</span><span class="c3">&nbsp;will also be changed. It&rsquo;s almost like the message storage but instead storing all users. Pretty straight forward:</span></p><p class="c10"><span class="c3"></span></p><a id="t.829aff0aac99134f3a1895649aa7f80011e76736"></a><a id="t.32"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c1">&nbsp; MongoClient.connect(url, </span><span class="c24 c19">function</span><span class="c1">&nbsp;(err, db) {<br> &nbsp; &nbsp;</span><span class="c24 c19">if</span><span class="c1">&nbsp;(err) </span><span class="c24 c19">throw</span><span class="c1">&nbsp;err;<br> &nbsp; &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;dbo = db.db(</span><span class="c18 c19">&quot;</span><span class="c18 c19">chatapp</span><span class="c18 c19">&quot;</span><span class="c1">);<br> &nbsp; &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;</span><span class="c1">usrnm</span><span class="c1">&nbsp;= pongObj.userName.toString();<br> &nbsp; &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;</span><span class="c1">usrvar</span><span class="c1">&nbsp;= [{ </span><span class="c18 c19">&quot;USR&quot;</span><span class="c1">: </span><span class="c1">usrnm</span><span class="c1">&nbsp;}];<br> &nbsp; &nbsp;dbo.collection(</span><span class="c18 c19">&quot;users&quot;</span><span class="c1">).insertMany(</span><span class="c1">usrvar</span><span class="c1">, </span><span class="c24 c19">function</span><span class="c1">&nbsp;(err, res, collection) {<br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c19">if</span><span class="c1">&nbsp;(err) </span><span class="c24 c19">throw</span><span class="c1">&nbsp;err;<br> &nbsp; &nbsp; &nbsp;</span><span class="c40 c19">console</span><span class="c1">.log(</span><span class="c18 c19">&quot;Number of documents inserted for &lt;users&gt;: &quot;</span><span class="c1">&nbsp;+ res.insertedCount);<br> &nbsp; &nbsp; &nbsp;</span><span class="c33 c19">//db.close();</span><span class="c1"><br> &nbsp; &nbsp;});<br> &nbsp; &nbsp;</span><span class="c24 c19">const</span><span class="c1">&nbsp;collection = dbo.collection(</span><span class="c18 c19">&#39;users&#39;</span><span class="c1">)<br> &nbsp; &nbsp;collection.find().toArray((err, items) =&gt; {<br> &nbsp; &nbsp; &nbsp;</span><span class="c33 c19">//idk what to do here</span><span class="c1"><br> &nbsp; &nbsp;})<br> &nbsp;});</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">We are only changing the values and the collection name to &ldquo;users&rdquo;.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">So the goal I&rsquo;m trying to achieve by doing this is storing all user data and message logs in mongodb, and when a user goes to the endpoint, you can view the entire log of messages or top ten.</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 529.50px; height: 297.84px;"><img alt="" src="images/image20.png" style="width: 529.50px; height: 297.84px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">The full user update code looks like this:</span></p><p class="c10"><span class="c3"></span></p><a id="t.238e23c9c2ef56ac9aed3b8de467d0dafab7fcf1"></a><a id="t.33"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c24 c19">function</span><span class="c1">&nbsp;</span><span class="c40 c19">handlePong</span><span class="c1">(pongObj) {<br> &nbsp;</span><span class="c33 c19">// Update Userlist with Pongs</span><span class="c1"><br> &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;MongoClient = </span><span class="c40 c19">require</span><span class="c1">(</span><span class="c18 c19">&#39;mongodb&#39;</span><span class="c1">).MongoClient;<br> &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;url = </span><span class="c18 c19">&quot;mongodb://0.0.0.0:27017/&quot;</span><span class="c1">;<br> &nbsp;</span><span class="c24 c19">const</span><span class="c1">&nbsp;index = userList.findIndex(object =&gt; {<br> &nbsp; &nbsp;</span><span class="c24 c19">return</span><span class="c1">&nbsp;object.userName === pongObj.userName;<br> &nbsp;})<br><br> &nbsp;</span><span class="c33 c19">//console.log(&quot;index:&quot; + index);</span><span class="c1"><br> &nbsp;</span><span class="c24 c19">if</span><span class="c1">&nbsp;(index &gt;= </span><span class="c36 c19">0</span><span class="c1">) {<br> &nbsp; &nbsp;</span><span class="c40 c19">console</span><span class="c1">.log(</span><span class="c18 c19">&quot;User exists&quot;</span><span class="c1">);<br> &nbsp; &nbsp;userList[index] = pongObj;<br> &nbsp;} </span><span class="c24 c19">else</span><span class="c1">&nbsp;{<br> &nbsp; &nbsp;</span><span class="c40 c19">console</span><span class="c1">.log(</span><span class="c18 c19">&quot;New User &quot;</span><span class="c1">&nbsp;+ pongObj.userName);<br> &nbsp; &nbsp;userList.push(pongObj);<br> &nbsp;}<br> &nbsp;MongoClient.connect(url, </span><span class="c24 c19">function</span><span class="c1">&nbsp;(err, db) {<br> &nbsp; &nbsp;</span><span class="c24 c19">if</span><span class="c1">&nbsp;(err) </span><span class="c24 c19">throw</span><span class="c1">&nbsp;err;<br> &nbsp; &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;dbo = db.db(</span><span class="c18 c19">&quot;</span><span class="c18 c19">chatapp</span><span class="c18 c19">&quot;</span><span class="c1">);<br> &nbsp; &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;</span><span class="c1">usrnm</span><span class="c1">&nbsp;= pongObj.userName.toString();<br> &nbsp; &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;</span><span class="c1">usrvar</span><span class="c1">&nbsp;= [{ </span><span class="c18 c19">&quot;USR&quot;</span><span class="c1">: </span><span class="c1">usrnm</span><span class="c1">&nbsp;}];<br> &nbsp; &nbsp;dbo.collection(</span><span class="c18 c19">&quot;users&quot;</span><span class="c1">).insertMany(</span><span class="c1">usrvar</span><span class="c1">, </span><span class="c24 c19">function</span><span class="c1">&nbsp;(err, res, collection) {<br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c19">if</span><span class="c1">&nbsp;(err) </span><span class="c24 c19">throw</span><span class="c1">&nbsp;err;<br> &nbsp; &nbsp; &nbsp;</span><span class="c40 c19">console</span><span class="c1">.log(</span><span class="c18 c19">&quot;Number of documents inserted for &lt;users&gt;: &quot;</span><span class="c1">&nbsp;+ res.insertedCount);<br> &nbsp; &nbsp; &nbsp;</span><span class="c33 c19">//db.close();</span><span class="c1"><br> &nbsp; &nbsp;});<br> &nbsp; &nbsp;</span><span class="c24 c19">const</span><span class="c1">&nbsp;collection = dbo.collection(</span><span class="c18 c19">&#39;users&#39;</span><span class="c1">)<br> &nbsp; &nbsp;collection.find().toArray((err, items) =&gt; {<br> &nbsp; &nbsp; &nbsp;</span><span class="c19 c33">//idk what to do here</span><span class="c1"><br> &nbsp; &nbsp;})<br> &nbsp;});<br>}</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&gt;&gt;</span></p><p class="c6 c48"><span class="c3"></span></p><h3 class="c59 c66" id="h.rxqllc7ba6ud"><span class="c39 c25 c11">Setup mongoose</span></h3><p class="c12"><span class="c3">Mongoose is an Object Data Modeling (ODM) library for MongoDB and Node.js. It manages relationships between data, provides schema validation, and is used to translate between objects in code and the representation of those objects in MongoDB.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">You can simply install mongoose by typing &ldquo;npm i mongoose&rdquo; into the NodeJS command prompt.</span></p><p class="c10"><span class="c22"></span></p><p class="c12"><span class="c3">I didn&rsquo;t use mongoose often, but when I&rsquo;ll use it later, I&rsquo;ll be mentioning it.</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">&gt;&gt;</span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><h2 class="c38 c45" id="h.iap3q0ej7xa8"><span class="c54 c25 c11 c69 c55">Create data-bound widgets to display sensor data</span></h2><p class="c12"><span class="c3">So, now that we figured out a way to store and receive data in mongoDB and javascript.. But what if we want to use that data in html? Well that&rsquo;s what we&rsquo;ll be doing today.</span></p><p class="c10"><span class="c3"></span></p><h3 class="c66 c59" id="h.j4dxyaywwikl"><span class="c39 c25 c11">Approach</span></h3><p class="c12"><span>I first was breaking my head about this, since this was according to my experience impossible.. Because it&#39;s the server side handler that gets and sends all the data.. And I could do that with importing in html too but the mongoDB library isn&rsquo;t only written in javascript.. So I was kind of stuck. But then I came across </span><span class="c11">ejs</span><span class="c11">. </span><span>W</span><span>ith</span><span class="c3">&nbsp;ejs I can code in html, but at the same time I can use javascript variables in the html code. So my server hosts the ejs file and then I can use the server variables in my html (ejs):</span></p><p class="c10"><span class="c3"></span></p><a id="t.71a17fe3664c1f3d379405d974749a898aabd30c"></a><a id="t.34"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c1">&nbsp; &nbsp; &nbsp; res.</span><span class="c24 c19">render</span><span class="c1">(</span><span class="c18 c19">&#39;index.ejs&#39;</span><span class="c1">, {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c24 c19">log</span><span class="c1">: itm<br> &nbsp; &nbsp; &nbsp;});</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><a id="t.bd1c0e0d3ed02eb14b700adb772f0e70abdf7cdc"></a><a id="t.35"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c47 c19 c62">&lt;</span><span class="c19 c11 c47">h4</span><span class="c47 c19 c62">&nbsp;id=</span><span class="c18 c19">&quot;hr&quot;</span><span class="c47 c19 c62">&gt;&lt;</span><span class="c47 c19 c11">%=</span><span class="c1">&nbsp;</span><span class="c24 c19">log</span><span class="c1">&nbsp;</span><span class="c47 c19 c62">%&gt;&lt;/</span><span class="c47 c19 c11">h4</span><span class="c47 c19 c62">&gt;</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">And to get the latest data from mongoDB, I did this:</span></p><p class="c10"><span class="c3"></span></p><a id="t.02f0535a37277916ef96a79742d0e3d4053c6060"></a><a id="t.36"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c1">&nbsp; MongoClient.connect(url, </span><span class="c24 c19">function</span><span class="c1">&nbsp;(err, db) {<br> &nbsp; &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;dbo = db.db(</span><span class="c18 c19">&quot;</span><span class="c18 c19">chatapp</span><span class="c18 c19">&quot;</span><span class="c1">);<br> &nbsp; &nbsp;</span><span class="c24 c19">const</span><span class="c1">&nbsp;collection = dbo.collection(</span><span class="c18 c19">&#39;messages&#39;</span><span class="c1">);<br> &nbsp; &nbsp;collection.find().sort({ </span><span class="c18 c19">&#39;_id&#39;</span><span class="c1">: </span><span class="c36 c19">-1</span><span class="c1">&nbsp;}).limit(</span><span class="c36 c19">1</span><span class="c1">).toArray((err, items) =&gt; {<br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;_log = items;<br> &nbsp; &nbsp; &nbsp;_log.forEach(</span><span class="c24 c19">function</span><span class="c1">&nbsp;(item) {<br> &nbsp; &nbsp; &nbsp; &nbsp;globalThis.itm = item.msg<br> &nbsp; &nbsp; &nbsp; &nbsp;globalThis.itm = itm.toString();<br> &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp;res.render(</span><span class="c18 c19">&#39;index.ejs&#39;</span><span class="c1">, {<br> &nbsp; &nbsp; &nbsp; &nbsp;log: itm<br> &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp;});<br> &nbsp;});</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">So I&rsquo;m doing the basic stuff until I take the latest one and then I say that I only want the message from the JSON, else it will come in as JSON objects. And then finally, I &ldquo;globalize&rdquo; it and pass it to the render.</span></p><p class="c12"><span style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 474.50px; height: 248.55px;"><img alt="" src="images/image2.png" style="width: 474.50px; height: 248.55px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);" title=""></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c10"><span class="c3"></span></p><p class="c6 c48"><span class="c3"></span></p><p class="c12"><span class="c25 c62 c34 c32 c74">Example getting data from a tello drone, storing, retrieving and displaying it</span></p><p class="c10"><span class="c74 c25 c62 c34 c32"></span></p><p class="c12"><span class="c3">So now that we know what the approach does, let&#39;s look at the code.</span></p><h3 class="c66 c59" id="h.okypw1wrr45s"><span class="c39 c25 c11">Code</span></h3><h4 class="c41" id="h.t4t88ulcpvtm"><span class="c13 c11">Setup</span></h4><p class="c12"><span class="c3">Let&rsquo;s look at the first piece of NodeJS code, here we are including all libraries and initializing all the needed platforms:</span></p><p class="c10"><span class="c3"></span></p><a id="t.c312f394877116da7c120d247b22f8d5c068ec2d"></a><a id="t.37"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c40 c19">const express</span><span class="c1">&nbsp;= require(</span><span class="c18 c19">&quot;express&quot;</span><span class="c1">);<br></span><span class="c40 c19">const path</span><span class="c1">&nbsp;= require(</span><span class="c18 c19">&quot;path&quot;</span><span class="c1">);<br></span><span class="c40 c19">const mongoose</span><span class="c1">&nbsp;= require(</span><span class="c18 c19">&#39;mongoose&#39;</span><span class="c1">);<br></span><span class="c40 c19">const ejs</span><span class="c1">&nbsp;= require(</span><span class="c18 c19">&#39;ejs&#39;</span><span class="c1">);<br></span><span class="c40 c19">const app</span><span class="c1">&nbsp;= express();<br></span><span class="c40 c19">const MongoClient</span><span class="c1">&nbsp;= require(</span><span class="c18 c19">&#39;mongodb&#39;</span><span class="c1">).MongoClient;<br></span><span class="c40 c19">const url</span><span class="c1">&nbsp;= </span><span class="c18 c19">&quot;mongodb://0.0.0.0:27017/&quot;</span><span class="c1">;<br></span><span class="c40 c19">const PORT</span><span class="c1">&nbsp;= 3000;<br></span><span class="c40 c19">const defIP</span><span class="c1">&nbsp;= </span><span class="c18 c19">&quot;http://localhost:3000 or http://127.0.0.1:3000/&quot;</span><span class="c1">;</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">And then we set up the basic mqtt:</span></p><p class="c10"><span class="c3"></span></p><a id="t.8a42a3d9fc7058ac5a1b3bd28ee1781a02cce75d"></a><a id="t.38"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c29">// MQTT client connection on NodeJS</span><span class="c28 c32"><br></span><span class="c24 c32">var</span><span class="c28 c32">&nbsp;userList = []; </span><span class="c29">// manage the userlist</span><span class="c28 c32"><br></span><span class="c24 c32">var</span><span class="c28 c32">&nbsp;messages = []; </span><span class="c29">// message log dit wordt straks die MongoDB</span><span class="c28 c32"><br><br></span><span class="c29">//connect mqtt</span><span class="c28 c32"><br></span><span class="c24 c32">const</span><span class="c28 c32">&nbsp;mqtt = </span><span class="c40 c32">require</span><span class="c28 c32">(</span><span class="c17">&#39;mqtt&#39;</span><span class="c28 c32">);<br></span><span class="c24 c32">const</span><span class="c28 c32">&nbsp;client = mqtt.connect(</span><span class="c17">&quot;ws://broker.hivemq.com:8000/mqtt&quot;</span><span class="c28 c32">);<br></span><span class="c24 c32">var</span><span class="c28 c32">&nbsp;mqtt_tpc = </span><span class="c17">&quot;codettes2022&quot;</span><span class="c28 c32">; </span><span class="c29">// change the mqtt topic here</span></p></td></tr></table><h4 class="c41" id="h.ky4fte2zt56x"><span class="c25 c11">Main </span><span class="c13 c11">Endpoint</span></h4><p class="c12"><span class="c3">I will not explain the callbacks and functions again because they stay the same.</span></p><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">But here we have the first endpoint, the message endpoint. </span></p><p class="c10"><span class="c3"></span></p><a id="t.b3ba99983cfd319f88909639a4ea38b926ac3e36"></a><a id="t.39"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c1">app.set(</span><span class="c18 c19">&#39;view engine&#39;</span><span class="c1">, </span><span class="c18 c19">&#39;ejs&#39;</span><span class="c1">);<br>app.</span><span class="c24 c19">use</span><span class="c1">(express.</span><span class="c24 c19">static</span><span class="c1">(__dirname + </span><span class="c18 c19">&#39;/public&#39;</span><span class="c1">));<br><br>app.get(</span><span class="c18 c19">&#39;/&#39;</span><span class="c1">, (req, res) =&gt; {<br> &nbsp;MongoClient.connect(url, </span><span class="c24 c19">function</span><span class="c1">&nbsp;(err, db) {<br> &nbsp; &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;dbo = db.db(</span><span class="c18 c19">&quot;</span><span class="c18 c19">chatapp</span><span class="c18 c19">&quot;</span><span class="c1">);<br> &nbsp; &nbsp;</span><span class="c24 c19">const</span><span class="c1">&nbsp;collection = dbo.collection(</span><span class="c18 c19">&#39;messages&#39;</span><span class="c1">);<br> &nbsp; &nbsp;collection.find().sort({ </span><span class="c18 c19">&#39;_id&#39;</span><span class="c1">: </span><span class="c36 c19">-1</span><span class="c1">&nbsp;}).limit(</span><span class="c36 c19">1</span><span class="c1">).toArray((err, items) =&gt; {<br> &nbsp; &nbsp; &nbsp;</span><span class="c24 c19">var</span><span class="c1">&nbsp;_log = items;<br> &nbsp; &nbsp; &nbsp;_log.</span><span class="c24 c19">forEach</span><span class="c1">(</span><span class="c24 c19">function</span><span class="c1">&nbsp;(item) {<br> &nbsp; &nbsp; &nbsp; &nbsp;globalThis.itm = item.msg<br> &nbsp; &nbsp; &nbsp; &nbsp;globalThis.itm = itm.toString();<br> &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp; &nbsp;res.render(</span><span class="c18 c19">&#39;index.ejs&#39;</span><span class="c1">, {<br> &nbsp; &nbsp; &nbsp; &nbsp;log: itm<br> &nbsp; &nbsp; &nbsp;});<br> &nbsp; &nbsp;});<br> &nbsp;});<br>});</span></p></td></tr></table><p class="c10"><span class="c3"></span></p><p class="c12"><span class="c3">So first we are setting up the EJS view engine. And then we set up the main endpoint. First we enter the mongoClient callback, then we declare our necessary variables, then we enter the collection, here we will find the latest message, set it to a variable and then extract the message object out of it. We set that item to a global variable and then we use it in the render to be later used in the EJS file:</span></p><p class="c10"><span class="c3"></span></p><a id="t.bd1c0e0d3ed02eb14b700adb772f0e70abdf7cdc"></a><a id="t.40"></a><table class="c20"><tr class="c7"><td class="c8" colspan="1" rowspan="1"><p class="c6"><span class="c47 c62">&lt;</span><span class="c47 c11">h4</span><span class="c47 c62">&nbsp;id=</span><span class="c18">&quot;hr&quot;</span><span class="c47 c62">&gt;&lt;</span><span class="c47 c11">%=</span><span class="c28">&nbsp;</span><span class="c24">log</span><span class="c28">&nbsp;</span><span class="c47 c62">%&gt;&lt;/</span><span class="c47 c11">h4</span><span class="c47 c62">&gt;</span></p></td></tr></table><p class="c6 c58"><span class="c3"></span></p><p class="c61"><span class="c3">That was pretty simple.. Not too much.. But Mr Theo has another method he will explain too. This is just an approach. </span></p><p class="c61 c58"><span class="c3"></span></p><p class="c61 c58"><span class="c3"></span></p><p class="c61 c58"><span class="c3"></span></p><p class="c61 c58"><span class="c3"></span></p><p class="c61"><span class="c3">&lt;&gt;</span></p><p class="c6 c58"><span class="c3"></span></p><p class="c61 c58"><span class="c3"></span></p></body></html>
